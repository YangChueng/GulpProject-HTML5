/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
function echo(c,b){alert("hello world")}var fabric=fabric||{version:"1.5.0"};if("undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)","undefined"==typeof eventjs)var eventjs={};if(function(n){n.modifyEventListener=!1,n.modifySelectors=!1,n.configure=function(s){isFinite(s.modifyEventListener)&&(n.modifyEventListener=s.modifyEventListener),isFinite(s.modifySelectors)&&(n.modifySelectors=s.modifySelectors),e===!1&&n.modifyEventListener&&l(),f===!1&&n.modifySelectors&&o()},n.add=function(v,t,u,s){return d(v,t,u,s,"add")},n.remove=function(v,t,u,s){return d(v,t,u,s,"remove")},n.returnFalse=function(s){return!1},n.stop=function(s){s&&(s.stopPropagation&&s.stopPropagation(),s.cancelBubble=!0,s.cancelBubbleCount=0)},n.prevent=function(s){s&&(s.preventDefault?s.preventDefault():s.preventManipulation?s.preventManipulation():s.returnValue=!1)},n.cancel=function(s){n.stop(s),n.prevent(s)},n.blur=function(){var s=document.activeElement;if(s){var t=document.activeElement.nodeName;"INPUT"!==t&&"TEXTAREA"!==t&&"true"!==s.contentEditable||s.blur&&s.blur()}},n.getEventSupport=function(u,t){if("string"==typeof u&&(t=u,u=window),t="on"+t,t in u)return!0;if(u.setAttribute||(u=document.createElement("div")),u.setAttribute&&u.removeAttribute){u.setAttribute(t,"");var s="function"==typeof u[t];return"undefined"!=typeof u[t]&&(u[t]=null),u.removeAttribute(t),s}};var q=function(u){if(!u||"object"!=typeof u)return u;var s=new u.constructor;for(var t in u)u[t]&&"object"==typeof u[t]?s[t]=q(u[t]):s[t]=u[t];return s},d=function(S,u,v,R,D,N){if(R=R||{},"[object Object]"===String(S)){var U=S;if(S=U.target,delete U.target,!U.type||!U.listener){for(var w in U){var K=U[w];"function"!=typeof K&&(R[w]=K)}var T={};for(var V in U){var w=V.split(","),H=U[V],B={};for(var L in R)B[L]=R[L];if("function"==typeof H)var v=H;else{if("function"!=typeof H.listener)continue;var v=H.listener;for(var L in H)"function"!=typeof H[L]&&(B[L]=H[L])}for(var J=0;J<w.length;J++)T[V]=eventjs.add(S,w[J],v,B,D)}return T}u=U.type,delete U.type,v=U.listener,delete U.listener;for(var V in U)R[V]=U[V]}if(S&&u&&v){if("string"==typeof S&&"ready"===u){if(!window.eventjs_stallOnReady){var x=(new Date).getTime(),A=R.timeout,I=R.interval||1e3/60,O=window.setInterval(function(){(new Date).getTime()-x>A&&window.clearInterval(O),document.querySelector(S)&&(window.clearInterval(O),setTimeout(v,1))},I);return}u="load",S=window}if("string"==typeof S){if(S=document.querySelectorAll(S),0===S.length)return b("Missing target on listener!",arguments);1===S.length&&(S=S[0])}var M,s={};if(S.length>0&&S!==window){for(var z=0,G=S.length;G>z;z++)M=d(S[z],u,v,q(R),D),M&&(s[z]=M);return i(s)}if("string"==typeof u&&(u=u.toLowerCase(),-1!==u.indexOf(" ")?u=u.split(" "):-1!==u.indexOf(",")&&(u=u.split(","))),"string"!=typeof u){if("number"==typeof u.length)for(var y=0,E=u.length;E>y;y++)M=d(S,u[y],v,q(R),D),M&&(s[u[y]]=M);else for(var V in u)M="function"==typeof u[V]?d(S,V,u[V],q(R),D):d(S,V,u[V].listener,q(u[V]),D),M&&(s[V]=M);return i(s)}if(0===u.indexOf("on")&&(u=u.substr(2)),"object"!=typeof S)return b("Target is not defined!",arguments);if("function"!=typeof v)return b("Listener is not a function!",arguments);var Q=R.useCapture||!1,F=c(S)+"."+c(v)+"."+(Q?1:0);if(n.Gesture&&n.Gesture._gestureHandlers[u]){if(F=u+F,"remove"===D){if(!j[F])return;j[F].remove(),delete j[F]}else if("add"===D){if(j[F])return j[F].add(),j[F];if(R.useCall&&!n.modifyEventListener){var P=v;v=function(Y,W){for(var X in W)Y[X]=W[X];return P.call(S,Y)}}R.gesture=u,R.target=S,R.listener=v,R.fromOverwrite=N,j[F]=n.proxy[u](R)}return j[F]}for(var C,t=g(u),J=0;J<t.length;J++)if(u=t[J],C=u+"."+F,"remove"===D){if(!j[C])continue;S[r](u,v,Q),delete j[C]}else if("add"===D){if(j[C])return j[C];S[m](u,v,Q),j[C]={id:C,type:u,target:S,listener:v,remove:function(){for(var W=0;W<t.length;W++)n.remove(S,t[W],v,R)}}}return j[C]}},i=function(s){return{remove:function(){for(var t in s)s[t].remove()},add:function(){for(var t in s)s[t].add()}}},b=function(s,t){"undefined"!=typeof console&&"undefined"!=typeof console.error&&console.error(s,t)},p={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},h={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2},g=(function(){n.supports={},window.navigator.msPointerEnabled&&(n.supports.msPointer=!0),n.getEventSupport("touchstart")&&(n.supports.touch=!0),n.getEventSupport("mousedown")&&(n.supports.mouse=!0)}(),function(){return function(v){var w=document.addEventListener?"":"on",s=h[v];if(isFinite(s)){var u=[];for(var t in n.supports)u.push(w+p[t][s]);return u}return[w+v]}}()),j={},k=0,c=function(s){return s===window?"#window":s===document?"#document":(s.uniqueID||(s.uniqueID="e"+k++),s.uniqueID)},m=document.addEventListener?"addEventListener":"attachEvent",r=document.removeEventListener?"removeEventListener":"detachEvent";n.createPointerEvent=function(t,z,s){var w=z.gesture,x=z.target,A=t.changedTouches||n.proxy.getCoords(t);if(A.length){var B=A[0];z.pointers=s?[]:A,z.pageX=B.pageX,z.pageY=B.pageY,z.x=z.pageX,z.y=z.pageY}var v=document.createEvent("Event");v.initEvent(w,!0,!0),v.originalEvent=t;for(var u in z)"target"!==u&&(v[u]=z[u]);var y=v.type;n.Gesture&&n.Gesture._gestureHandlers[y]&&z.oldListener.call(x,v,z,!1)};var e=!1,l=function(){if(window.HTMLElement){var s=function(u){var t=function(v){var x=v+"EventListener",w=u[x];u[x]=function(B,C,y){if(n.Gesture&&n.Gesture._gestureHandlers[B]){var z=y;"object"==typeof y?z.useCall=!0:z={useCall:!0,useCapture:y},d(this,B,C,z,v,!0)}else for(var A=g(B),D=0;D<A.length;D++)w.call(this,A[D],C,y)}};t("add"),t("remove")};navigator.userAgent.match(/Firefox/)?(s(HTMLDivElement.prototype),s(HTMLCanvasElement.prototype)):s(HTMLElement.prototype),s(document),s(window)}},f=!1,o=function(){var s=NodeList.prototype;s.removeEventListener=function(u,w,t){for(var x=0,v=this.length;v>x;x++)this[x].removeEventListener(u,w,t)},s.addEventListener=function(u,w,t){for(var x=0,v=this.length;v>x;x++)this[x].addEventListener(u,w,t)}};return n}(eventjs),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){a.pointerSetup=function(f,e){f.target=f.target||window,f.doc=f.target.ownerDocument||f.target,f.minFingers=f.minFingers||f.fingers||1,f.maxFingers=f.maxFingers||f.fingers||1/0,f.position=f.position||"relative",delete f.fingers,e=e||{},e.enabled=!0,e.gesture=f.gesture,e.target=f.target,e.env=f.env,eventjs.modifyEventListener&&f.fromOverwrite&&(f.oldListener=f.listener,f.listener=eventjs.createPointerEvent);var d=0,g=0===e.gesture.indexOf("pointer")&&eventjs.modifyEventListener?"pointer":"mouse";return f.oldListener&&(e.oldListener=f.oldListener),e.listener=f.listener,e.proxy=function(h){e.defaultListener=f.listener,f.listener=h,h(f.event,e)},e.add=function(){e.enabled!==!0&&(f.onPointerDown&&eventjs.add(f.target,g+"down",f.onPointerDown),f.onPointerMove&&eventjs.add(f.doc,g+"move",f.onPointerMove),f.onPointerUp&&eventjs.add(f.doc,g+"up",f.onPointerUp),e.enabled=!0)},e.remove=function(){e.enabled!==!1&&(f.onPointerDown&&eventjs.remove(f.target,g+"down",f.onPointerDown),f.onPointerMove&&eventjs.remove(f.doc,g+"move",f.onPointerMove),f.onPointerUp&&eventjs.remove(f.doc,g+"up",f.onPointerUp),e.reset(),e.enabled=!1)},e.pause=function(h){!f.onPointerMove||h&&!h.move||eventjs.remove(f.doc,g+"move",f.onPointerMove),!f.onPointerUp||h&&!h.up||eventjs.remove(f.doc,g+"up",f.onPointerUp),d=f.fingers,f.fingers=0},e.resume=function(h){!f.onPointerMove||h&&!h.move||eventjs.add(f.doc,g+"move",f.onPointerMove),!f.onPointerUp||h&&!h.up||eventjs.add(f.doc,g+"up",f.onPointerUp),f.fingers=d},e.reset=function(){f.tracker={},f.fingers=0},e};var b=eventjs.supports;eventjs.isMouse=!!b.mouse,eventjs.isMSPointer=!!b.touch,eventjs.isTouch=!!b.msPointer,a.pointerStart=function(e,r,o){var p=(e.type||"mousedown").toUpperCase();0===p.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===p.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===p.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);var k=function(z,t){var v=o.bbox,u=h[t]={};switch(o.position){case"absolute":u.offsetX=0,u.offsetY=0;break;case"differenceFromLast":u.offsetX=z.pageX,u.offsetY=z.pageY;break;case"difference":u.offsetX=z.pageX,u.offsetY=z.pageY;break;case"move":u.offsetX=z.pageX-v.x1,u.offsetY=z.pageY-v.y1;break;default:u.offsetX=v.x1-v.scrollLeft,u.offsetY=v.y1-v.scrollTop}var i=z.pageX-u.offsetX,w=z.pageY-u.offsetY;u.rotation=0,u.scale=1,u.startTime=u.moveTime=(new Date).getTime(),u.move={x:i,y:w},u.start={x:i,y:w},o.fingers++};o.event=e,r.defaultListener&&(o.listener=r.defaultListener,delete r.defaultListener);for(var s=!o.fingers,h=o.tracker,n=e.changedTouches||a.getCoords(e),g=n.length,m=0;g>m;m++){var l=n[m],f=l.identifier||1/0;if(o.fingers){if(o.fingers>=o.maxFingers){var d=[];for(var f in o.tracker)d.push(f);return r.identifier=d.join(","),s}var j=0;for(var q in h){if(h[q].up){delete h[q],k(l,f),o.cancel=!0;break}j++}if(h[f])continue;k(l,f)}else h=o.tracker={},r.bbox=o.bbox=a.getBoundingBox(o.target),o.fingers=0,o.cancel=!1,k(l,f)}var d=[];for(var f in o.tracker)d.push(f);return r.identifier=d.join(","),s},a.pointerEnd=function(e,p,n,j){for(var m=e.touches||[],h=m.length,o={},l=0;h>l;l++){var k=m[l],f=k.identifier;o[f||1/0]=!0}for(var f in n.tracker){var g=n.tracker[f];o[f]||g.up||(j&&j({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:"Infinity"===f?1/0:f}]},"up"),g.up=!0,n.fingers--)}if(0!==n.fingers)return!1;var d=[];n.gestureFingers=0;for(var f in n.tracker)n.gestureFingers++,d.push(f);return p.identifier=d.join(","),!0},a.getCoords=function(d){return"undefined"!=typeof d.pageX?a.getCoords=function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||1/0})}:a.getCoords=function(e){var f=document.documentElement;return e=e||window.event,Array({type:"mouse",x:e.clientX+f.scrollLeft,y:e.clientY+f.scrollTop,pageX:e.clientX+f.scrollLeft,pageY:e.clientY+f.scrollTop,identifier:1/0})},a.getCoords(d)},a.getCoord=function(f){if("ontouchstart"in window){var e=0,d=0;a.getCoord=function(g){var h=g.changedTouches;return h&&h.length?{x:e=h[0].pageX,y:d=h[0].pageY}:{x:e,y:d}}}else"undefined"!=typeof f.pageX&&"undefined"!=typeof f.pageY?a.getCoord=function(g){return{x:g.pageX,y:g.pageY}}:a.getCoord=function(g){var h=document.documentElement;return g=g||window.event,{x:g.clientX+h.scrollLeft,y:g.clientY+h.scrollTop}};return a.getCoord(f)};var c=function(e,d){var f=parseFloat(e.getPropertyValue(d),10);return isFinite(f)?f:0};return a.getBoundingBox=function(g){g!==window&&g!==document||(g=document.body);var n={},m=g.getBoundingClientRect();n.width=m.width,n.height=m.height,n.x1=m.left,n.y1=m.top,n.scaleX=m.width/g.offsetWidth||1,n.scaleY=m.height/g.offsetHeight||1,n.scrollLeft=0,n.scrollTop=0;var f=window.getComputedStyle(g),e="border-box"===f.getPropertyValue("box-sizing");if(e===!1){var h=c(f,"border-left-width"),l=c(f,"border-right-width"),d=c(f,"border-bottom-width"),k=c(f,"border-top-width");n.border=[h,l,k,d],n.x1+=h,n.y1+=k,n.width-=l+h,n.height-=d+k}n.x2=n.x1+n.width,n.y2=n.y1+n.height;for(var j=f.getPropertyValue("position"),i="fixed"===j?g:g.parentNode;null!==i&&i!==document.body&&void 0!==i.scrollTop;){var f=window.getComputedStyle(i),j=f.getPropertyValue("position");if("absolute"===j);else{if("fixed"===j){n.scrollTop-=i.parentNode.scrollTop,n.scrollLeft-=i.parentNode.scrollLeft;break}n.scrollLeft+=i.scrollLeft,n.scrollTop+=i.scrollTop}i=i.parentNode}return n.scrollBodyLeft=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n.scrollBodyTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,n.scrollLeft-=n.scrollBodyLeft,n.scrollTop-=n.scrollBodyTop,n},function(){var d,e=navigator.userAgent.toLowerCase(),f=-1!==e.indexOf("macintosh");d=f&&-1!==e.indexOf("khtml")?{91:!0,93:!0}:f&&-1!==e.indexOf("firefox")?{224:!0}:{17:!0},(a.metaTrackerReset=function(){eventjs.fnKey=a.fnKey=!1,eventjs.metaKey=a.metaKey=!1,eventjs.escKey=a.escKey=!1,eventjs.ctrlKey=a.ctrlKey=!1,eventjs.shiftKey=a.shiftKey=!1,eventjs.altKey=a.altKey=!1})(),a.metaTracker=function(h){var g="keydown"===h.type;27===h.keyCode&&(eventjs.escKey=a.escKey=g),d[h.keyCode]&&(eventjs.metaKey=a.metaKey=g),eventjs.ctrlKey=a.ctrlKey=h.ctrlKey,eventjs.shiftKey=a.shiftKey=h.shiftKey,eventjs.altKey=a.altKey=h.altKey}}(),a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if(eventjs.MutationObserver=function(){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=!b&&function(){var e=document.createElement("p"),c=!1,d=function(){c=!0};if(e.addEventListener)e.addEventListener("DOMAttrModified",d,!1);else{if(!e.attachEvent)return!1;e.attachEvent("onDOMAttrModified",d)}return e.setAttribute("id","target"),c}();return function(c,f){if(b){var e={subtree:!1,attributes:!0},d=new b(function(g){g.forEach(function(h){f.call(h.target,h.attributeName)})});d.observe(c,e)}else a?eventjs.add(c,"DOMAttrModified",function(g){f.call(c,g.attrName)}):"onpropertychange"in document.body&&eventjs.add(c,"propertychange",function(g){f.call(c,window.event.propertyName)})}}(),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.click=function(c){c.gesture=c.gesture||"click",c.maxFingers=c.maxFingers||c.fingers||1,c.onPointerDown=function(d){a.pointerStart(d,b,c)&&eventjs.add(c.target,"mouseup",c.onPointerUp)},c.onPointerUp=function(e){if(a.pointerEnd(e,b,c)){eventjs.remove(c.target,"mouseup",c.onPointerUp);var k=e.changedTouches||a.getCoords(e),d=k[0],l=c.bbox,f=a.getBoundingBox(c.target),g=d.pageY-f.scrollBodyTop,h=d.pageX-f.scrollBodyLeft;if(h>l.x1&&g>l.y1&&h<l.x2&&g<l.y2&&l.scrollTop===f.scrollTop){for(var j in c.tracker)break;var i=c.tracker[j];b.x=i.start.x,b.y=i.start.y,c.listener(e,b)}}};var b=a.pointerSetup(c);return b.state="click",eventjs.add(c.target,"mousedown",c.onPointerDown),b},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.click=a.click,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.dbltap=a.dblclick=function(f){f.gesture=f.gesture||"dbltap",f.maxFingers=f.maxFingers||f.fingers||1;var i,h,g,d,c,e=700;f.onPointerDown=function(k){var j=k.changedTouches||a.getCoords(k);i&&!h?(c=j[0],h=(new Date).getTime()-i):(d=j[0],i=(new Date).getTime(),h=0,clearTimeout(g),g=setTimeout(function(){i=0},e)),a.pointerStart(k,b,f)&&(eventjs.add(f.target,"mousemove",f.onPointerMove).listener(k),eventjs.add(f.target,"mouseup",f.onPointerUp))},f.onPointerMove=function(l){if(i&&!h){var j=l.changedTouches||a.getCoords(l);c=j[0]}var n=f.bbox,m=c.pageX-n.x1,k=c.pageY-n.y1;m>0&&m<n.width&&k>0&&k<n.height&&Math.abs(c.pageX-d.pageX)<=25&&Math.abs(c.pageY-d.pageY)<=25||(eventjs.remove(f.target,"mousemove",f.onPointerMove),clearTimeout(g),i=h=0)},f.onPointerUp=function(l){if(a.pointerEnd(l,b,f)&&(eventjs.remove(f.target,"mousemove",f.onPointerMove),eventjs.remove(f.target,"mouseup",f.onPointerUp)),i&&h){if(e>=h){b.state=f.gesture;for(var k in f.tracker)break;var j=f.tracker[k];b.x=j.start.x,b.y=j.start.y,f.listener(l,b)}clearTimeout(g),i=h=0}};var b=a.pointerSetup(f);return b.state="dblclick",eventjs.add(f.target,"mousedown",f.onPointerDown),b},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.dbltap=a.dbltap,eventjs.Gesture._gestureHandlers.dblclick=a.dblclick,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.dragElement=function(c,b){a.drag({event:b,target:c,position:"move",listener:function(e,d){c.style.left=d.x+"px",c.style.top=d.y+"px",eventjs.prevent(e)}})},a.drag=function(c){c.gesture="drag",c.onPointerDown=function(d){a.pointerStart(d,b,c)&&(c.monitor||(eventjs.add(c.doc,"mousemove",c.onPointerMove),eventjs.add(c.doc,"mouseup",c.onPointerUp))),c.onPointerMove(d,"down")},c.onPointerMove=function(e,d){if(!c.tracker)return c.onPointerDown(e);for(var j=(c.bbox,e.changedTouches||a.getCoords(e)),f=j.length,h=0;f>h;h++){var g=j[h],k=g.identifier||1/0,m=c.tracker[k];m&&(m.pageX=g.pageX,m.pageY=g.pageY,b.state=d||"move",b.identifier=k,b.start=m.start,b.fingers=c.fingers,"differenceFromLast"===c.position?(b.x=m.pageX-m.offsetX,b.y=m.pageY-m.offsetY,m.offsetX=m.pageX,m.offsetY=m.pageY):(b.x=m.pageX-m.offsetX,b.y=m.pageY-m.offsetY),c.listener(e,b))}},c.onPointerUp=function(d){a.pointerEnd(d,b,c,c.onPointerMove)&&(c.monitor||(eventjs.remove(c.doc,"mousemove",c.onPointerMove),eventjs.remove(c.doc,"mouseup",c.onPointerUp)))};var b=a.pointerSetup(c);return c.event?c.onPointerDown(c.event):(eventjs.add(c.target,"mousedown",c.onPointerDown),c.monitor&&(eventjs.add(c.doc,"mousemove",c.onPointerMove),eventjs.add(c.doc,"mouseup",c.onPointerUp))),b},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.drag=a.drag,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(b){var c=Math.PI/180,a=function(g,h){var f=0,e=0,i=0;for(var d in h){var j=h[d];j.up||(f+=j.move.x,e+=j.move.y,i++)}return g.x=f/=i,g.y=e/=i,g};return b.gesture=function(e){e.gesture=e.gesture||"gesture",e.minFingers=e.minFingers||e.fingers||2,e.onPointerDown=function(i){var g=e.fingers;if(b.pointerStart(i,d,e)&&(eventjs.add(e.doc,"mousemove",e.onPointerMove),eventjs.add(e.doc,"mouseup",e.onPointerUp)),e.fingers===e.minFingers&&g!==e.fingers){d.fingers=e.minFingers,d.scale=1,d.rotation=0,d.state="start";var f="";for(var h in e.tracker)f+=h;d.identifier=parseInt(f),a(d,e.tracker),e.listener(i,d)}},e.onPointerMove=function(s,l){for(var f=e.bbox,u=e.tracker,p=s.changedTouches||b.getCoords(s),g=p.length,v=0;g>v;v++){var m=p[v],j=m.identifier||1/0,q=u[j];q&&(q.move.x=m.pageX-f.x1,q.move.y=m.pageY-f.y1)}if(!(e.fingers<e.minFingers)){var p=[],x=0,r=0;a(d,u);for(var j in u){var m=u[j];if(!m.up){var k=m.start;if(!k.distance){var o=k.x-d.x,n=k.y-d.y;k.distance=Math.sqrt(o*o+n*n),k.angle=Math.atan2(o,n)/c}var o=m.move.x-d.x,n=m.move.y-d.y,h=Math.sqrt(o*o+n*n);x+=h/k.distance;var w=Math.atan2(o,n)/c,t=(k.angle-w+360)%360-180;m.DEG2=m.DEG1,m.DEG1=t>0?t:-t,"undefined"!=typeof m.DEG2&&(t>0?m.rotation+=m.DEG1-m.DEG2:m.rotation-=m.DEG1-m.DEG2,r+=m.rotation),p.push(m.move)}}d.touches=p,d.fingers=e.fingers,d.scale=x/e.fingers,d.rotation=r/e.fingers,d.state="change",e.listener(s,d)}},e.onPointerUp=function(g){var f=e.fingers;b.pointerEnd(g,d,e)&&(eventjs.remove(e.doc,"mousemove",e.onPointerMove),eventjs.remove(e.doc,"mouseup",e.onPointerUp)),f===e.minFingers&&e.fingers<e.minFingers&&(d.fingers=e.fingers,d.state="end",e.listener(g,d))};var d=b.pointerSetup(e);return eventjs.add(e.target,"mousedown",e.onPointerDown),d},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.gesture=b.gesture,b}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.pointerdown=a.pointermove=a.pointerup=function(d){if(d.gesture=d.gesture||"pointer",!d.target.isPointerEmitter){var b=!0;d.onPointerDown=function(e){b=!1,c.gesture="pointerdown",d.listener(e,c)},d.onPointerMove=function(e){c.gesture="pointermove",d.listener(e,c,b)},d.onPointerUp=function(e){b=!0,c.gesture="pointerup",d.listener(e,c,!0)};var c=a.pointerSetup(d);return eventjs.add(d.target,"mousedown",d.onPointerDown),eventjs.add(d.target,"mousemove",d.onPointerMove),eventjs.add(d.doc,"mouseup",d.onPointerUp),d.target.isPointerEmitter=!0,c}},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.pointerdown=a.pointerdown,eventjs.Gesture._gestureHandlers.pointermove=a.pointermove,eventjs.Gesture._gestureHandlers.pointerup=a.pointerup,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.shake=function(f){var k={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",e,!1)}},d=4,g=1e3,h=200,b=3,c=(new Date).getTime(),j={x:0,y:0,z:0},i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},e=function(w){var s=.8,m=w.accelerationIncludingGravity;if(j.x=s*j.x+(1-s)*m.x,j.y=s*j.y+(1-s)*m.y,j.z=s*j.z+(1-s)*m.z,k.accelerationIncludingGravity=j,k.acceleration.x=m.x-j.x,k.acceleration.y=m.y-j.y,k.acceleration.z=m.z-j.z,"devicemotion"===f.gesture)return void f.listener(w,k);for(var t="xyz",l=(new Date).getTime(),q=0,p=t.length;p>q;q++){var r=t[q],v=k.acceleration[r],u=i[r],z=Math.abs(v);if(!(g>l-c)&&z>d){var y=l*v/z,x=Math.abs(y+u.value);u.value&&h>x?(u.value=y,u.count++,u.count===b&&(f.listener(w,k),c=l,u.value=0,u.count=0)):(u.value=y,u.count=1)}}};return window.addEventListener?(window.addEventListener("devicemotion",e,!1),k):void 0},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.shake=a.shake,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){var b=Math.PI/180;return a.swipe=function(d){d.snap=d.snap||90,d.threshold=d.threshold||1,d.gesture=d.gesture||"swipe",d.onPointerDown=function(e){a.pointerStart(e,c,d)&&(eventjs.add(d.doc,"mousemove",d.onPointerMove).listener(e),eventjs.add(d.doc,"mouseup",d.onPointerUp))},d.onPointerMove=function(h){for(var j=h.changedTouches||a.getCoords(h),g=j.length,f=0;g>f;f++){var l=j[f],e=l.identifier||1/0,k=d.tracker[e];k&&(k.move.x=l.pageX,k.move.y=l.pageY,k.moveTime=(new Date).getTime())}},d.onPointerUp=function(g){if(a.pointerEnd(g,c,d)){eventjs.remove(d.doc,"mousemove",d.onPointerMove),eventjs.remove(d.doc,"mouseup",d.onPointerUp);var r,q,m,j,i={x:0,y:0},t=0,s=0,l=0;for(var h in d.tracker){var p=d.tracker[h],n=p.move.x-p.start.x,k=p.move.y-p.start.y;t+=p.move.x,s+=p.move.y,i.x+=p.start.x,i.y+=p.start.y,l++;var f=Math.sqrt(n*n+k*k),e=p.moveTime-p.startTime,j=Math.atan2(n,k)/b+180,q=e?f/e:0;if("undefined"==typeof m)m=j,r=q;else{if(!(Math.abs(j-m)<=20))return;m=(m+j)/2,r=(r+q)/2}}var o=d.gestureFingers;d.minFingers<=o&&d.maxFingers>=o&&r>d.threshold&&(i.x/=l,i.y/=l,c.start=i,c.x=t/l,c.y=s/l,c.angle=-(((m/d.snap+.5>>0)*d.snap||360)-360),c.velocity=r,c.fingers=o,c.state="swipe",d.listener(g,c))}};var c=a.pointerSetup(d);return eventjs.add(d.target,"mousedown",d.onPointerDown),c},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.swipe=a.swipe,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.longpress=function(b){return b.gesture="longpress",a.tap(b)},a.tap=function(c){c.delay=c.delay||500,c.timeout=c.timeout||250,c.driftDeviance=c.driftDeviance||10,c.gesture=c.gesture||"tap";var e,d;c.onPointerDown=function(f){if(a.pointerStart(f,b,c)){if(e=(new Date).getTime(),eventjs.add(c.doc,"mousemove",c.onPointerMove).listener(f),eventjs.add(c.doc,"mouseup",c.onPointerUp),"longpress"!==c.gesture)return;d=setTimeout(function(){if(!(f.cancelBubble&&++f.cancelBubbleCount>1)){var h=0;for(var i in c.tracker){var g=c.tracker[i];if(g.end===!0)return;if(c.cancel)return;h++}c.minFingers<=h&&c.maxFingers>=h&&(b.state="start",b.fingers=h,b.x=g.start.x,b.y=g.start.y,c.listener(f,b))}},c.delay)}},c.onPointerMove=function(g){for(var p=c.bbox,l=g.changedTouches||a.getCoords(g),h=l.length,k=0;h>k;k++){var j=l[k],m=j.identifier||1/0,s=c.tracker[m];if(s){var o=j.pageX-p.x1,n=j.pageY-p.y1,r=o-s.start.x,q=n-s.start.y,f=Math.sqrt(r*r+q*q);if(!(o>0&&o<p.width&&n>0&&n<p.height&&f<=c.driftDeviance))return eventjs.remove(c.doc,"mousemove",c.onPointerMove),void(c.cancel=!0)}}},c.onPointerUp=function(g){if(a.pointerEnd(g,b,c)){if(clearTimeout(d),eventjs.remove(c.doc,"mousemove",c.onPointerMove),eventjs.remove(c.doc,"mouseup",c.onPointerUp),g.cancelBubble&&++g.cancelBubbleCount>1)return;if("longpress"===c.gesture)return void("start"===b.state&&(b.state="end",c.listener(g,b)));if(c.cancel)return;if((new Date).getTime()-e>c.timeout)return;var f=c.gestureFingers;c.minFingers<=f&&c.maxFingers>=f&&(b.state="tap",b.fingers=c.gestureFingers,c.listener(g,b))}};var b=a.pointerSetup(c);return eventjs.add(c.target,"mousedown",c.onPointerDown),b},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.tap=a.tap,eventjs.Gesture._gestureHandlers.longpress=a.longpress,a}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(a){return a.wheelPreventElasticBounce=function(b){b&&("string"==typeof b&&(b=document.querySelector(b)),eventjs.add(b,"wheel",function(d,c){c.preventElasticBounce(),eventjs.stop(d)}))},a.wheel=function(f){var c,h=f.timeout||150,e=0,j={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,preventElasticBounce:function(l){var o=this.target,n=o.scrollTop,m=n+o.offsetHeight,k=o.scrollHeight;m===k&&this.wheelDelta<=0?eventjs.cancel(l):0===n&&this.wheelDelta>=0&&eventjs.cancel(l),eventjs.stop(l)},add:function(){f.target[i](g,b,!1)},remove:function(){f.target[d](g,b,!1)}},b=function(k){k=k||window.event,j.state=e++?"change":"start",j.wheelDelta=k.detail?-20*k.detail:k.wheelDelta,f.listener(k,j),clearTimeout(c),c=setTimeout(function(){e=0,j.state="end",j.wheelDelta=0,f.listener(k,j)},h)},i=document.addEventListener?"addEventListener":"attachEvent",d=document.removeEventListener?"removeEventListener":"detachEvent",g=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";return f.target[i](g,b,!1),j},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.wheel=a.wheel,a}(eventjs.proxy),"undefined"==typeof Event)var Event={};"undefined"==typeof Event.proxy&&(Event.proxy={}),Event.proxy=function(a){return a.orientation=function(c){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:c.target,listener:c.listener,remove:function(){window.removeEventListener("orientationchange",d,!1)}},d=function(f){return b.previous=b.current,b.current=window.orientation,null!==b.previous&&b.previous!=b.current?void c.listener(f,b):void 0};return window.DeviceOrientationEvent&&window.addEventListener("orientationchange",d,!1),b},Event.Gesture=Event.Gesture||{},Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{},Event.Gesture._gestureHandlers.orientation=a.orientation,a}(Event.proxy),function(){function d(e,f){this.__eventListeners[e]&&(f?fabric.util.removeFromArray(this.__eventListeners[e],f):this.__eventListeners[e].length=0)}function c(e,f){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var g in e)this.on(g,e[g]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(f);return this}function a(e,f){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var g in e)d.call(this,g,e[g]);else d.call(this,e,f);return this}}function b(g,h){if(this.__eventListeners){var f=this.__eventListeners[g];if(f){for(var j=0,e=f.length;e>j;j++)f[j].call(this,h||{});return this}}}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;b>a;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(b,a,d){var c=this.getObjects();return d?c[a]=b:c.splice(a,0,b),this._onObjectAdded(b),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var a,d=this.getObjects(),b=0,c=arguments.length;c>b;b++)a=d.indexOf(arguments[b]),-1!==a&&(d.splice(a,1),this._onObjectRemoved(arguments[b]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(d,b){for(var c=this.getObjects(),a=c.length;a--;)d.call(b,c[a],a,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},function(c){var d=Math.sqrt,b=Math.atan2,a=Math.PI/180;fabric.util={removeFromArray:function(g,f){var e=g.indexOf(f);return-1!==e&&g.splice(e,1),g},getRandomInt:function(f,e){return Math.floor(Math.random()*(e-f+1))+f},degreesToRadians:function(e){return e*a},radiansToDegrees:function(e){return e/a},rotatePoint:function(e,g,k){var f=Math.sin(k),i=Math.cos(k);e.subtractEquals(g);var j=e.x*i-e.y*f,h=e.x*f+e.y*i;return new fabric.Point(j,h).addEquals(g)},transformPoint:function(g,f,e){return e?new fabric.Point(f[0]*g.x+f[2]*g.y,f[1]*g.x+f[3]*g.y):new fabric.Point(f[0]*g.x+f[2]*g.y+f[4],f[1]*g.x+f[3]*g.y+f[5])},invertTransform:function(f){var g=f.slice(),e=1/(f[0]*f[3]-f[1]*f[2]);g=[e*f[3],-e*f[1],-e*f[2],e*f[0],0,0];var h=fabric.util.transformPoint({x:f[4],y:f[5]},g);return g[4]=-h.x,g[5]=-h.y,g},toFixed:function(f,e){return parseFloat(Number(f).toFixed(e))},parseUnit:function(h,g){var f=/\D{0,2}$/.exec(h),e=parseFloat(h);switch(g||(g=fabric.Text.DEFAULT_SVG_FONT_SIZE),f[0]){case"mm":return e*fabric.DPI/25.4;case"cm":return e*fabric.DPI/2.54;case"in":return e*fabric.DPI;case"pt":return e*fabric.DPI/72;case"pc":return e*fabric.DPI/72*12;case"em":return e*g;default:return e}},falseFunction:function(){return!1},getKlass:function(f,e){return f=fabric.util.string.camelize(f.charAt(0).toUpperCase()+f.slice(1)),fabric.util.resolveNamespace(e)[f]},resolveNamespace:function(g){if(!g)return fabric;for(var j=g.split("."),e=j.length,h=c||fabric.window,f=0;e>f;++f)h=h[j[f]];return h},loadImage:function(g,i,h,f){if(!g)return void(i&&i.call(h,g));var e=fabric.util.createImage();e.onload=function(){i&&i.call(h,e),e=e.onload=e.onerror=null},e.onerror=function(){fabric.log("Error loading "+e.src),i&&i.call(h,null,!0),e=e.onload=e.onerror=null},0!==g.indexOf("data")&&"undefined"!=typeof f&&(e.crossOrigin=f),
e.src=g},enlivenObjects:function(i,l,g,f){function h(){++k===e&&l&&l(j)}i=i||[];var j=[],k=0,e=i.length;return e?void i.forEach(function(p,n){if(!p||!p.type)return void h();var m=fabric.util.getKlass(p.type,g);m.async?m.fromObject(p,function(q,o){o||(j[n]=q,f&&f(p,j[n])),h()}):(j[n]=m.fromObject(p),f&&f(p,j[n]),h())}):void(l&&l(j))},groupSVGElements:function(g,f,h){var e;return e=new fabric.PathGroup(g,f),"undefined"!=typeof h&&e.setSourcePath(h),e},populateWithProperties:function(j,f,h){if(h&&"[object Array]"===Object.prototype.toString.call(h))for(var g=0,e=h.length;e>g;g++)h[g]in j&&(f[h[g]]=j[h[g]])},drawDashedLine:function(n,l,i,e,j,p){var q=e-l,o=j-i,g=d(q*q+o*o),f=b(o,q),m=p.length,h=0,k=!0;for(n.save(),n.translate(l,i),n.moveTo(0,0),n.rotate(f),l=0;g>l;)l+=p[h++%m],l>g&&(l=g),n[k?"lineTo":"moveTo"](l,0),k=!k;n.restore()},createCanvasElement:function(e){return e||(e=fabric.document.createElement("canvas")),e.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(e),e},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(e){for(var j=e.prototype,g=j.stateProperties.length;g--;){var k=j.stateProperties[g],l=k.charAt(0).toUpperCase()+k.slice(1),f="set"+l,h="get"+l;j[h]||(j[h]=function(i){return new Function('return this.get("'+i+'")')}(k)),j[f]||(j[f]=function(i){return new Function("value",'return this.set("'+i+'", value)')}(k))}},clipContext:function(f,e){e.save(),e.beginPath(),f.clipTo(e),e.clip()},multiplyTransformMatrices:function(f,e){return[f[0]*e[0]+f[2]*e[1],f[1]*e[0]+f[3]*e[1],f[0]*e[2]+f[2]*e[3],f[1]*e[2]+f[3]*e[3],f[0]*e[4]+f[2]*e[5]+f[4],f[1]*e[4]+f[3]*e[5]+f[5]]},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(o,m,k,j){j>0&&(m>j?m-=j:m=0,k>j?k-=j:k=0);for(var f=!0,e=o.getImageData(m,k,2*j||1,2*j||1),h=3,g=e.data.length;g>h;h+=4){var n=e.data[h];if(f=0>=n,f===!1)break}return e=null,f}}}("undefined"!=typeof exports?exports:this),function(){function g(m,k,r,q,j,B,w){var S=d.call(arguments);if(b[S])return b[S];var I=Math.PI,t=w*I/180,O=Math.sin(t),H=Math.cos(t),C=0,z=0;r=Math.abs(r),q=Math.abs(q);var G=-H*m*.5-O*k*.5,D=-H*k*.5+O*m*.5,P=r*r,p=q*q,l=D*D,L=G*G,N=P*p-P*l-p*L,K=0;if(0>N){var A=Math.sqrt(1-N/(P*p));r*=A,q*=A}else K=(j===B?-1:1)*Math.sqrt(N/(P*l+p*L));var o=K*r*D/q,n=-K*q*G/r,F=H*o-O*n+.5*m,Q=O*o+H*n+.5*k,R=e(1,0,(G-o)/r,(D-n)/q),E=e((G-o)/r,(D-n)/q,(-G-o)/r,(-D-n)/q);0===B&&E>0?E-=2*I:1===B&&0>E&&(E+=2*I);for(var J=Math.ceil(Math.abs(E/I*2)),v=[],y=E/J,u=8/3*Math.sin(y/4)*Math.sin(y/4)/Math.sin(y/2),x=R+y,M=0;J>M;M++)v[M]=f(R,x,H,O,r,q,F,Q,u,C,z),C=v[M][4],z=v[M][5],R=x,x+=y;return b[S]=v,v}function f(t,r,x,B,o,n,w,D,p,v,u){var k=d.call(arguments);if(c[k])return c[k];var m=Math.cos(t),z=Math.sin(t),l=Math.cos(r),y=Math.sin(r),j=x*o*l-B*n*y+w,i=B*o*l+x*n*y+D,s=v+p*(-x*o*z-B*n*m),q=u+p*(-B*o*z+x*n*m),C=j+p*(x*o*y+B*n*l),A=i+p*(B*o*y-x*n*l);return c[k]=[s,q,C,A,j,i],c[k]}function e(l,k,n,m){var j=Math.atan2(k,l),i=Math.atan2(m,n);return i>=j?i-j:2*Math.PI-(j-i)}function a(L,o,K,m,J,l,I,k){var Q=d.call(arguments);if(h[Q])return h[Q];var O,N,M,z,v,s,n,q,P=Math.sqrt,E=Math.min,H=Math.max,B=Math.abs,C=[],p=[[],[]];N=6*L-12*K+6*J,O=-3*L+9*K-9*J+3*I,M=3*K-3*L;for(var G=0;2>G;++G)if(G>0&&(N=6*o-12*m+6*l,O=-3*o+9*m-9*l+3*k,M=3*m-3*o),B(O)<1e-12){if(B(N)<1e-12)continue;z=-M/N,z>0&&1>z&&C.push(z)}else n=N*N-4*M*O,0>n||(q=P(n),v=(-N+q)/(2*O),v>0&&1>v&&C.push(v),s=(-N-q)/(2*O),s>0&&1>s&&C.push(s));for(var u,r,D,F=C.length,A=F;F--;)z=C[F],D=1-z,u=D*D*D*L+3*D*D*z*K+3*D*z*z*J+z*z*z*I,p[0][F]=u,r=D*D*D*o+3*D*D*z*m+3*D*z*z*l+z*z*z*k,p[1][F]=r;p[0][A]=L,p[1][A]=o,p[0][A+1]=I,p[1][A+1]=k;var w=[{x:E.apply(null,p[0]),y:E.apply(null,p[1])},{x:H.apply(null,p[0]),y:H.apply(null,p[1])}];return h[Q]=w,w}var b={},c={},h={},d=Array.prototype.join;fabric.util.drawArc=function(x,p,o,u){for(var m=u[0],j=u[1],n=u[2],v=u[3],w=u[4],s=u[5],q=u[6],l=[[],[],[],[]],k=g(s-p,q-o,m,j,v,w,n),r=0,t=k.length;t>r;r++)l[r][0]=k[r][0]+p,l[r][1]=k[r][1]+o,l[r][2]=k[r][2]+p,l[r][3]=k[r][3]+o,l[r][4]=k[r][4]+p,l[r][5]=k[r][5]+o,x.bezierCurveTo.apply(x,l[r])},fabric.util.getBoundsOfArc=function(p,o,m,k,n,y,z,u,r){for(var x=0,w=0,q=[],j=[],l=g(u-p,r-o,m,k,y,z,n),t=[[],[]],s=0,v=l.length;v>s;s++)q=a(x,w,l[s][0],l[s][1],l[s][2],l[s][3],l[s][4],l[s][5]),t[0].x=q[0].x+p,t[0].y=q[0].y+o,t[1].x=q[1].x+p,t[1].y=q[1].y+o,j.push(t[0]),j.push(t[1]),x=l[s][4],w=l[s][5];return j},fabric.util.getBoundsOfCurve=a}(),function(){function b(l,k){for(var h=e.call(arguments,2),g=[],j=0,f=l.length;f>j;j++)g[j]=h.length?l[j][k].apply(l[j],h):l[j][k].call(l[j]);return g}function a(g,f){return d(g,f,function(i,h){return i>=h})}function c(g,f){return d(g,f,function(i,h){return h>i})}function d(k,h,j){if(k&&0!==k.length){var g=k.length-1,f=h?k[g][h]:k[g];if(h)for(;g--;)j(k[g][h],f)&&(f=k[g][h]);else for(;g--;)j(k[g],f)&&(f=k[g]);return f}}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(h){if(void 0===this||null===this)throw new TypeError;var i=Object(this),f=i.length>>>0;if(0===f)return-1;var j=0;if(arguments.length>0&&(j=Number(arguments[1]),j!==j?j=0:0!==j&&j!==Number.POSITIVE_INFINITY&&j!==Number.NEGATIVE_INFINITY&&(j=(j>0||-1)*Math.floor(Math.abs(j)))),j>=f)return-1;for(var g=j>=0?j:Math.max(f-Math.abs(j),0);f>g;g++)if(g in i&&i[g]===h)return g;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(j,h){for(var g=0,f=this.length>>>0;f>g;g++)g in this&&j.call(h,this[g],g,this)}),Array.prototype.map||(Array.prototype.map=function(k,j){for(var g=[],h=0,f=this.length>>>0;f>h;h++)h in this&&(g[h]=k.call(j,this[h],h,this));return g}),Array.prototype.every||(Array.prototype.every=function(j,h){for(var g=0,f=this.length>>>0;f>g;g++)if(g in this&&!j.call(h,this[g],g,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(j,h){for(var g=0,f=this.length>>>0;f>g;g++)if(g in this&&j.call(h,this[g],g,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(k,j){for(var l,g=[],h=0,f=this.length>>>0;f>h;h++)h in this&&(l=this[h],k.call(j,l,h,this)&&g.push(l));return g}),Array.prototype.reduce||(Array.prototype.reduce=function(h){var j,f=this.length>>>0,g=0;if(arguments.length>1)j=arguments[1];else for(;;){if(g in this){j=this[g++];break}if(++g>=f)throw new TypeError}for(;f>g;g++)g in this&&(j=h.call(null,j,this[g],g,this));return j}),fabric.util.array={invoke:b,min:c,max:a}}(),function(){function b(c,e){for(var d in e)c[d]=e[d];return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}}(),function(){function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d,e){return d.charAt(0).toUpperCase()+(e?d.slice(1):d.slice(1).toLowerCase())}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}(),function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var f,g=this,e=c.call(arguments,1);return f=e.length?function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}:function(){return a.call(g,this instanceof b?this:d,arguments)},b.prototype=this.prototype,f.prototype=new b,f})}(),function(){function b(){}function a(h){var i=this.constructor.superclass.prototype[h];return arguments.length>1?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){function h(){this.initialize.apply(this,arguments)}var l=null,k=g.call(arguments,0);"function"==typeof k[0]&&(l=k.shift()),h.superclass=l,h.subclasses=[],l&&(b.prototype=l.prototype,h.prototype=new b,l.subclasses.push(h));for(var j=0,m=k.length;m>j;j++)c(h,k[j],l);return h.prototype.initialize||(h.prototype.initialize=f),h.prototype.constructor=h,h.prototype.callSuper=a,h}var g=Array.prototype.slice,f=function(){},d=function(){for(var h in{toString:1})if("toString"===h)return!1;return!0}(),c=function(h,k,i){for(var j in k)j in h.prototype&&"function"==typeof h.prototype[j]&&(k[j]+"").indexOf("callSuper")>-1?h.prototype[j]=function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);return this.constructor.superclass=n,"initialize"!==l?m:void 0}}(j):h.prototype[j]=k[j],d&&(k.toString!==Object.prototype.toString&&(h.prototype.toString=k.toString),k.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=k.valueOf))};fabric.util.createClass=e}(),function(){function m(u){var w,v,x=Array.prototype.slice.call(arguments,1),s=x.length;for(v=0;s>v;v++)if(w=typeof u[x[v]],!/^(?:function|object|unknown)$/.test(w))return!1;return!0}function d(s,t){return{handler:t,wrappedHandler:l(s,t)}}function l(s,t){return function(u){t.call(g(s),u||fabric.window.event)}}function f(t,s){return function(x){if(o[t]&&o[t][s])for(var v=o[t][s],w=0,u=v.length;u>w;w++)v[w].call(this,x||fabric.window.event)}}function i(v,t){v||(v=fabric.window.event);var u=v.target||(typeof v.srcElement!==r?v.srcElement:null),s=fabric.util.getScrollLeftTop(u,t);return{x:b(v)+s.left,y:a(v)+s.top}}function e(t,v,s){var u="touchend"===t.type?"changedTouches":"touches";return t[u]&&t[u][0]?t[u][0][v]-(t[u][0][v]-t[u][0][s])||t[s]:t[s]}var g,q,r="unknown",j=function(){var s=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+s++)}}();!function(){var s={};g=function(t){return s[t]},q=function(u,t){s[u]=t}}();var k,c,p=m(fabric.document.documentElement,"addEventListener","removeEventListener")&&m(fabric.window,"addEventListener","removeEventListener"),h=m(fabric.document.documentElement,"attachEvent","detachEvent")&&m(fabric.window,"attachEvent","detachEvent"),n={},o={};p?(k=function(t,s,u){t.addEventListener(s,u,!1)},c=function(t,s,u){t.removeEventListener(s,u,!1)}):h?(k=function(u,s,v){var t=j(u);q(t,u),n[t]||(n[t]={}),n[t][s]||(n[t][s]=[]);var w=d(t,v);n[t][s].push(w),u.attachEvent("on"+s,w.wrappedHandler)},c=function(w,t,x){var y,v=j(w);if(n[v]&&n[v][t])for(var u=0,s=n[v][t].length;s>u;u++)y=n[v][t][u],y&&y.handler===x&&(w.detachEvent("on"+t,y.wrappedHandler),n[v][t][u]=null)}):(k=function(u,s,v){var t=j(u);if(o[t]||(o[t]={}),!o[t][s]){o[t][s]=[];var w=u["on"+s];w&&o[t][s].push(w),u["on"+s]=f(t,s)}o[t][s].push(v)},c=function(x,u,y){var w=j(x);if(o[w]&&o[w][u])for(var t=o[w][u],v=0,s=t.length;s>v;v++)t[v]===y&&t.splice(v,1)}),fabric.util.addListener=k,fabric.util.removeListener=c;var b=function(s){return typeof s.clientX!==r?s.clientX:0},a=function(s){return typeof s.clientY!==r?s.clientY:0};fabric.isTouchSupported&&(b=function(s){return e(s,"pageX","clientX")},a=function(s){return e(s,"pageY","clientY")}),fabric.util.getPointer=i,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function d(g,i){var k=g.style;if(!k)return g;if("string"==typeof i)return g.style.cssText+=";"+i,i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g;for(var j in i)if("opacity"===j)b(g,i[j]);else{var h="float"===j||"cssFloat"===j?"undefined"==typeof k.styleFloat?"cssFloat":"styleFloat":j;k[h]=i[j]}return g}var f=fabric.document.createElement("div"),e="string"==typeof f.style.opacity,a="string"==typeof f.style.filter,c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};e?b=function(g,h){return g.style.opacity=h,g}:a&&(b=function(g,h){var i=g.style;return g.currentStyle&&!g.currentStyle.hasLayout&&(i.zoom=1),c.test(i.filter)?(h=h>=.9999?"":"alpha(opacity="+100*h+")",i.filter=i.filter.replace(c,h)):i.filter+=" alpha(opacity="+100*h+")",g}),fabric.util.setStyle=d}(),function(){function i(l){return"string"==typeof l?fabric.document.getElementById(l):l}function d(m,l){var n=fabric.document.createElement(m);for(var o in l)"class"===o?n.className=l[o]:"for"===o?n.htmlFor=l[o]:n.setAttribute(o,l[o]);return n}function h(l,m){l&&-1===(" "+l.className+" ").indexOf(" "+m+" ")&&(l.className+=(l.className?" ":"")+m)}function g(m,n,l){return"string"==typeof n&&(n=d(n,l)),m.parentNode&&m.parentNode.replaceChild(n,m),n.appendChild(m),n}function a(p,o){var q,m,s=0,r=0,n=fabric.document.documentElement,l=fabric.document.body||{scrollLeft:0,scrollTop:0};for(m=p;p&&p.parentNode&&!q;)p=p.parentNode,1===p.nodeType&&"fixed"===fabric.util.getElementStyle(p,"position")&&(q=p),1===p.nodeType&&m!==o&&"absolute"===fabric.util.getElementStyle(p,"position")?(s=0,r=0):p===fabric.document?(s=l.scrollLeft||n.scrollLeft||0,r=l.scrollTop||n.scrollTop||0):(s+=p.scrollLeft||0,r+=p.scrollTop||0);return{left:s,top:r}}function f(o){var m,q,r=o&&o.ownerDocument,p={left:0,top:0},s={left:0,top:0},n={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return{left:0,top:0};for(var l in n)s[n[l]]+=parseInt(e(o,l),10)||0;return m=r.documentElement,"undefined"!=typeof o.getBoundingClientRect&&(p=o.getBoundingClientRect()),q=fabric.util.getScrollLeftTop(o,null),{left:p.left+q.left-(m.clientLeft||0)+s.left,top:p.top+q.top-(m.clientTop||0)+s.top}}var k,j=Array.prototype.slice,c=function(l){return j.call(l,0)};try{k=c(fabric.document.childNodes)instanceof Array}catch(b){}k||(c=function(m){for(var l=new Array(m.length),n=m.length;n--;)l[n]=m[n];return l});var e;e=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(m,l){var n=fabric.document.defaultView.getComputedStyle(m,null);return n?n[l]:void 0}:function(m,l){var n=m.style[l];return!n&&m.currentStyle&&(n=m.currentStyle[l]),n},function(){function o(p){return"undefined"!=typeof p.onselectstart&&(p.onselectstart=fabric.util.falseFunction),n?p.style[n]="none":"string"==typeof p.unselectable&&(p.unselectable="on"),p}function l(p){return"undefined"!=typeof p.onselectstart&&(p.onselectstart=null),n?p.style[n]="":"string"==typeof p.unselectable&&(p.unselectable=""),p}var m=fabric.document.documentElement.style,n="userSelect"in m?"userSelect":"MozUserSelect"in m?"MozUserSelect":"WebkitUserSelect"in m?"WebkitUserSelect":"KhtmlUserSelect"in m?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=o,fabric.util.makeElementSelectable=l}(),function(){function l(m,q){var o=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),p=!0;n.onload=n.onreadystatechange=function(r){if(p){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;p=!1,q(r||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=m,o.appendChild(n)}fabric.util.getScript=l}(),fabric.util.getById=i,fabric.util.toArray=c,fabric.util.makeElement=d,fabric.util.addClass=h,fabric.util.wrapElement=g,fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=f,fabric.util.getElementStyle=e}(),function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}function a(){}function b(g,f){f||(f={});var e,j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c();return i.onreadystatechange=function(){4===i.readyState&&(h(i),i.onreadystatechange=a)},"GET"===j&&(e=null,"string"==typeof f.parameters&&(g=d(g,f.parameters))),i.open(j,g,!0),"POST"!==j&&"PUT"!==j||i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e),i}var c=function(){for(var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=h.length;e--;)try{var g=h[e]();if(g)return h[e]}catch(f){}}();fabric.util.request=b}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&"function"==typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(d){b(function(k){d||(d={});var g,f=k||+new Date,h=d.duration||500,o=f+h,l=d.onChange||function(){},i=d.abort||function(){return!1},m=d.easing||function(r,q,u,s){return-u*Math.cos(r/s*(Math.PI/2))+u+q},e="startValue"in d?d.startValue:0,n="endValue"in d?d.endValue:100,p=d.byValue||n-e;d.onStart&&d.onStart(),function j(q){g=q||+new Date;var r=g>o?h:g-f;return i()?void(d.onComplete&&d.onComplete()):(l(m(r,e,p,h)),g>o?void(d.onComplete&&d.onComplete()):void b(j))}(f)})}function b(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1e3/60)};fabric.util.animate=a,fabric.util.requestAnimFrame=b}(),function(){function y(C,F,E,D){return C<Math.abs(F)?(C=F,D=E/4):D=E/(2*Math.PI)*Math.asin(F/C),{a:C,c:F,p:E,s:D}}function p(D,C,E){return D.a*Math.pow(2,10*(C-=1))*Math.sin((C*E-D.s)*(2*Math.PI)/D.p)}function o(D,C,F,E){return F*((D=D/E-1)*D*D+1)+C}function s(D,C,F,E){return D/=E/2,1>D?F/2*D*D*D+C:F/2*((D-=2)*D*D+2)+C}function r(D,C,F,E){return F*(D/=E)*D*D*D+C}function f(D,C,F,E){return-F*((D=D/E-1)*D*D*D-1)+C}function j(D,C,F,E){return D/=E/2,1>D?F/2*D*D*D*D+C:-F/2*((D-=2)*D*D*D-2)+C}function w(D,C,F,E){return F*(D/=E)*D*D*D*D+C}function i(D,C,F,E){return F*((D=D/E-1)*D*D*D*D+1)+C}function l(D,C,F,E){return D/=E/2,1>D?F/2*D*D*D*D*D+C:F/2*((D-=2)*D*D*D*D+2)+C}function e(D,C,F,E){return-F*Math.cos(D/E*(Math.PI/2))+F+C}function m(D,C,F,E){return F*Math.sin(D/E*(Math.PI/2))+C}function t(D,C,F,E){return-F/2*(Math.cos(Math.PI*D/E)-1)+C}function B(D,C,F,E){return 0===D?C:F*Math.pow(2,10*(D/E-1))+C}function c(D,C,F,E){return D===E?C+F:F*(-Math.pow(2,-10*D/E)+1)+C}function h(D,C,F,E){return 0===D?C:D===E?C+F:(D/=E/2,1>D?F/2*Math.pow(2,10*(D-1))+C:F/2*(-Math.pow(2,-10*--D)+2)+C)}function g(D,C,F,E){return-F*(Math.sqrt(1-(D/=E)*D)-1)+C}function n(D,C,F,E){return F*Math.sqrt(1-(D=D/E-1)*D)+C}function v(D,C,F,E){return D/=E/2,1>D?-F/2*(Math.sqrt(1-D*D)-1)+C:F/2*(Math.sqrt(1-(D-=2)*D)+1)+C}function q(E,C,J,I){var F=1.70158,H=0,D=J;if(0===E)return C;if(E/=I,1===E)return C+J;H||(H=.3*I);var G=y(D,J,H,F);return-p(G,E,I)+C}function x(E,C,J,I){var F=1.70158,H=0,D=J;if(0===E)return C;if(E/=I,1===E)return C+J;H||(H=.3*I);var G=y(D,J,H,F);return G.a*Math.pow(2,-10*E)*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)+G.c+C}function a(E,C,J,I){var F=1.70158,H=0,D=J;if(0===E)return C;if(E/=I/2,2===E)return C+J;H||(H=I*(.3*1.5));var G=y(D,J,H,F);return 1>E?-.5*p(G,E,I)+C:G.a*Math.pow(2,-10*(E-=1))*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)*.5+G.c+C}function k(D,C,G,F,E){return void 0===E&&(E=1.70158),G*(D/=F)*D*((E+1)*D-E)+C}function u(D,C,G,F,E){return void 0===E&&(E=1.70158),G*((D=D/F-1)*D*((E+1)*D+E)+1)+C}function z(D,C,G,F,E){return void 0===E&&(E=1.70158),D/=F/2,1>D?G/2*(D*D*(((E*=1.525)+1)*D-E))+C:G/2*((D-=2)*D*(((E*=1.525)+1)*D+E)+2)+C}function d(D,C,F,E){return F-b(E-D,0,F,E)+C}function b(D,C,F,E){return(D/=E)<1/2.75?F*(7.5625*D*D)+C:2/2.75>D?F*(7.5625*(D-=1.5/2.75)*D+.75)+C:2.5/2.75>D?F*(7.5625*(D-=2.25/2.75)*D+.9375)+C:F*(7.5625*(D-=2.625/2.75)*D+.984375)+C}function A(D,C,F,E){return E/2>D?.5*d(2*D,0,F,E)+C:.5*b(2*D-E,0,F,E)+.5*F+C}fabric.util.ease={easeInQuad:function(D,C,F,E){return F*(D/=E)*D+C},easeOutQuad:function(D,C,F,E){return-F*(D/=E)*(D-2)+C},easeInOutQuad:function(D,C,F,E){return D/=E/2,1>D?F/2*D*D+C:-F/2*(--D*(D-2)-1)+C},easeInCubic:function(D,C,F,E){return F*(D/=E)*D*D+C},easeOutCubic:o,easeInOutCubic:s,easeInQuart:r,easeOutQuart:f,easeInOutQuart:j,easeInQuint:w,easeOutQuint:i,easeInOutQuint:l,easeInSine:e,easeOutSine:m,easeInOutSine:t,easeInExpo:B,easeOutExpo:c,easeInOutExpo:h,easeInCirc:g,easeOutCirc:n,easeInOutCirc:v,easeInElastic:q,easeOutElastic:x,easeInOutElastic:a,easeInBack:k,easeOutBack:u,easeInOutBack:z,easeInBounce:d,easeOutBounce:b,easeInOutBounce:A}}(),function(s){function a(B){return B in v?v[B]:B}function h(B,G,E,F){var D,C="[object Array]"===Object.prototype.toString.call(G);return"fill"!==B&&"stroke"!==B||"none"!==G?"strokeDashArray"===B?G=G.replace(/,/g," ").split(/\s+/).map(function(H){return parseFloat(H)}):"transformMatrix"===B?G=E&&E.transformMatrix?u(E.transformMatrix,o.parseTransformAttribute(G)):o.parseTransformAttribute(G):"visible"===B?(G="none"!==G&&"hidden"!==G,E&&E.visible===!1&&(G=!1)):"originX"===B?G="start"===G?"left":"end"===G?"right":"center":D=C?G.map(q):q(G,F):G="",!C&&isNaN(D)?G:D}function c(D){for(var B in g)if(D[B]&&"undefined"!=typeof D[g[B]]&&0!==D[B].indexOf("url(")){var C=new o.Color(D[B]);D[B]=C.setAlpha(n(C.getAlpha()*D[g[B]],2)).toRgba()}return D}function p(D,C){var B,E;D.replace(/;$/,"").split(";").forEach(function(F){var G=F.split(":");B=a(G[0].trim().toLowerCase()),E=h(B,G[1].trim()),C[B]=E})}function m(D,C){var B,E;for(var F in D)"undefined"!=typeof D[F]&&(B=a(F.toLowerCase()),E=h(B,D[F]),C[B]=E)}function x(C,B){var D={};for(var F in o.cssRules[B])if(w(C,F.split(" ")))for(var E in o.cssRules[B][F])D[E]=o.cssRules[B][F][E];return D}function w(D,C){var B,E=!0;return B=j(D,C.pop()),B&&C.length&&(E=l(D,C)),B&&E&&0===C.length}function l(D,C){for(var B,E=!0;D.parentNode&&1===D.parentNode.nodeType&&C.length;)E&&(B=C.pop()),D=D.parentNode,E=j(D,B);return 0===C.length}function j(D,B){var E,H=D.nodeName,F=D.getAttribute("class"),G=D.getAttribute("id");if(E=new RegExp("^"+H,"i"),B=B.replace(E,""),G&&B.length&&(E=new RegExp("#"+G+"(?![a-zA-Z\\-]+)","i"),B=B.replace(E,"")),F&&B.length){F=F.split(" ");for(var C=F.length;C--;)E=new RegExp("\\."+F[C]+"(?![a-zA-Z\\-]+)","i"),B=B.replace(E,"")}return 0===B.length}function r(F,H){var C;if(F.getElementById&&(C=F.getElementById(H)),C)return C;var E,B,G,D=F.getElementsByTagName("*");for(B=0;B<D.length;B++)if(E=D[B],G===E.getAttribute("id"))return E}function e(N){for(var P=N.getElementsByTagName("use"),I=0;P.length&&I<P.length;){for(var J,D=P[I],G=D.getAttribute("xlink:href").substr(1),M=D.getAttribute("x")||0,L=D.getAttribute("y")||0,E=r(N,G).cloneNode(!0),B=(E.getAttribute("transform")||"")+" translate("+M+", "+L+")",C=P.length,H=0,O=D.attributes,F=O.length;F>H;H++){var K=O.item(H);"x"!==K.nodeName&&"y"!==K.nodeName&&"xlink:href"!==K.nodeName&&("transform"===K.nodeName?B=K.nodeValue+" "+B:E.setAttribute(K.nodeName,K.nodeValue))}E.setAttribute("transform",B),E.setAttribute("instantiated_by_use","1"),E.removeAttribute("id"),J=D.parentNode,J.replaceChild(E,D),P.length===C&&I++}}function A(I,F,D){var M,G,J,C,B=I.getAttribute("viewBox"),L=1,K=1,H=0,E=0;if(B&&(B=B.match(i))&&(H=-parseFloat(B[1]),E=-parseFloat(B[2]),M=parseFloat(B[3]),G=parseFloat(B[4]),F&&F!==M&&(L=F/M),D&&D!==G&&(K=D/G),K=L=L>K?K:L,1!==L||1!==K||0!==H||0!==E)){if(J=" matrix("+L+" 0 0 "+K+" "+H*L+" "+E*K+") ","svg"===I.tagName){for(C=I.ownerDocument.createElement("g");null!=I.firstChild;)C.appendChild(I.firstChild);I.appendChild(C)}else C=I,J=C.getAttribute("transform")+J;C.setAttribute("transform",J)}}function d(D){var C=D.objects,B=D.options;return C=C.map(function(E){return o[k(E.type)].fromObject(E)}),{objects:C,options:B}}function f(B,C,D){C[D]&&C[D].toSVG&&B.push('<pattern x="0" y="0" id="',D,'Pattern" ','width="',C[D].source.width,'" height="',C[D].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',C[D].source.width,'" height="',C[D].source.height,'" xlink:href="',C[D].source.src,'"></image></pattern>')}var o=s.fabric||(s.fabric={}),y=o.util.object.extend,k=o.util.string.capitalize,z=o.util.object.clone,n=o.util.toFixed,q=o.util.parseUnit,u=o.util.multiplyTransformMatrices,v={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},g={stroke:"strokeOpacity",fill:"fillOpacity"};o.cssRules={},o.gradientDefs={},o.parseTransformAttribute=function(){function B(U,V){var W=V[0];U[0]=Math.cos(W),U[1]=Math.sin(W),U[2]=-Math.sin(W),U[3]=Math.cos(W)}function F(W,X){var V=X[0],U=2===X.length?X[1]:X[0];W[0]=V,W[3]=U}function S(U,V){U[2]=Math.tan(o.util.degreesToRadians(V[0]))}function D(U,V){U[1]=Math.tan(o.util.degreesToRadians(V[0]))}function N(U,V){U[4]=V[0],2===V.length&&(U[5]=V[1])}var H=[1,0,0,1,0,0],C=o.reNum,P="(?:\\s+,?\\s*|,\\s*)",I="(?:(skewX)\\s*\\(\\s*("+C+")\\s*\\))",G="(?:(skewY)\\s*\\(\\s*("+C+")\\s*\\))",Q="(?:(rotate)\\s*\\(\\s*("+C+")(?:"+P+"("+C+")"+P+"("+C+"))?\\s*\\))",T="(?:(scale)\\s*\\(\\s*("+C+")(?:"+P+"("+C+"))?\\s*\\))",L="(?:(translate)\\s*\\(\\s*("+C+")(?:"+P+"("+C+"))?\\s*\\))",O="(?:(matrix)\\s*\\(\\s*("+C+")"+P+"("+C+")"+P+"("+C+")"+P+"("+C+")"+P+"("+C+")"+P+"("+C+")\\s*\\))",M="(?:"+O+"|"+L+"|"+T+"|"+Q+"|"+I+"|"+G+")",J="(?:"+M+"(?:"+P+M+")*)",R="^\\s*(?:"+J+"?)\\s*$",K=new RegExp(R),E=new RegExp(M,"g");return function(X){var U=H.concat(),V=[];if(!X||X&&!K.test(X))return U;X.replace(E,function(ab){var Y=new RegExp(M).exec(ab).filter(function(ac){return""!==ac&&null!=ac}),Z=Y[1],aa=Y.slice(2).map(parseFloat);switch(Z){case"translate":N(U,aa);break;case"rotate":aa[0]=o.util.degreesToRadians(aa[0]),B(U,aa);break;case"scale":F(U,aa);break;case"skewX":S(U,aa);break;case"skewY":D(U,aa);break;case"matrix":U=aa}V.push(U.concat()),U=H.concat()});for(var W=V[0];V.length>1;)V.shift(),W=o.util.multiplyTransformMatrices(W,V[0]);return W}}();var i=new RegExp("^\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*$");o.parseSVGDocument=function(){function D(E,F){for(;E&&(E=E.parentNode);)if(F.test(E.nodeName)&&!E.getAttribute("instantiated_by_use"))return!0;return!1}var C=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,B=/^(symbol|image|marker|pattern|view)$/;return function(Q,R,O){if(Q){e(Q);var I,H,G=new Date,P=o.Object.__uid++,M=!1;if(Q.getAttribute("width")&&"100%"!==Q.getAttribute("width")&&(I=q(Q.getAttribute("width"))),Q.getAttribute("height")&&"100%"!==Q.getAttribute("height")&&(H=q(Q.getAttribute("height"))),!I||!H){var F=Q.getAttribute("viewBox");F&&(F=F.match(i))?(I=parseFloat(F[3]),H=parseFloat(F[4])):M=!0}A(Q,I,H);var J=o.util.toArray(Q.getElementsByTagName("*"));if(0===J.length&&o.isLikelyNode){J=Q.selectNodes('//*[name(.)!="svg"]');for(var L=[],K=0,N=J.length;N>K;K++)L[K]=J[K];J=L}var E=J.filter(function(T){return B.test(T.tagName)&&A(T,0,0),C.test(T.tagName)&&!D(T,/^(?:pattern|defs|symbol|metadata)$/)});if(!E||E&&!E.length)return void(R&&R([],{}));var S={width:I,height:H,svgUid:P,toBeParsed:M};o.gradientDefs[P]=o.getGradientDefs(Q),o.cssRules[P]=o.getCSSRules(Q),o.parseElements(E,function(T){o.documentParsingTime=new Date-G,R&&R(T,S)},z(S),O)}}}();var t={has:function(B,C){C(!1)},get:function(){},set:function(){}},b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+o.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+o.reNum+"))?\\s+(.*)");y(o,{parseFontDeclaration:function(H,C){var E=H.match(b);if(E){var I=E[1],D=E[3],G=E[4],F=E[5],B=E[6];I&&(C.fontStyle=I),D&&(C.fontWeight=isNaN(parseFloat(D))?D:parseFloat(D)),G&&(C.fontSize=q(G)),B&&(C.fontFamily=B),F&&(C.lineHeight="normal"===F?1:F)}},getGradientDefs:function(J){var D,H,C,F,M=J.getElementsByTagName("linearGradient"),B=J.getElementsByTagName("radialGradient"),G=0,I=[],K={},L={};for(I.length=M.length+B.length,H=M.length;H--;)I[G++]=M[H];for(H=B.length;H--;)I[G++]=B[H];for(;G--;)D=I[G],F=D.getAttribute("xlink:href"),C=D.getAttribute("id"),F&&(L[C]=F.substr(1)),K[C]=D;for(C in L){var E=K[L[C]].cloneNode(!0);for(D=K[C];E.firstChild;)D.appendChild(E.firstChild)}return K},parseAttributes:function(E,D,B){if(E){var H,G,C={};"undefined"==typeof B&&(B=E.getAttribute("svgUid")),E.parentNode&&/^symbol|[g|a]$/i.test(E.parentNode.nodeName)&&(C=o.parseAttributes(E.parentNode,D,B)),G=C&&C.fontSize||E.getAttribute("font-size")||o.Text.DEFAULT_SVG_FONT_SIZE;var F=D.reduce(function(J,I){return H=E.getAttribute(I),H&&(I=a(I),H=h(I,H,C,G),J[I]=H),J},{});return F=y(F,y(x(E,B),o.parseStyleAttribute(E))),F.font&&o.parseFontDeclaration(F.font,F),c(y(C,F))}},parseElements:function(D,E,C,B){new o.ElementsParser(D,E,C,B).parse()},parseStyleAttribute:function(C){var B={},D=C.getAttribute("style");return D?("string"==typeof D?p(D,B):m(D,B),B):B},parsePointsAttribute:function(E){if(!E)return null;E=E.replace(/,/g," ").trim(),E=E.split(/\s+/);var D,B,C=[];for(D=0,B=E.length;B>D;D+=2)C.push({x:parseFloat(E[D]),y:parseFloat(E[D+1])});return C},getCSSRules:function(G){for(var H,E=G.getElementsByTagName("style"),C={},D=0,B=E.length;B>D;D++){var F=E[D].textContent;F=F.replace(/\/\*[\s\S]*?\*\//g,""),""!==F.trim()&&(H=F.match(/[^{]*\{[\s\S]*?\}/g),H=H.map(function(I){return I.trim()}),H.forEach(function(O){for(var M=O.match(/([\s\S]*?)\s*\{([^}]*)\}/),K={},I=M[2].trim(),Q=I.replace(/;$/,"").split(/\s*;\s*/),L=0,N=Q.length;N>L;L++){var J=Q[L].split(/\s*:\s*/),R=a(J[0]),P=h(R,J[1],J[0]);K[R]=P}O=M[1],O.split(",").forEach(function(S){S=S.replace(/^svg/i,"").trim(),""!==S&&(C[S]=o.util.object.clone(K))})}))}return C},loadSVGFromURL:function(C,E,B){function D(G){var F=G.responseXML;F&&!F.documentElement&&o.window.ActiveXObject&&G.responseText&&(F=new ActiveXObject("Microsoft.XMLDOM"),F.async="false",F.loadXML(G.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),F&&F.documentElement&&o.parseSVGDocument(F.documentElement,function(I,H){t.set(C,{objects:o.util.array.invoke(I,"toObject"),options:H}),E(I,H)},B)}C=C.replace(/^\n\s*/,"").trim(),t.has(C,function(F){F?t.get(C,function(H){var G=d(H);E(G.objects,G.options)}):new o.util.request(C,{method:"get",onComplete:D})})},loadSVGFromString:function(C,F,B){C=C.trim();var D;if("undefined"!=typeof DOMParser){var E=new DOMParser;E&&E.parseFromString&&(D=E.parseFromString(C,"text/xml"))}else o.window.ActiveXObject&&(D=new ActiveXObject("Microsoft.XMLDOM"),D.async="false",D.loadXML(C.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));o.parseSVGDocument(D.documentElement,function(H,G){F(H,G)},B)},createSVGFontFacesMarkup:function(E){for(var C="",D=0,B=E.length;B>D;D++)"text"===E[D].type&&E[D].path&&(C+=["@font-face {","font-family: ",E[D].fontFamily,"; ","src: url('",E[D].path,"')","}"].join(""));return C&&(C=['<style type="text/css">',"<![CDATA[",C,"]]>","</style>"].join("")),C},createSVGRefElementsMarkup:function(C){var B=[];return f(B,C,"backgroundColor"),f(B,C,"overlayColor"),B.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(c,d,b,a){this.elements=c,this.callback=d,this.options=b,this.reviver=a,this.svgUid=b&&b.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var b=0,a=this.elements.length;a>b;b++)this.elements[b].setAttribute("svgUid",this.svgUid),function(d,c){setTimeout(function(){d.createObject(d.elements[c],c)},0)}(this,b)},fabric.ElementsParser.prototype.createObject=function(c,b){var a=fabric[fabric.util.string.capitalize(c.tagName)];if(a&&a.fromElement)try{this._createObject(a,c,b)}catch(d){fabric.log(d)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(a,c,b){if(a.async)a.fromElement(c,this.createCallback(b,c),this.options);else{var d=a.fromElement(c,this.options);this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(c,d),this.instances[b]=d,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(d,c){
var a=d.get(c);if(/^url\(/.test(a)){var b=a.slice(5,a.length-1);fabric.gradientDefs[this.svgUid][b]&&d.set(c,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][b],d))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))},function(b){function a(d,e){this.x=d,this.y=e}var c=b.fabric||(b.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=a,void(a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){return this.x+=d.x,this.y+=d.y,this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){return this.x+=d,this.y+=d,this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){return this.x-=d.x,this.y-=d.y,this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){return this.x-=d,this.y-=d,this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){return this.x*=d,this.y*=d,this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){return this.x/=d,this.y/=d,this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d,this.y=e},setFromPoint:function(d){this.x=d.x,this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x,this.y=e.y,e.x=d,e.y=f}}))}("undefined"!=typeof exports?exports:this),function(a){function c(d){this.status=d,this.points=[]}var b=a.fabric||(a.fabric={});return b.Intersection?void b.warn("fabric.Intersection is already defined"):(b.Intersection=c,b.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}},b.Intersection.intersectLineLine=function(h,g,l,k){var m,e=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(g.x-h.x)*(h.y-l.y)-(g.y-h.y)*(h.x-l.x),i=(k.y-l.y)*(g.x-h.x)-(k.x-l.x)*(g.y-h.y);if(0!==i){var f=e/i,d=j/i;f>=0&&1>=f&&d>=0&&1>=d?(m=new c("Intersection"),m.points.push(new b.Point(h.x+f*(g.x-h.x),h.y+f*(g.y-h.y)))):m=new c}else m=new c(0===e||0===j?"Coincident":"Parallel");return m},b.Intersection.intersectLinePolygon=function(e,d,l){for(var m=new c,f=l.length,h=0;f>h;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}return m.points.length>0&&(m.status="Intersection"),m},b.Intersection.intersectPolygonPolygon=function(j,h){for(var f=new c,l=j.length,k=0;l>k;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}return f.points.length>0&&(f.status="Intersection"),f},void(b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c;return o.appendPoints(k.points),o.appendPoints(j.points),o.appendPoints(i.points),o.appendPoints(h.points),o.points.length>0&&(o.status="Intersection"),o}))}("undefined"!=typeof exports?exports:this),function(b){function d(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function a(g,f,e){return 0>e&&(e+=1),e>1&&(e-=1),1/6>e?g+6*(f-g)*e:.5>e?f:2/3>e?g+(f-g)*(2/3-e)*6:g}var c=b.fabric||(b.fabric={});return c.Color?void c.warn("fabric.Color is already defined."):(c.Color=d,c.Color.prototype={_tryParsingColor:function(e){var f;return e in d.colorNameMap&&(e=d.colorNameMap[e]),"transparent"===e?void this.setSource([255,255,255,0]):(f=d.sourceFromHex(e),f||(f=d.sourceFromRgb(e)),f||(f=d.sourceFromHsl(e)),void(f&&this.setSource(f)))},_rgbToHsl:function(e,k,n){e/=255,k/=255,n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);if(f=(o+i)/2,o===i)j=p=0;else{var m=o-i;switch(p=f>.5?m/(2-o-i):m/(o+i),o){case e:j=(k-n)/m+(n>k?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4}j/=6}return[Math.round(360*j),Math.round(100*p),Math.round(100*f)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var h,f,e,i=this.getSource();return h=i[0].toString(16),h=1===h.length?"0"+h:h,f=i[1].toString(16),f=1===f.length?"0"+f:f,e=i[2].toString(16),e=1===e.length?"0"+e:e,h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();return e[3]=f,this.setSource(e),this},toGrayscale:function(){var g=this.getSource(),f=parseInt((.3*g[0]+.59*g[1]+.11*g[2]).toFixed(0),10),e=g[3];return this.setSource([f,f,f,e]),this},toBlackWhite:function(e){var h=this.getSource(),g=(.3*h[0]+.59*h[1]+.11*h[2]).toFixed(0),f=h[3];return e=e||127,g=Number(g)<Number(e)?0:255,this.setSource([g,g,g,f]),this},overlayWith:function(l){l instanceof d||(l=new d(l));for(var e=[],k=this.getAlpha(),h=.5,j=this.getSource(),f=l.getSource(),g=0;3>g;g++)e.push(Math.round(j[g]*(1-h)+f[g]*h));return e[3]=k,this.setSource(e),this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))},c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}},c.Color.fromRgba=d.fromRgb,c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))},c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(n){var e,o,t,m=(parseFloat(n[1])%360+360)%360/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(0===u)e=o=t=j;else{var f=.5>=j?j*(u+1):j+u-j*u,i=2*j-f;e=a(i,f,m+1/3),o=a(i,f,m),t=a(i,f,m-1/3)}return[Math.round(255*e),Math.round(255*o),Math.round(255*t),n[4]?parseFloat(n[4]):1]}},c.Color.fromHsla=d.fromHsl,c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))},c.Color.sourceFromHex=function(h){if(h.match(d.reHex)){var k=h.slice(h.indexOf("#")+1),f=3===k.length,j=f?k.charAt(0)+k.charAt(0):k.substring(0,2),i=f?k.charAt(1)+k.charAt(1):k.substring(2,4),e=f?k.charAt(2)+k.charAt(2):k.substring(4,6);return[parseInt(j,16),parseInt(i,16),parseInt(e,16),1]}},void(c.Color.fromSource=function(e){var f=new d;return f.setSource(e),f}))}("undefined"!=typeof exports?exports:this),function(){function d(f){var g,m,l,e=f.getAttribute("style"),h=f.getAttribute("offset");if(h=parseFloat(h)/(/%$/.test(h)?100:1),h=0>h?0:h>1?1:h,e){var k=e.split(/\s*;\s*/);""===k[k.length-1]&&k.pop();for(var j=k.length;j--;){var n=k[j].split(/\s*:\s*/),p=n[0].trim(),o=n[1].trim();"stop-color"===p?g=o:"stop-opacity"===p&&(l=o)}}return g||(g=f.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=f.getAttribute("stop-opacity")),g=new fabric.Color(g),m=g.getAlpha(),l=isNaN(parseFloat(l))?1:parseFloat(l),l*=m,{offset:h,color:g.toRgb(),opacity:l}}function b(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}function c(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}function a(h,m,g){var f,l=0,k=1,i="";for(var e in m)f=parseFloat(m[e],10),k="string"==typeof m[e]&&/^\d+%$/.test(m[e])?.01:1,"x1"===e||"x2"===e||"r2"===e?(k*="objectBoundingBox"===g?h.width:1,l="objectBoundingBox"===g?h.left||0:0):"y1"!==e&&"y2"!==e||(k*="objectBoundingBox"===g?h.height:1,l="objectBoundingBox"===g?h.top||0:0),m[e]=f*k+l;if("ellipse"===h.type&&null!==m.r2&&"objectBoundingBox"===g&&h.rx!==h.ry){var j=h.ry/h.rx;i=" scale(1, "+j+")",m.y1&&(m.y1/=j),m.y2&&(m.y2/=j)}return i}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(e){e||(e={});var f={};this.id=fabric.Object.__uid++,this.type=e.type||"linear",f={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(f.r1=e.coords.r1||0,f.r2=e.coords.r2||0),this.coords=f,this.colorStops=e.colorStops.slice(),e.gradientTransform&&(this.gradientTransform=e.gradientTransform),this.offsetX=e.offsetX||this.offsetX,this.offsetY=e.offsetY||this.offsetY},addColorStop:function(f){for(var e in f){var g=new fabric.Color(f[e]);this.colorStops.push({offset:e,color:g.toRgb(),opacity:g.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(g){var f,e,j=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(l,i){return l.offset-i.offset}),!g.group||"path-group"!==g.group.type)for(var k in j)"x1"===k||"x2"===k||"r2"===k?j[k]+=this.offsetX-g.width/2:"y1"!==k&&"y2"!==k||(j[k]+=this.offsetY-g.height/2);e='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(e+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?f=["<linearGradient ",e,' x1="',j.x1,'" y1="',j.y1,'" x2="',j.x2,'" y2="',j.y2,'">\n']:"radial"===this.type&&(f=["<radialGradient ",e,' cx="',j.x2,'" cy="',j.y2,'" r="',j.r2,'" fx="',j.x1,'" fy="',j.y1,'">\n']);for(var h=0;h<this.colorStops.length;h++)f.push("<stop ",'offset="',100*this.colorStops[h].offset+"%",'" style="stop-color:',this.colorStops[h].color,null!=this.colorStops[h].opacity?";stop-opacity: "+this.colorStops[h].opacity:";",'"/>\n');return f.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),f.join("")},toLive:function(o,f){var m,e,n=fabric.util.object.clone(this.coords);if(this.type){if(f.group&&"path-group"===f.group.type)for(e in n)"x1"===e||"x2"===e?n[e]+=-this.offsetX+f.width/2:"y1"!==e&&"y2"!==e||(n[e]+=-this.offsetY+f.height/2);"linear"===this.type?m=o.createLinearGradient(n.x1,n.y1,n.x2,n.y2):"radial"===this.type&&(m=o.createRadialGradient(n.x1,n.y1,n.r1,n.x2,n.y2,n.r2));for(var j=0,l=this.colorStops.length;l>j;j++){var g=this.colorStops[j].color,k=this.colorStops[j].opacity,h=this.colorStops[j].offset;"undefined"!=typeof k&&(g=new fabric.Color(g).setAlpha(k).toRgba()),m.addColorStop(parseFloat(h),g)}return m}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(f,p){var k,n=f.getElementsByTagName("stop"),l="linearGradient"===f.nodeName?"linear":"radial",h=f.getAttribute("gradientUnits")||"objectBoundingBox",e=f.getAttribute("gradientTransform"),g=[],o={};"linear"===l?o=b(f):"radial"===l&&(o=c(f));for(var j=n.length;j--;)g.push(d(n[j]));k=a(p,o,h);var m=new fabric.Gradient({type:l,coords:o,colorStops:g,offsetX:-p.left,offsetY:-p.top});return(e||""!==k)&&(m.gradientTransform=fabric.parseTransformAttribute((e||"")+k)),m},forObject:function(f,e){return e||(e={}),a(f,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){if(a||(a={}),this.id=fabric.Object.__uid++,a.source)if("string"==typeof a.source)if("undefined"!=typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source));else{var b=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(c){b.source=c})}else this.source=a.source;a.repeat&&(this.repeat=a.repeat),a.offsetX&&(this.offsetX=a.offsetX),a.offsetY&&(this.offsetY=a.offsetY)},toObject:function(){var a;return"function"==typeof this.source?a=String(this.source):"string"==typeof this.source.src&&(a=this.source.src),{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(b){var a="function"==typeof this.source?this.source():this.source,f=a.width/b.getWidth(),d=a.height/b.getHeight(),e=this.offsetX/b.getWidth(),c=this.offsetY/b.getHeight(),g="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(d=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(f=1),a.src?g=a.src:a.toDataURL&&(g=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+c+'" width="'+f+'" height="'+d+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}}),function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;return c.Shadow?void c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(d){"string"==typeof d&&(d=this._parseShadow(d));for(var e in d)this[e]=d[e];this.id=c.Object.__uid++},_parseShadow:function(g){var f=g.trim(),e=c.Shadow.reOffsetsAndBlur.exec(f)||[],d=f.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseInt(e[1],10)||0,offsetY:parseInt(e[2],10)||0,blur:parseInt(e[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var f="SourceAlpha",d=40,g=40;return!e||e.fill!==this.color&&e.stroke!==this.color||(f="SourceGraphic"),e.width&&e.height&&(d=100*a(Math.abs(this.offsetX/e.getWidth()),2)+20,g=100*a(Math.abs(this.offsetY/e.getHeight()),2)+20),'<filter id="SVGID_'+this.id+'" y="-'+g+'%" height="'+(100+2*g)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n	<feGaussianBlur in="'+f+'" stdDeviation="'+a(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n	<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n	<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var e={},d=c.Shadow.prototype;return this.color!==d.color&&(e.color=this.color),this.blur!==d.blur&&(e.blur=this.blur),this.offsetX!==d.offsetX&&(e.offsetX=this.offsetX),this.offsetY!==d.offsetY&&(e.offsetY=this.offsetY),e}}),void(c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var d=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(f,e){e||(e={}),this._initStatic(f,e),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(f,e){this._objects=[],this._createLowerCanvas(f),this._initOptions(e),this._setImageSmoothing(),e.overlayImage&&this.setOverlayImage(e.overlayImage,this.renderAll.bind(this)),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this)),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,this.renderAll.bind(this)),e.overlayColor&&this.setOverlayColor(e.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(f,g,e){return this.__setBgOverlayImage("overlayImage",f,g,e)},setBackgroundImage:function(f,g,e){return this.__setBgOverlayImage("backgroundImage",f,g,e)},setOverlayColor:function(f,e){return this.__setBgOverlayColor("overlayColor",f,e)},setBackgroundColor:function(e,f){return this.__setBgOverlayColor("backgroundColor",e,f)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,e.mozImageSmoothingEnabled=this.imageSmoothingEnabled,e.msImageSmoothingEnabled=this.imageSmoothingEnabled,e.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(f,g,h,e){return"string"==typeof g?fabric.util.loadImage(g,function(i){this[f]=new fabric.Image(i,e),h&&h()},this,e&&e.crossOrigin):(e&&g.setOptions(e),this[f]=g,h&&h()),this},__setBgOverlayColor:function(f,e,h){if(e&&e.source){var g=this;fabric.util.loadImage(e.source,function(i){g[f]=new fabric.Pattern({source:i,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),h&&h()})}else this[f]=e,h&&h();return this},_createCanvasElement:function(){var e=fabric.document.createElement("canvas");if(e.style||(e.style={}),!e)throw a;return this._initCanvasElement(e),e},_initCanvasElement:function(e){if(fabric.util.createCanvasElement(e),"undefined"==typeof e.getContext)throw a},_initOptions:function(e){for(var f in e)this[f]=e[f];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f,e){return this.setDimensions({width:f},e)},setHeight:function(f,e){return this.setDimensions({height:f},e)},setDimensions:function(g,f){var e;f=f||{};for(var h in g)e=g[h],f.cssOnly||(this._setBackstoreDimension(h,g[h]),e+="px"),f.backstoreOnly||this._setCssDimension(h,e);return f.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(f,e){return this.lowerCanvasEl[f]=e,this.upperCanvasEl&&(this.upperCanvasEl[f]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[f]=e),this[f]=e,this},_setCssDimension:function(f,e){return this.lowerCanvasEl.style[f]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[f]=e),this.wrapperEl&&(this.wrapperEl.style[f]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(h){var g=this.getActiveGroup();this.viewportTransform=h,this.renderAll();for(var f=0,e=this._objects.length;e>f;f++)this._objects[f].setCoords();return g&&g.setCoords(),this},zoomToPoint:function(f,j){var h=f;f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=j,this.viewportTransform[3]=j;var k=fabric.util.transformPoint(f,this.viewportTransform);this.viewportTransform[4]+=h.x-k.x,this.viewportTransform[5]+=h.y-k.y,this.renderAll();for(var g=0,e=this._objects.length;e>g;g++)this._objects[g].setCoords();return this},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(f){this.viewportTransform[4]=-f.x,this.viewportTransform[5]=-f.y,this.renderAll();for(var g=0,e=this._objects.length;e>g;g++)this._objects[g].setCoords();return this},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(e,g){if(g){e.save();var f=this.viewportTransform;e.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this._shouldRenderObject(g)&&g.render(e),e.restore(),this.controlsAboveOverlay||g._renderControls(e)}},_shouldRenderObject:function(e){return e?e!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.getActiveObject()===e&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:e}),e.fire("removed")},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(e){var f=this[e===!0&&this.interactive?"contextTop":"contextContainer"],g=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),e||this.clearContext(f),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,f),this._renderBackground(f),this._renderObjects(f,g),this._renderActiveGroup(f,g),this.clipTo&&f.restore(),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render"),this},_renderObjects:function(e,g){var f,h;if(!g||this.preserveObjectStacking)for(f=0,h=this._objects.length;h>f;++f)this._draw(e,this._objects[f]);else for(f=0,h=this._objects.length;h>f;++f)this._objects[f]&&!g.contains(this._objects[f])&&this._draw(e,this._objects[f])},_renderActiveGroup:function(e,f){if(f){var g=[];this.forEachObject(function(h){f.contains(h)&&g.push(h)}),f._set("_objects",g.reverse()),this._draw(e,f)}},_renderBackground:function(e){this.backgroundColor&&(e.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(e):this.backgroundColor,e.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(e,this.backgroundImage)},_renderOverlay:function(e){this.overlayColor&&(e.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(e):this.overlayColor,e.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(e,this.overlayImage)},renderTop:function(){var e=this.contextTop||this.contextContainer;this.clearContext(e),this.selection&&this._groupSelector&&this._drawSelection();var f=this.getActiveGroup();return f&&f.render(e),this._renderOverlay(e),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(f){var e=this.getCenter();return this._centerObject(f,new fabric.Point(e.left,e.top)),this.renderAll(),this},_centerObject:function(f,e){return f.setPositionByOrigin(e,"center","center"),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(e,g){var f={objects:this._toObjects(e,g)};return d(f,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,f,g),f},_toObjects:function(e,f){return this.getObjects().map(function(g){return this._toObject(g,e,f)},this)},_toObject:function(e,g,j){var f;this.includeDefaultValues||(f=e.includeDefaultValues,e.includeDefaultValues=!1);var i=this._realizeGroupTransformOnObject(e),h=e[g](j);return this.includeDefaultValues||(e.includeDefaultValues=f),this._unwindGroupTransformOnObject(e,i),h},_realizeGroupTransformOnObject:function(e){var f=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(e.group&&e.group===this.getActiveGroup()){var g={};return f.forEach(function(h){g[h]=e[h]}),this.getActiveGroup().realizeTransform(e),g}return null},_unwindGroupTransformOnObject:function(e,f){f&&e.set(f)},__serializeBgOverlay:function(){var e={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(e.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(e.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(e.overlayImage=this.overlayImage.toObject()),e},svgViewportTransformation:!0,toSVG:function(g,e){g||(g={});var f=[];return this._setSVGPreamble(f,g),this._setSVGHeader(f,g),this._setSVGBgOverlayColor(f,"backgroundColor"),this._setSVGBgOverlayImage(f,"backgroundImage"),this._setSVGObjects(f,e),this._setSVGBgOverlayColor(f,"overlayColor"),this._setSVGBgOverlayImage(f,"overlayImage"),f.push("</svg>"),f.join("")},_setSVGPreamble:function(e,f){f.suppressPreamble||e.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(f,g){var h,e,i;g.viewBox?(h=g.viewBox.width,e=g.viewBox.height):(h=this.width,e=this.height,this.svgViewportTransformation||(i=this.viewportTransform,h/=i[0],e/=i[3])),f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',h,'" ','height="',e,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,g.viewBox?'viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(h,g){for(var j=0,k=this.getObjects(),f=k.length;f>j;j++){var e=k[j],l=this._realizeGroupTransformOnObject(e);h.push(e.toSVG(g)),this._unwindGroupTransformOnObject(e,l)}},_setSVGBgOverlayImage:function(e,f){this[f]&&this[f].toSVG&&e.push(this[f].toSVG())},_setSVGBgOverlayColor:function(e,f){this[f]&&this[f].source?e.push('<rect x="',this[f].offsetX,'" y="',this[f].offsetY,'" ','width="',"repeat-y"===this[f].repeat||"no-repeat"===this[f].repeat?this[f].source.width:this.width,'" height="',"repeat-x"===this[f].repeat||"no-repeat"===this[f].repeat?this[f].source.height:this.height,'" fill="url(#'+f+'Pattern)"',"></rect>"):this[f]&&"overlayColor"===f&&e.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[f],'"',"></rect>")},sendToBack:function(e){return c(this._objects,e),this._objects.unshift(e),this.renderAll&&this.renderAll()},bringToFront:function(e){return c(this._objects,e),this._objects.push(e),this.renderAll&&this.renderAll()},sendBackwards:function(f,g){var e=this._objects.indexOf(f);if(0!==e){var h=this._findNewLowerIndex(f,e,g);c(this._objects,f),this._objects.splice(h,0,f),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(g,e,j){var k;if(j){k=e;for(var h=e-1;h>=0;--h){var f=g.intersectsWithObject(this._objects[h])||g.isContainedWithinObject(this._objects[h])||this._objects[h].isContainedWithinObject(g);if(f){k=h;break}}}else k=e-1;return k},bringForward:function(f,g){var e=this._objects.indexOf(f);if(e!==this._objects.length-1){var h=this._findNewUpperIndex(f,e,g);c(this._objects,f),this._objects.splice(h,0,f),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(g,e,j){var k;if(j){k=e;for(var h=e+1;h<this._objects.length;++h){var f=g.intersectsWithObject(this._objects[h])||g.isContainedWithinObject(this._objects[h])||this._objects[h].isContainedWithinObject(g);if(f){k=h;break}}}else k=e+1;return k},moveTo:function(f,e){return c(this._objects,f),this._objects.splice(e,0,f),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),d(fabric.StaticCanvas.prototype,fabric.Observable),d(fabric.StaticCanvas.prototype,fabric.Collection),d(fabric.StaticCanvas.prototype,fabric.DataURLExporter),d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var h=fabric.util.createCanvasElement();if(!h||!h.getContext)return null;var f=h.getContext("2d");if(!f)return null;switch(g){case"getImageData":return"undefined"!=typeof f.getImageData;case"setLineDash":return"undefined"!=typeof f.setLineDash;case"toDataURL":return"undefined"!=typeof h.toDataURL;case"toDataURLWithQuality":try{return h.toDataURL("image/jpeg",0),!0}catch(i){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop;a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(b){var a=new fabric.Point(b.x,b.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){
this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var b=this.canvas.contextTop,c=this.canvas.viewportTransform,f=this._points[0],e=this._points[1];b.save(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b.beginPath(),2===this._points.length&&f.x===e.x&&f.y===e.y&&(f.x-=.5,e.x+=.5),b.moveTo(f.x,f.y);for(var d=1,a=this._points.length;a>d;d++){var g=f.midPointFrom(e);b.quadraticCurveTo(f.x,f.y,g.x,g.y),f=this._points[d],e=this._points[d+1]}b.lineTo(f.x,f.y),b.stroke(),b.restore()},convertPointsToSVGPath:function(c){var e=[],f=new fabric.Point(c[0].x,c[0].y),d=new fabric.Point(c[1].x,c[1].y);e.push("M ",c[0].x," ",c[0].y," ");for(var b=1,a=c.length;a>b;b++){var g=f.midPointFrom(d);e.push("Q ",f.x," ",f.y," ",g.x," ",g.y," "),f=new fabric.Point(c[b].x,c[b].y),b+1<c.length&&(d=new fabric.Point(c[b+1].x,c[b+1].y))}return e.push("L ",f.x," ",f.y," "),e},createPath:function(b){var a=new fabric.Path(b,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,a.setShadow(this.shadow)),a},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var c=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===c)return void this.canvas.renderAll();var b=this.createPath(c);this.canvas.add(b),b.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:b})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(d){var a=this.addPoint(d),b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b.fillStyle=a.fill,b.beginPath(),b.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),b.closePath(),b.fill(),b.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var f=[],c=0,b=this.points.length;b>c;c++){var a=this.points[c],e=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&e.setShadow(this.shadow),f.push(e)}var d=new fabric.Group(f,{originX:"center",originY:"center"});d.canvas=this.canvas,this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=g,this.canvas.renderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y),a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return d.radius=a,d.fill=b,this.points.push(d),d}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var h=[],c=0,a=this.sprayChunks.length;a>c;c++)for(var d=this.sprayChunks[c],b=0,k=d.length;k>b;b++){var f=new fabric.Rect({width:d[b].width,height:d[b].width,left:d[b].x+1,top:d[b].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&f.setShadow(this.shadow),h.push(f)}this.optimizeOverlapping&&(h=this._getOptimizedRects(h));var g=new fabric.Group(h,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},_getOptimizedRects:function(c){for(var e,b={},d=0,a=c.length;a>d;d++)e=c[d].left+""+c[d].top,b[e]||(b[e]=c[d]);var f=[];for(e in b)f.push(b[e]);return f},render:function(){var c=this.canvas.contextTop;c.fillStyle=this.color;var d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]);for(var e=0,b=this.sprayChunkPoints.length;b>e;e++){var a=this.sprayChunkPoints[e];"undefined"!=typeof a.opacity&&(c.globalAlpha=a.opacity),c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];for(var c,g,e,b=this.width/2,d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b),g=fabric.util.getRandomInt(f.y-b,f.y+b),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new fabric.Point(c,g);a.width=e,this.randomOpacity&&(a.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.document.createElement("canvas"),a=c.getContext("2d");return c.width=c.height=d+b,a.fillStyle=this.color,a.beginPath(),a.arc(d/2,d/2,d/2,0,2*Math.PI,!1),a.closePath(),a.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(b){var a=this.callSuper("createPath",b);return a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),a}}),function(){var c=fabric.util.getPointer,d=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,e=Math.atan2,b=Math.abs,a=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(i,h){h||(h={}),this._initStatic(i,h),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(i){var h=this._currentTransform;h.target.set({scaleX:h.original.scaleX,scaleY:h.original.scaleY,left:h.original.left,top:h.original.top}),this._shouldCenterTransform(i,h.target)?"rotate"===h.action?this._setOriginToCenter(h.target):("center"!==h.originX&&("right"===h.originX?h.mouseXSign=-1:h.mouseXSign=1),"center"!==h.originY&&("bottom"===h.originY?h.mouseYSign=-1:h.mouseYSign=1),h.originX="center",h.originY="center"):(h.originX=h.original.originX,h.originY=h.original.originY)},containsPoint:function(j,i){var k=this.getPointer(j,!0),h=this._normalizePointer(i,k);return i.containsPoint(h)||i._findTargetCorner(k)},_normalizePointer:function(j,m){var h,l=this.getActiveGroup(),i=m.x,n=m.y,k=l&&"group"!==j.type&&l.contains(j);return k&&(h=new fabric.Point(l.left,l.top),h=fabric.util.transformPoint(h,this.viewportTransform,!0),i-=h.x,n-=h.y),{x:i,y:n}},isTargetTransparent:function(l,h,m){var i=l.hasBorders,j=l.transparentCorners;l.hasBorders=l.transparentCorners=!1,this._draw(this.contextCache,l),l.hasBorders=i,l.transparentCorners=j;var k=fabric.util.isTransparent(this.contextCache,h,m,this.targetFindTolerance);return this.clearContext(this.contextCache),k},_shouldClearSelection:function(k,j){var i=this.getActiveGroup(),h=this.getActiveObject();return!j||j&&i&&!i.contains(j)&&i!==j&&!k.shiftKey||j&&!j.evented||j&&!j.selectable&&h&&h!==j},_shouldCenterTransform:function(k,j){if(j){var h,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?h=this.centeredScaling||j.centeredScaling:"rotate"===i.action&&(h=this.centeredRotation||j.centeredRotation),h?!k.altKey:k.altKey}},_getOriginFromCorner:function(j,i){var h={x:j.originX,y:j.originY};return"ml"===i||"tl"===i||"bl"===i?h.x="right":"mr"!==i&&"tr"!==i&&"br"!==i||(h.x="left"),"tl"===i||"mt"===i||"tr"===i?h.y="bottom":"bl"!==i&&"mb"!==i&&"br"!==i||(h.y="top"),h},_getActionFromCorner:function(j,h){var i="drag";return h&&(i="ml"===h||"mr"===h?"scaleX":"mt"===h||"mb"===h?"scaleY":"mtr"===h?"rotate":"scale"),i},_setupCurrentTransform:function(l,k){if(k){var m=this.getPointer(l),i=k._findTargetCorner(this.getPointer(l,!0)),j=this._getActionFromCorner(k,i),h=this._getOriginFromCorner(k,i);this._currentTransform={target:k,action:j,scaleX:k.scaleX,scaleY:k.scaleY,offsetX:m.x-k.left,offsetY:m.y-k.top,originX:h.x,originY:h.y,ex:m.x,ey:m.y,left:k.left,top:k.top,theta:d(k.angle),width:k.width*k.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:k.left,top:k.top,scaleX:k.scaleX,scaleY:k.scaleY,originX:h.x,originY:h.y},this._resetCurrentTransform(l)}},_translateObject:function(h,j){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",h-this._currentTransform.offsetX),i.get("lockMovementY")||i.set("top",j-this._currentTransform.offsetY)},_scaleObject:function(p,o,l){var q=this._currentTransform,j=q.target,m=j.get("lockScalingX"),k=j.get("lockScalingY"),h=j.get("lockScalingFlip");if(!m||!k){var i=j.translateToOriginPoint(j.getCenterPoint(),q.originX,q.originY),n=j.toLocalPoint(new fabric.Point(p,o),q.originX,q.originY);this._setLocalMouse(n,q),this._setObjectScale(n,q,m,k,l,h),j.setPositionByOrigin(i,q.originX,q.originY)}},_setObjectScale:function(t,j,s,q,r,i){var p=j.target,m=!1,l=!1,h="line"===p.type&&0===p.width,k="line"===p.type&&0===p.height,o=k?0:p.strokeWidth,n=h?0:p.strokeWidth;j.newScaleX=t.x/(p.width+o),j.newScaleY=t.y/(p.height+n),i&&j.newScaleX<=0&&j.newScaleX<p.scaleX&&(m=!0),i&&j.newScaleY<=0&&j.newScaleY<p.scaleY&&(l=!0),"equally"!==r||s||q?r?"x"!==r||p.get("lockUniScaling")?"y"!==r||p.get("lockUniScaling")||l||q||p.set("scaleY",j.newScaleY):m||s||p.set("scaleX",j.newScaleX):(m||s||p.set("scaleX",j.newScaleX),l||q||p.set("scaleY",j.newScaleY)):m||l||this._scaleObjectEqually(t,p,j),m||l||this._flipObject(j,r)},_scaleObjectEqually:function(p,n,i){var o=p.y+p.x,h="line"===n.type&&0===n.width,j="line"===n.type&&0===n.height,l=j?0:n.strokeWidth,k=h?0:n.strokeWidth,m=(n.height+k)*i.original.scaleY+(n.width+l)*i.original.scaleX;i.newScaleX=i.original.scaleX*o/m,i.newScaleY=i.original.scaleY*o/m,n.set("scaleX",i.newScaleX),n.set("scaleY",i.newScaleY)},_flipObject:function(h,i){h.newScaleX<0&&"y"!==i&&("left"===h.originX?h.originX="right":"right"===h.originX&&(h.originX="left")),h.newScaleY<0&&"x"!==i&&("top"===h.originY?h.originY="bottom":"bottom"===h.originY&&(h.originY="top"))},_setLocalMouse:function(j,h){var i=h.target;"right"===h.originX?j.x*=-1:"center"===h.originX&&(j.x*=2*h.mouseXSign,j.x<0&&(h.mouseXSign=-h.mouseXSign)),"bottom"===h.originY?j.y*=-1:"center"===h.originY&&(j.y*=2*h.mouseYSign,j.y<0&&(h.mouseYSign=-h.mouseYSign)),b(j.x)>i.padding?j.x<0?j.x+=i.padding:j.x-=i.padding:j.x=0,b(j.y)>i.padding?j.y<0?j.y+=i.padding:j.y-=i.padding:j.y=0},_rotateObject:function(h,m){var i=this._currentTransform;if(!i.target.get("lockRotation")){var j=e(i.ey-i.top,i.ex-i.left),l=e(m-i.top,h-i.left),k=f(l-j+i.theta);0>k&&(k=360+k),i.target.angle=k%360}},setCursor:function(h){this.upperCanvasEl.style.cursor=h},_resetObjectTransform:function(h){h.scaleX=1,h.scaleY=1,h.setAngle(0)},_drawSelection:function(){var i=this.contextTop,h=this._groupSelector,o=h.left,n=h.top,m=b(o),k=b(n);if(i.fillStyle=this.selectionColor,i.fillRect(h.ex-(o>0?0:-o),h.ey-(n>0?0:-n),m,k),i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var l=h.ex+a-(o>0?0:m),j=h.ey+a-(n>0?0:k);i.beginPath(),fabric.util.drawDashedLine(i,l,j,l+m,j,this.selectionDashArray),fabric.util.drawDashedLine(i,l,j+k-1,l+m,j+k-1,this.selectionDashArray),fabric.util.drawDashedLine(i,l,j,l,j+k,this.selectionDashArray),fabric.util.drawDashedLine(i,l+m-1,j,l+m-1,j+k,this.selectionDashArray),i.closePath(),i.stroke()}else i.strokeRect(h.ex+a-(o>0?0:m),h.ey+a-(n>0?0:k),m,k)},_isLastRenderedObject:function(h){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(h,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(h,!0))},findTarget:function(k,h){if(!this.skipTargetFind){if(this._isLastRenderedObject(k))return this.lastRenderedObjectWithControlsAboveOverlay;var i=this.getActiveGroup();if(i&&!h&&this.containsPoint(k,i))return i;var j=this._searchPossibleTargets(k);return this._fireOverOutEvents(j,k),j}},_fireOverOutEvents:function(i,h){i?this._hoveredTarget!==i&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:h}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:i,e:h}),i.fire("mouseover"),this._hoveredTarget=i):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:h}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(j,i,k){if(i&&i.visible&&i.evented&&this.containsPoint(j,i)){if(!this.perPixelTargetFind&&!i.perPixelTargetFind||i.isEditing)return!0;var h=this.isTargetTransparent(i,k.x,k.y);if(!h)return!0}},_searchPossibleTargets:function(k){for(var j,l=this.getPointer(k,!0),h=this._objects.length;h--;)if(!this._objects[h].group&&this._checkTarget(k,this._objects[h],l)){this.relatedTarget=this._objects[h],j=this._objects[h];break}return j},getPointer:function(n,l,k){k||(k=this.upperCanvasEl);var i,o=c(n,k),m=k.getBoundingClientRect(),j=m.width||0,h=m.height||0;return j&&h||("top"in m&&"bottom"in m&&(h=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(j=Math.abs(m.right-m.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,l||(o=fabric.util.transformPoint(o,fabric.util.invertTransform(this.viewportTransform))),i=0===j||0===h?{width:1,height:1}:{width:k.width/j,height:k.height/h},{x:o.x*i.width,y:o.y*i.height}},_createUpperCanvas:function(){var h=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+h),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var j=this.getWidth()||i.width,h=this.getHeight()||i.height;fabric.util.setStyle(i,{position:"absolute",width:j+"px",height:h+"px",left:0,top:0}),i.width=j,i.height=h,fabric.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,h){h.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(h){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=h,h.set("active",!0)},setActiveObject:function(h,i){return this._setActiveObject(h),this.renderAll(),this.fire("object:selected",{target:h,e:i}),h.fire("selected",{e:i}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(h){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:h}),this},_setActiveGroup:function(h){this._activeGroup=h,h&&h.set("active",!0)},setActiveGroup:function(i,h){return this._setActiveGroup(i),i&&(this.fire("object:selected",{target:i,e:h}),i.fire("selected",{e:h})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var h=this.getActiveGroup();h&&h.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(h){return this._discardActiveGroup(),this.fire("selection:cleared",{e:h}),this},deactivateAll:function(){for(var j=this.getObjects(),k=0,h=j.length;h>k;k++)j[k].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(i){var h=this.getActiveGroup()||this.getActiveObject();return h&&this.fire("before:selection:cleared",{target:h,e:i}),this.deactivateAll(),h&&this.fire("selection:cleared",{e:i}),this},drawControls:function(h){var i=this.getActiveGroup();i?this._drawGroupControls(h,i):this._drawObjectsControls(h)},_drawGroupControls:function(h,i){i._renderControls(h)},_drawObjectsControls:function(j){for(var k=0,h=this._objects.length;h>k;++k)this._objects[k]&&this._objects[k].active&&(this._objects[k]._renderControls(j),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[k])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),b(fabric.window,"resize",this._onResize),b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"mousewheel",this._onMouseWheel),b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mousewheel",this._onMouseWheel),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(f,d){this.__onTransformGesture&&this.__onTransformGesture(f,d)},_onDrag:function(f,d){this.__onDrag&&this.__onDrag(f,d)},_onMouseWheel:function(f,d){this.__onMouseWheel&&this.__onMouseWheel(f,d)},_onOrientationChange:function(f,d){this.__onOrientationChange&&this.__onOrientationChange(f,d)},_onShake:function(f,d){this.__onShake&&this.__onShake(f,d)},_onLongPress:function(f,d){this.__onLongPress&&this.__onLongPress(f,d)},_onMouseDown:function(d){this.__onMouseDown(d),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===d.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(d){if(this.__onMouseUp(d),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===d.type){var f=this;setTimeout(function(){b(f.upperCanvasEl,"mousedown",f._onMouseDown)},400)}},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,f){var d=this.getActiveGroup()||this.getActiveObject();return!!(e&&(e.isMoving||e!==d)||!e&&d||!e&&!d&&!this._groupSelector||f&&this._previousPointer&&this.selection&&(f.x!==this._previousPointer.x||f.y!==this._previousPointer.y))},__onMouseUp:function(f){var d;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(f);this._currentTransform?(this._finalizeCurrentTransform(),d=this._currentTransform.target):d=this.findTarget(f,!0);var g=this._shouldRender(d,this.getPointer(f));this._maybeGroupObjects(f),d&&(d.isMoving=!1),g&&this.renderAll(),this._handleCursorAndEvent(f,d)},_handleCursorAndEvent:function(f,d){this._setCursorFromEvent(f,d);var g=this;setTimeout(function(){g._setCursorFromEvent(f,d)},50),this.fire("mouse:up",{target:d,e:f}),d&&d.fire("mouseup",{e:f})},_finalizeCurrentTransform:function(){var d=this._currentTransform,e=d.target;e._scaling&&(e._scaling=!1),e.setCoords(),this.stateful&&e.hasStateChanged()&&(this.fire("object:modified",{target:e}),e.fire("modified")),this._restoreOriginXY(e)},_restoreOriginXY:function(e){if(this._previousOriginX&&this._previousOriginY){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=d.x,e.top=d.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(g){this._isCurrentlyDrawing=!0,this.discardActiveObject(g).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var d=fabric.util.invertTransform(this.viewportTransform),h=fabric.util.transformPoint(this.getPointer(g,!0),d);this.freeDrawingBrush.onMouseDown(h),this.fire("mouse:down",{e:g});var f=this.findTarget(g);"undefined"!=typeof f&&f.fire("mousedown",{e:g,target:f})},_onMouseMoveInDrawingMode:function(g){if(this._isCurrentlyDrawing){var d=fabric.util.invertTransform(this.viewportTransform),h=fabric.util.transformPoint(this.getPointer(g,!0),d);this.freeDrawingBrush.onMouseMove(h)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:g});var f=this.findTarget(g);"undefined"!=typeof f&&f.fire("mousemove",{e:g,target:f})},_onMouseUpInDrawingMode:function(f){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:f});var d=this.findTarget(f);"undefined"!=typeof d&&d.fire("mouseup",{e:f,target:d})},__onMouseDown:function(h){var d="which"in h?1===h.which:1===h.button;if(d||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(h);if(!this._currentTransform){var g=this.findTarget(h),j=this.getPointer(h,!0);this._previousPointer=j;var i=this._shouldRender(g,j),f=this._shouldGroup(h,g);this._shouldClearSelection(h,g)?this._clearSelection(h,g,j):f&&(this._handleGrouping(h,g),g=this.getActiveGroup()),g&&g.selectable&&!f&&(this._beforeTransform(h,g),this._setupCurrentTransform(h,g)),i&&this.renderAll(),this.fire("mouse:down",{target:g,e:h}),g&&g.fire("mousedown",{e:h})}}},_beforeTransform:function(f,d){this.stateful&&d.saveState(),d._findTargetCorner(this.getPointer(f))&&this.onBeforeScaleRotate(d),d!==this.getActiveGroup()&&d!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(d,f))},_clearSelection:function(f,d,g){this.deactivateAllWithDispatch(f),d&&d.selectable?this.setActiveObject(d,f):this.selection&&(this._groupSelector={ex:g.x,ey:g.y,top:0,left:0})},_setOriginToCenter:function(e){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var d=e.getCenterPoint();e.originX="center",e.originY="center",e.left=d.x,e.top=d.y,this._currentTransform.left=e.left,this._currentTransform.top=e.top},_setCenterToOrigin:function(e){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=d.x,e.top=d.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(g){var f,h;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(g);if(!("undefined"!=typeof g.touches&&g.touches.length>1)){var d=this._groupSelector;d?(h=this.getPointer(g,!0),d.left=h.x-d.ex,d.top=h.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(g):(f=this.findTarget(g),!f||f&&!f.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(g,f)),this.fire("mouse:move",{target:f,e:g}),f&&f.fire("mousemove",{e:g})}},_transformObject:function(f){var g=this.getPointer(f),d=this._currentTransform;d.reset=!1,d.target.isMoving=!0,this._beforeScaleTransform(f,d),this._performTransformAction(f,d,g),this.renderAll()},_performTransformAction:function(i,f,j){var d=j.x,k=j.y,h=f.target,g=f.action;"rotate"===g?(this._rotateObject(d,k),this._fire("rotating",h,i)):"scale"===g?(this._onScale(i,f,d,k),this._fire("scaling",h,i)):"scaleX"===g?(this._scaleObject(d,k,"x"),this._fire("scaling",h,i)):"scaleY"===g?(this._scaleObject(d,k,"y"),this._fire("scaling",h,i)):(this._translateObject(d,k),this._fire("moving",h,i),this.setCursor(this.moveCursor))},_fire:function(d,g,f){this.fire("object:"+d,{target:g,e:f}),g.fire(d,{e:f})},_beforeScaleTransform:function(g,d){if("scale"===d.action||"scaleX"===d.action||"scaleY"===d.action){var f=this._shouldCenterTransform(g,d.target);(f&&("center"!==d.originX||"center"!==d.originY)||!f&&"center"===d.originX&&"center"===d.originY)&&(this._resetCurrentTransform(g),d.reset=!0)}},_onScale:function(g,f,d,h){!g.shiftKey&&!this.uniScaleTransform||f.target.get("lockUniScaling")?(f.reset||"scale"!==f.currentAction||this._resetCurrentTransform(g,f.target),f.currentAction="scaleEqually",this._scaleObject(d,h,"equally")):(f.currentAction="scale",this._scaleObject(d,h))},_setCursorFromEvent:function(h,g){if(!g||!g.selectable)return this.setCursor(this.defaultCursor),!1;var d=this.getActiveGroup(),f=g._findTargetCorner&&(!d||!d.contains(g))&&g._findTargetCorner(this.getPointer(h,!0));return f?this._setCornerCursor(f,g):this.setCursor(g.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(d,e){if(d in a)this.setCursor(this._getRotatedCornerCursor(d,e));else{if("mtr"!==d||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(d,e){var f=Math.round(e.getAngle()%360/45);return 0>f&&(f+=8),f+=a[d],f%=8,this.cursorMap[f]}})}(),function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(f,d){var c=this.getActiveObject();return f.shiftKey&&(this.getActiveGroup()||c&&c!==d)&&this.selection},_handleGrouping:function(d,c){c===this.getActiveGroup()&&(c=this.findTarget(d,!0),!c||c.isType("group"))||(this.getActiveGroup()?this._updateActiveGroup(c,d):this._createActiveGroup(c,d),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(f,d){var c=this.getActiveGroup();if(c.contains(f)){if(c.removeWithUpdate(f),this._resetObjectTransform(c),f.set("active",!1),1===c.size())return this.discardActiveGroup(d),void this.setActiveObject(c.item(0))}else c.addWithUpdate(f),this._resetObjectTransform(c);this.fire("selection:created",{target:c,e:d}),c.set("active",!0)},_createActiveGroup:function(f,d){if(this._activeObject&&f!==this._activeObject){var c=this._createGroup(f);c.addWithUpdate(),this.setActiveGroup(c),this._activeObject=null,this.fire("selection:created",{target:c,e:d})}f.set("active",!0)},_createGroup:function(f){var e=this.getObjects(),c=e.indexOf(this._activeObject)<e.indexOf(f),d=c?[this._activeObject,f]:[f,this._activeObject];return new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],d):c.length>1&&(c=new fabric.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,d),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){for(var g,m=[],d=this._groupSelector.ex,k=this._groupSelector.ey,c=d+this._groupSelector.left,h=k+this._groupSelector.top,f=new fabric.Point(b(d,c),b(k,h)),j=new fabric.Point(a(d,c),a(k,h)),l=d===c&&k===h,e=this._objects.length;e--&&(g=this._objects[e],!(g&&g.selectable&&g.visible&&(g.intersectsWithRect(f,j)||g.isContainedWithinRect(f,j)||g.containsPoint(f)||g.containsPoint(j))&&(g.set("active",!0),m.push(g),l))););return m},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d);var c=this.getActiveGroup();c&&(c.setObjectsCoords().setCoords(),c.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",e=a.quality||1,d=a.multiplier||1,c={left:a.left,top:a.top,width:a.width,height:a.height};return 1!==d?this.__toDataURLWithMultiplier(b,e,c,d):this.__toDataURL(b,e,c)},__toDataURL:function(d,f,e){this.renderAll(!0);var b=this.upperCanvasEl||this.lowerCanvasEl,a=this.__getCroppedCanvas(b,e);"jpg"===d&&(d="jpeg");var c=fabric.StaticCanvas.supports("toDataURLWithQuality")?(a||b).toDataURL("image/"+d,f):(a||b).toDataURL("image/"+d);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),a&&(a=null),c},__getCroppedCanvas:function(c,e){var b,d,a="left"in e||"top"in e||"width"in e||"height"in e;return a&&(b=fabric.util.createCanvasElement(),d=b.getContext("2d"),b.width=e.width||this.width,b.height=e.height||this.height,d.drawImage(c,-e.left||0,-e.top||0)),b},__toDataURLWithMultiplier:function(g,h,b,k){var i=this.getWidth(),l=this.getHeight(),e=i*k,f=l*k,a=this.getActiveObject(),c=this.getActiveGroup(),j=this.contextTop||this.contextContainer;k>1&&this.setWidth(e).setHeight(f),j.scale(k,k),b.left&&(b.left*=k),b.top&&(b.top*=k),b.width?b.width*=k:1>k&&(b.width=e),b.height?b.height*=k:1>k&&(b.height=f),c?this._tempRemoveBordersControlsFromGroup(c):a&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var d=this.__toDataURL(g,h,b);return this.width=i,this.height=l,j.scale(1/k,1/k),this.setWidth(i).setHeight(l),
c?this._restoreBordersControlsOnGroup(c):a&&this.setActiveObject&&this.setActiveObject(a),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),d},toDataURLWithMultiplier:function(a,c,b){return this.toDataURL({format:a,multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls,a.origBorderColor=a.borderColor,a.hasControls=!0,a.borderColor="rgba(0,0,0,0)",a.forEachObject(function(b){b.origBorderColor=b.borderColor,b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls,a.borderColor=a.origBorderColor,a.forEachObject(function(b){b.borderColor=b.origBorderColor,delete b.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(b,c,a){return this.loadFromJSON(b,c,a)},loadFromJSON:function(b,e,a){if(b){var c="string"==typeof b?JSON.parse(b):b;this.clear();var d=this;return this._enlivenObjects(c.objects,function(){d._setBgOverlay(c,e)},a),this}},_setBgOverlay:function(c,e){var d=this,b={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(c.backgroundImage||c.overlayImage||c.background||c.overlay))return void(e&&e());var a=function(){b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor&&(d.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",c.backgroundImage,b,a),this.__setBgOverlay("overlayImage",c.overlayImage,b,a),this.__setBgOverlay("backgroundColor",c.background,b,a),this.__setBgOverlay("overlayColor",c.overlay,b,a),a()},__setBgOverlay:function(c,b,a,e){var d=this;return b?void("backgroundImage"===c||"overlayImage"===c?fabric.Image.fromObject(b,function(f){d[c]=f,a[c]=!0,e&&e()}):this["set"+fabric.util.string.capitalize(c,!0)](b,function(){a[c]=!0,e&&e()})):void(a[c]=!0)},_enlivenObjects:function(b,e,a){var d=this;if(!b||0===b.length)return void(e&&e());var c=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(b,function(f){f.forEach(function(h,g){d.insertAt(h,g,!0)}),d.renderOnAddRemove=c,e&&e()},null,a)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(c,a){var b=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(b,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=fabric.document.createElement("canvas");a.width=this.getWidth(),a.height=this.getHeight();var b=new fabric.Canvas(a);b.clipTo=this.clipTo,this.backgroundImage?(b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll(),c&&c(b)}),b.backgroundImageOpacity=this.backgroundImageOpacity,b.backgroundImageStretch=this.backgroundImageStretch):c&&c(b)}}),function(){var a=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(f,c){if(!this.isDrawingMode&&f.touches&&2===f.touches.length&&"gesture"===c.gesture){var d=this.findTarget(f);"undefined"!=typeof d&&(this.__gesturesParams={e:f,self:c,target:d},this.__gesturesRenderer()),this.fire("touch:gesture",{target:d,e:f,self:c})}},__gesturesParams:null,__gesturesRenderer:function(){if(null!==this.__gesturesParams&&null!==this._currentTransform){var c=this.__gesturesParams.self,d=this._currentTransform,f=this.__gesturesParams.e;d.action="scale",d.originX=d.originY="center",this._setOriginToCenter(d.target),this._scaleObjectBy(c.scale,f),0!==c.rotation&&(d.action="rotate",this._rotateObjectByAngle(c.rotation,f)),this.renderAll(),d.action="drag"}},__onDrag:function(d,c){this.fire("touch:drag",{e:d,self:c})},__onOrientationChange:function(d,c){this.fire("touch:orientation",{e:d,self:c})},__onShake:function(d,c){this.fire("touch:shake",{e:d,self:c})},__onLongPress:function(d,c){this.fire("touch:longpress",{e:d,self:c})},_scaleObjectBy:function(n,i){var m=this._currentTransform,j=m.target,l=j.get("lockScalingX"),k=j.get("lockScalingY");if(!l||!k){j._scaling=!0;var d=j.translateToOriginPoint(j.getCenterPoint(),m.originX,m.originY),c="line"===j.type&&0===j.width,f="line"===j.type&&0===j.height,h=f?0:j.strokeWidth,g=c?0:j.strokeWidth;this._setObjectScale(new fabric.Point(m.scaleX*n*(j.width+h),m.scaleY*n*(j.height+g)),m,l,k,null,j.get("lockScalingFlip")),j.setPositionByOrigin(d,m.originX,m.originY),this._fire("scaling",j,i)}},_rotateObjectByAngle:function(f,d){var c=this._currentTransform;c.target.get("lockRotation")||(c.target.angle=b(a(f)+c.theta),this._fire("rotating",c.target,d))}})}(),function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.degreesToRadians,f=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(h){h&&this.setOptions(h)},_initGradient:function(h){!h.fill||!h.fill.colorStops||h.fill instanceof e.Gradient||this.set("fill",new e.Gradient(h.fill)),!h.stroke||!h.stroke.colorStops||h.stroke instanceof e.Gradient||this.set("stroke",new e.Gradient(h.stroke))},_initPattern:function(h){!h.fill||!h.fill.source||h.fill instanceof e.Pattern||this.set("fill",new e.Pattern(h.fill)),!h.stroke||!h.stroke.source||h.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(h.stroke))},_initClipping:function(h){if(h.clipTo&&"string"==typeof h.clipTo){var i=e.util.getFunctionBody(h.clipTo);"undefined"!=typeof i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(h){for(var i in h)this.set(i,h[i]);this._initGradient(h),this._initPattern(h),this._initClipping(h)},transform:function(i,j){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(i);var h=j?this._getLeftTopCoords():this.getCenterPoint();i.translate(h.x,h.y),i.rotate(b(this.angle)),i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(j){var i=e.Object.NUM_FRACTION_DIGITS,h={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(h=this._removeDefaultValues(h)),e.util.populateWithProperties(this,h,j),h},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(i){var h=e.util.getKlass(i.type).prototype,j=h.stateProperties;return j.forEach(function(k){i[k]===h[k]&&delete i[k]}),i},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(h){return this[h]},_setObject:function(h){for(var i in h)this._set(i,h[i])},set:function(h,i){return"object"==typeof h?this._setObject(h):"function"==typeof i&&"clipTo"!==h?this._set(h,i(this.get(h))):this._set(h,i),this},_set:function(h,i){var j="scaleX"===h||"scaleY"===h;return j&&(i=this._constrainScale(i)),"scaleX"===h&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===h&&0>i?(this.flipY=!this.flipY,i*=-1):"width"===h||"height"===h?this.minScaleLimit=a(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==h||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[h]=i,this},toggle:function(i){var h=this.get(i);return"boolean"==typeof h&&this.set(i,!h),this},setSourcePath:function(h){return this.sourcePath=h,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(h,i){0===this.width&&0===this.height||!this.visible||(h.save(),this._setupCompositeOperation(h),i||this.transform(h),this._setStrokeStyles(h),this._setFillStyles(h),this.transformMatrix&&h.transform.apply(h,this.transformMatrix),this._setOpacity(h),this._setShadow(h),this.clipTo&&e.util.clipContext(this,h),this._render(h,i),this.clipTo&&h.restore(),h.restore())},_setOpacity:function(h){this.group&&this.group._setOpacity(h),h.globalAlpha*=this.opacity},_setStrokeStyles:function(h){this.stroke&&(h.lineWidth=this.strokeWidth,h.lineCap=this.strokeLineCap,h.lineJoin=this.strokeLineJoin,h.miterLimit=this.strokeMiterLimit,h.strokeStyle=this.stroke.toLive?this.stroke.toLive(h,this):this.stroke)},_setFillStyles:function(h){this.fill&&(h.fillStyle=this.fill.toLive?this.fill.toLive(h,this):this.fill)},_renderControls:function(i,k){if(this.active&&!k){var j=this.getViewportTransform();i.save();var h;this.group&&(h=e.util.transformPoint(this.group.getCenterPoint(),j),i.translate(h.x,h.y),i.rotate(b(this.group.angle))),h=e.util.transformPoint(this.getCenterPoint(),j,null!=this.group),this.group&&(h.x*=this.group.scaleX,h.y*=this.group.scaleY),i.translate(h.x,h.y),i.rotate(b(this.angle)),this.drawBorders(i),this.drawControls(i),i.restore()}},_setShadow:function(h){if(this.shadow){var j=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1;h.shadowColor=this.shadow.color,h.shadowBlur=this.shadow.blur*(j+i)*(this.scaleX+this.scaleY)/4,h.shadowOffsetX=this.shadow.offsetX*j*this.scaleX,h.shadowOffsetY=this.shadow.offsetY*i*this.scaleY}},_removeShadow:function(h){this.shadow&&(h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0)},_renderFill:function(h){if(this.fill){if(h.save(),this.fill.gradientTransform){var i=this.fill.gradientTransform;h.transform.apply(h,i)}this.fill.toLive&&h.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?h.fill("evenodd"):h.fill(),h.restore()}},_renderStroke:function(h){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f?(h.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(h)):this._renderDashedStroke&&this._renderDashedStroke(h),h.stroke();else{if(this.stroke.gradientTransform){var i=this.stroke.gradientTransform;h.transform.apply(h,i)}this._stroke?this._stroke(h):h.stroke()}h.restore()}},clone:function(i,h){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(h),i):new e.Object(this.toObject(h))},cloneAsImage:function(i){var h=this.toDataURL();return e.util.loadImage(h,function(j){i&&i(new e.Image(j))}),this},toDataURL:function(j){j||(j={});var k=e.util.createCanvasElement(),i=this.getBoundingRect();k.width=i.width,k.height=i.height,e.util.wrapElement(k,"div");var h=new e.StaticCanvas(k);"jpg"===j.format&&(j.format="jpeg"),"jpeg"===j.format&&(h.backgroundColor="#fff");var m={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(k.width/2,k.height/2),"center","center");var n=this.canvas;h.add(this);var l=h.toDataURL(j);return this.set(m).setCoords(),this.canvas=n,h.dispose(),h=null,l},isType:function(h){return this.type===h},complexity:function(){return 0},toJSON:function(h){return this.toObject(h)},setGradient:function(k,j){j||(j={});var l={colorStops:[]};l.type=j.type||(j.r1||j.r2?"radial":"linear"),l.coords={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2},(j.r1||j.r2)&&(l.coords.r1=j.r1,l.coords.r2=j.r2);for(var h in j.colorStops){var i=new e.Color(j.colorStops[h]);l.colorStops.push({offset:h,color:i.toRgb(),opacity:i.getAlpha()})}return this.set(k,e.Gradient.forObject(this,l))},setPatternFill:function(h){return this.set("fill",new e.Pattern(h))},setShadow:function(h){return this.set("shadow",h?new e.Shadow(h):null)},setColor:function(h){return this.set("fill",h),this},setAngle:function(i){var h=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return h&&this._setOriginToCenter(),this.set("angle",i),h&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(h,i){i=i||this.canvas.getPointer(h);var j=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:i.x-j.x,y:i.y-j.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,g(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,e,d){var b=c.x,f=c.y;return"left"===e?b=c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===e&&(b=c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2),"top"===d?f=c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===d&&(f=c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},translateToOriginPoint:function(c,e,d){var b=c.x,f=c.y;return"left"===e?b=c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===e&&(b=c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2),"top"===d?f=c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===d&&(f=c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},getCenterPoint:function(){var b=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(d,c){var b=this.getCenterPoint();return this.translateToOriginPoint(b,d,c)},toLocalPoint:function(d,f,e){var b,g,c=this.getCenterPoint();return f&&e?(b="left"===f?c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===f?c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:c.x,g="top"===e?c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===e?c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:c.y):(b=this.left,g=this.top),fabric.util.rotatePoint(new fabric.Point(d.x,d.y),c,-a(this.angle)).subtractEquals(new fabric.Point(b,g))},setPositionByOrigin:function(f,e,d){var c=this.translateToCenterPoint(f,e,d),b=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",b.x),this.set("top",b.y)},adjustPosition:function(i){var g=a(this.angle),h=this.getWidth()/2,f=Math.cos(g)*h,c=Math.sin(g)*h,e=this.getWidth(),d=Math.cos(g)*e,b=Math.sin(g)*e;"center"===this.originX&&"left"===i||"right"===this.originX&&"center"===i?(this.left-=f,this.top-=c):"left"===this.originX&&"center"===i||"center"===this.originX&&"right"===i?(this.left+=f,this.top+=c):"left"===this.originX&&"right"===i?(this.left+=d,this.top+=b):"right"===this.originX&&"left"===i&&(this.left-=d,this.top-=b),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originX="center",this.originY="center",this.left=b.x,this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=b.x,this.top=b.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(c,e){var i=this.oCoords,b=new fabric.Point(i.tl.x,i.tl.y),f=new fabric.Point(i.tr.x,i.tr.y),h=new fabric.Point(i.bl.x,i.bl.y),d=new fabric.Point(i.br.x,i.br.y),g=fabric.Intersection.intersectPolygonRectangle([b,f,d,h],c,e);return"Intersection"===g.status},intersectsWithObject:function(b){function c(g){return{tl:new fabric.Point(g.tl.x,g.tl.y),tr:new fabric.Point(g.tr.x,g.tr.y),bl:new fabric.Point(g.bl.x,g.bl.y),br:new fabric.Point(g.br.x,g.br.y)}}var d=c(this.oCoords),f=c(b.oCoords),e=fabric.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[f.tl,f.tr,f.br,f.bl]);return"Intersection"===e.status},isContainedWithinObject:function(b){var c=b.getBoundingRect(),e=new fabric.Point(c.left,c.top),d=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(e,d)},isContainedWithinRect:function(b,d){var c=this.getBoundingRect();return c.left>=b.x&&c.left+c.width<=d.x&&c.top>=b.y&&c.top+c.height<=d.y},containsPoint:function(b){var d=this._getImageLines(this.oCoords),c=this._findCrossPoints(b,d);return 0!==c&&c%2===1},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(k,b){var j,i,d,c,h,g,e,f=0;for(var l in b)if(e=b[l],!(e.o.y<k.y&&e.d.y<k.y||e.o.y>=k.y&&e.d.y>=k.y||(e.o.x===e.d.x&&e.o.x>=k.x?(h=e.o.x,g=k.y):(j=0,i=(e.d.y-e.o.y)/(e.d.x-e.o.x),d=k.y-j*k.x,c=e.o.y-i*e.o.x,h=-(d-c)/(j-i),g=d+j*h),h>=k.x&&(f+=1),2!==f)))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],c=fabric.util.array.min(d),h=fabric.util.array.max(d),f=Math.abs(c-h),e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],i=fabric.util.array.min(e),g=fabric.util.array.max(e),b=Math.abs(i-g);return{left:c,top:i,width:f,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?0>b?-this.minScaleLimit:this.minScaleLimit:b},scale:function(b){return b=this._constrainScale(b),0>b&&(this.flipX=!this.flipX,this.flipY=!this.flipY,b*=-1),this.scaleX=b,this.scaleY=b,this.setCoords(),this},scaleToWidth:function(c){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/b)},scaleToHeight:function(c){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/b)},setCoords:function(){var j=a(this.angle),B=this.getViewportTransform(),x=function(f){return fabric.util.transformPoint(f,B)},q=this._calculateCurrentDimensions(!1),l=q.x,e=q.y;0>l&&(l=Math.abs(l));var m=Math.sqrt(Math.pow(l/2,2)+Math.pow(e/2,2)),k=Math.atan(isFinite(e/l)?e/l:0),z=Math.cos(k+j)*m,y=Math.sin(k+j)*m,w=Math.sin(j),n=Math.cos(j),u=this.getCenterPoint(),h=new fabric.Point(l,e),t=new fabric.Point(u.x-z,u.y-y),o=new fabric.Point(t.x+h.x*n,t.y+h.x*w),d=x(new fabric.Point(t.x-h.y*w,t.y+h.y*n)),A=x(new fabric.Point(o.x-h.y*w,o.y+h.y*n)),g=x(t),c=x(o),v=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),r=new fabric.Point((c.x+g.x)/2,(c.y+g.y)/2),s=new fabric.Point((A.x+c.x)/2,(A.y+c.y)/2),b=new fabric.Point((A.x+d.x)/2,(A.y+d.y)/2),i=new fabric.Point(r.x+w*this.rotatingPointOffset,r.y-n*this.rotatingPointOffset);return this.oCoords={tl:g,tr:c,br:A,bl:d,ml:v,mt:r,mr:s,mb:b,mtr:i},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var i=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",d=this.fillRule,j=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",h=this.strokeWidth?this.strokeWidth:"0",g=this.strokeDashArray?this.strokeDashArray.join(" "):"",k=this.strokeLineCap?this.strokeLineCap:"butt",e=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",f="undefined"!=typeof this.opacity?this.opacity:"1",a=this.visible?"":" visibility: hidden;",b=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",j,"; ","stroke-width: ",h,"; ","stroke-dasharray: ",g,"; ","stroke-linecap: ",k,"; ","stroke-linejoin: ",e,"; ","stroke-miterlimit: ",c,"; ","fill: ",i,"; ","fill-rule: ",d,"; ","opacity: ",f,";",b,a].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var b=fabric.util.toFixed,e=this.getAngle(),h=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],a=fabric.util.transformPoint(this.getCenterPoint(),h),l=fabric.Object.NUM_FRACTION_DIGITS,f="path-group"===this.type?"":"translate("+b(a.x,l)+" "+b(a.y,l)+")",k=0!==e?" rotate("+b(e,l)+")":"",g=1===this.scaleX&&1===this.scaleY&&1===h[0]&&1===h[3]?"":" scale("+b(this.scaleX*h[0],l)+" "+b(this.scaleY*h[3],l)+")",d="path-group"===this.type?this.width*h[0]:0,j=this.flipX?" matrix(-1 0 0 1 "+d+" 0) ":"",c="path-group"===this.type?this.height*h[3]:0,i=this.flipY?" matrix(1 0 0 -1 0 "+c+")":"";return[f,k,g,j,i].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){return this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this),a&&a.stateProperties&&a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var a=fabric.util.degreesToRadians,b=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(h){if(!this.hasControls||!this.active)return!1;var d,c,g=h.x,e=h.y;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),d=this._findCrossPoints({x:g,y:e},c),0!==d&&d%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var d,j,i=this.oCoords,g=a(45-this.angle),h=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,e=h*Math.cos(g),f=h*Math.sin(g);for(var c in i)d=i[c].x,j=i[c].y,i[c].corner={tl:{x:d-f,y:j-e},tr:{x:d+e,y:j-f},bl:{x:d-e,y:j+f},br:{x:d+f,y:j+e}}},_calculateCurrentDimensions:function(d){var l=this.getViewportTransform(),m=this.strokeWidth,n=this.width,i=this.height,k="round"===this.strokeLineCap||"square"===this.strokeLineCap,c="line"===this.type&&0===this.width,f="line"===this.type&&0===this.height,g=c||f,j=k&&f||!g,e=k&&c||!g;return c?n=m:f&&(i=m),j&&(n+=0>n?-m:m),e&&(i+=0>i?-m:m),n=n*this.scaleX+2*this.padding,i=i*this.scaleY+2*this.padding,d?fabric.util.transformPoint(new fabric.Point(n,i),l,!0):{x:n,y:i}},drawBorders:function(e){if(!this.hasBorders)return this;e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,e.strokeStyle=this.borderColor,e.lineWidth=1/this.borderScaleFactor;var d=this._calculateCurrentDimensions(!0),f=d.x,c=d.y;if(this.group&&(f*=this.group.scaleX,c*=this.group.scaleY),e.strokeRect(~~-(f/2)-.5,~~-(c/2)-.5,~~f+1,~~c+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var g=-c/2;e.beginPath(),e.moveTo(0,g),e.lineTo(0,g-this.rotatingPointOffset),e.closePath(),e.stroke()}return e.restore(),this},drawControls:function(f){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(!0),h=e.x,d=e.y,j=-(h/2),i=-(d/2),c=this.cornerSize/2,g=this.transparentCorners?"strokeRect":"fillRect";return f.save(),f.lineWidth=1,f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,f.strokeStyle=f.fillStyle=this.cornerColor,this._drawControl("tl",f,g,j-c,i-c),this._drawControl("tr",f,g,j+h-c,i-c),this._drawControl("bl",f,g,j-c,i+d-c),this._drawControl("br",f,g,j+h-c,i+d-c),this.get("lockUniScaling")||(this._drawControl("mt",f,g,j+h/2-c,i-c),this._drawControl("mb",f,g,j+h/2-c,i+d-c),this._drawControl("mr",f,g,j+h-c,i+d/2-c),this._drawControl("ml",f,g,j-c,i+d/2-c)),this.hasRotatingPoint&&this._drawControl("mtr",f,g,j+h/2-c,i-this.rotatingPointOffset-c),f.restore(),this},_drawControl:function(h,c,d,g,f){if(this.isControlVisible(h)){var e=this.cornerSize;b()||this.transparentCorners||c.clearRect(g,f,e,e),c[d](g,f,e,e)}},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,d){return this._getControlsVisibility()[c]=d,this},setControlsVisibility:function(c){c||(c={});for(var d in c)this.setControlVisible(d,c[d]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;return fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g),f.renderAll(),a()},onComplete:function(){b.setCoords(),e()}}),this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;return fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g),f.renderAll(),a()},onComplete:function(){b.setCoords(),e()}}),this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;return fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.set("active",!1)},onChange:function(g){b.set("opacity",g),f.renderAll(),a()},onComplete:function(){f.remove(b),e()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var d,b,e=[];for(d in arguments[0])e.push(d);for(var c=0,a=e.length;a>c;c++)d=e[c],b=c!==a-1,this._animate(d,arguments[0][d],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(e,g,c,a){var b,f=this;g=g.toString(),c=c?fabric.util.object.clone(c):{},~e.indexOf(".")&&(b=e.split("."));var d=b?this.get(b[0])[b[1]]:this.get(e);"from"in c||(c.from=d),g=~g.indexOf("=")?d+parseFloat(g.replace("=","")):parseFloat(g),fabric.util.animate({startValue:c.from,endValue:g,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(h){b?f[b[0]][b[1]]=h:f.set(e,h),a||c.onChange&&c.onChange()},onComplete:function(){a||(f.setCoords(),c.onComplete&&c.onComplete())}})}}),function(b){function e(h,m){var k=h.origin,n=h.axis1,l=h.axis2,j=h.dimension,i=m.nearest,g=m.center,o=m.farthest;return function(){switch(this.get(k)){case i:return Math.min(this.get(n),this.get(l));case g:return Math.min(this.get(n),this.get(l))+.5*this.get(j);case o:return Math.max(this.get(n),this.get(l))}}}var c=b.fabric||(b.fabric={}),f=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(h,g){g=g||{},h||(h=[0,0,0,0]),this.callSuper("initialize",g),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(g)},_setWidthHeight:function(g){g||(g={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in g?g.left:this._getLeftToOriginX(),this.top="top"in g?g.top:this._getTopToOriginY()},_set:function(g,h){return this.callSuper("_set",g,h),"undefined"!=typeof a[g]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(g,j){if(g.beginPath(),j){var i=this.getCenterPoint();g.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&d){var h=this.calcLinePoints();g.moveTo(h.x1,h.y1),g.lineTo(h.x2,h.y2)}g.lineWidth=this.strokeWidth;var k=g.strokeStyle;g.strokeStyle=this.stroke||g.fillStyle,this.stroke&&this._renderStroke(g),g.strokeStyle=k},_renderDashedStroke:function(g){var h=this.calcLinePoints();g.beginPath(),c.util.drawDashedLine(g,h.x1,h.y1,h.x2,h.y2,this.strokeDashArray),g.closePath()},toObject:function(g){return f(this.callSuper("toObject",g),this.calcLinePoints())},calcLinePoints:function(){var l=this.x1<=this.x2?-1:1,k=this.y1<=this.y2?-1:1,h=l*this.width*.5,j=k*this.height*.5,g=l*this.width*-.5,i=k*this.height*-.5;return{x1:h,x2:g,y1:j,y2:i}},toSVG:function(g){var h=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),h.push("<line ",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),g?g(h.join("")):h.join("")},complexity:function(){return 1}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(h,g){var j=c.parseAttributes(h,c.Line.ATTRIBUTE_NAMES),i=[j.x1||0,j.y1||0,j.x2||0,j.y2||0];return new c.Line(i,f(j,g))},void(c.Line.fromObject=function(g){var h=[g.x1,g.y1,g.x2,g.y2];return new c.Line(h,g)}));
}("undefined"!=typeof exports?exports:this),function(a){function c(f){return"radius"in f&&f.radius>=0}var b=a.fabric||(a.fabric={}),d=Math.PI,e=b.util.object.extend;return b.Circle?void b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(f){f=f||{},this.callSuper("initialize",f),this.set("radius",f.radius||0),this.startAngle=f.startAngle||this.startAngle,this.endAngle=f.endAngle||this.endAngle},_set:function(f,g){return this.callSuper("_set",f,g),"radius"===f&&this.setRadius(g),this},toObject:function(f){return e(this.callSuper("toObject",f),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(j){var n=this._createBaseSVGMarkup(),k=0,i=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)this.group&&"path-group"===this.group.type&&(k=this.left+this.radius,i=this.top+this.radius),n.push("<circle ",'cx="'+k+'" cy="'+i+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var h=Math.cos(this.startAngle)*this.radius,g=Math.sin(this.startAngle)*this.radius,m=Math.cos(this.endAngle)*this.radius,l=Math.sin(this.endAngle)*this.radius,o=f>d?"1":"0";n.push('<path d="M '+h+" "+g," A "+this.radius+" "+this.radius," 0 ",+o+" 1"," "+m+" "+l,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return j?j(n.join("")):n.join("")},_render:function(f,g){f.beginPath(),f.arc(g?this.left+this.radius:0,g?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(f),this._renderStroke(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){this.radius=f,this.set("width",2*f).set("height",2*f)},complexity:function(){return 1}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h))throw new Error("value of `r` attribute is required and can not be negative");h.left=h.left||0,h.top=h.top||0;var i=new b.Circle(e(h,f));return i.left-=i.radius,i.top-=i.radius,i},void(b.Circle.fromObject=function(f){return new b.Circle(f)}))}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{},this.callSuper("initialize",c),this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath(),c.moveTo(-d,e),c.lineTo(0,-e),c.lineTo(d,e),c.closePath(),this._renderFill(c),this._renderStroke(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath(),b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray),b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray),b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray),c.closePath()},toSVG:function(c){var d=this._createBaseSVGMarkup(),e=this.width/2,f=this.height/2,g=[-e+" "+f,"0 "+-f,e+" "+f].join(",");return d.push("<polygon ",'points="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),c?c(d.join("")):d.join("")},complexity:function(){return 1}}),void(b.Triangle.fromObject=function(c){return new b.Triangle(c)}))}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("rx",e.rx||0),this.set("ry",e.ry||0)},_set:function(e,f){switch(this.callSuper("_set",e,f),e){case"rx":this.rx=f,this.set("width",2*f);break;case"ry":this.ry=f,this.set("height",2*f)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(f){var g=this._createBaseSVGMarkup(),e=0,h=0;return this.group&&"path-group"===this.group.type&&(e=this.left+this.rx,h=this.top+this.ry),g.push("<ellipse ",'cx="',e,'" cy="',h,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),f?f(g.join("")):g.join("")},_render:function(e,f){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(f?this.left+this.rx:0,f?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1),e.restore(),this._renderFill(e),this._renderStroke(e)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(f,e){e||(e={});var h=b.parseAttributes(f,b.Ellipse.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0;var g=new b.Ellipse(d(h,e));return g.top-=g.ry,g.left-=g.rx,g},void(b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}))}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),d=b.util.object.extend;if(b.Rect)return void console.warn("fabric.Rect is already defined");var c=b.Object.prototype.stateProperties.concat();c.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:c,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(e){e=e||{},this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(p,g){if(1===this.width&&1===this.height)return void p.fillRect(0,0,1,1);var f=this.rx?Math.min(this.rx,this.width/2):0,e=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,j=this.height,n=g?this.left:-this.width/2,m=g?this.top:-this.height/2,l=0!==f||0!==e,i=.4477152502;p.beginPath(),p.moveTo(n+f,m),p.lineTo(n+o-f,m),l&&p.bezierCurveTo(n+o-i*f,m,n+o,m+i*e,n+o,m+e),p.lineTo(n+o,m+j-e),l&&p.bezierCurveTo(n+o,m+j-i*e,n+o-i*f,m+j,n+o-f,m+j),p.lineTo(n+f,m+j),l&&p.bezierCurveTo(n+i*f,m+j,n,m+j-i*e,n,m+j-e),p.lineTo(n,m+e),l&&p.bezierCurveTo(n,m+i*e,n+i*f,m,n+f,m),p.closePath(),this._renderFill(p),this._renderStroke(p)},_renderDashedStroke:function(g){var e=-this.width/2,j=-this.height/2,f=this.width,i=this.height;g.beginPath(),b.util.drawDashedLine(g,e,j,e+f,j,this.strokeDashArray),b.util.drawDashedLine(g,e+f,j,e+f,j+i,this.strokeDashArray),b.util.drawDashedLine(g,e+f,j+i,e,j+i,this.strokeDashArray),b.util.drawDashedLine(g,e,j+i,e,j,this.strokeDashArray),g.closePath()},toObject:function(f){var e=d(this.callSuper("toObject",f),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(f){var g=this._createBaseSVGMarkup(),e=this.left,h=this.top;return this.group&&"path-group"===this.group.type||(e=-this.width/2,h=-this.height/2),g.push("<rect ",'x="',e,'" y="',h,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),f?f(g.join("")):g.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(f,e){if(!f)return null;e=e||{};var h=b.parseAttributes(f,b.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0;var g=new b.Rect(d(e?b.util.object.clone(e):{},h));return g.visible=g.width>0&&g.height>0,g},b.Rect.fromObject=function(e){return new b.Rect(e)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,c){return b.Polygon.prototype.initialize.call(this,d,c)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return b.Polygon.prototype._applyPointOffset.call(this)},toObject:function(c){return b.Polygon.prototype.toObject.call(this,c)},toSVG:function(c){return b.Polygon.prototype.toSVG.call(this,c)},_render:function(c){b.Polygon.prototype.commonRender.call(this,c)&&(this._renderFill(c),this._renderStroke(c))},_renderDashedStroke:function(d){var g,f;d.beginPath();for(var e=0,c=this.points.length;c>e;e++)g=this.points[e],f=this.points[e+1]||g,b.util.drawDashedLine(d,g.x,g.y,f.x,f.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(d,c){if(!d)return null;c||(c={});var e=b.parsePointsAttribute(d.getAttribute("points")),f=b.parseAttributes(d,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(e,b.util.object.extend(f,c))},void(b.Polyline.fromObject=function(c){var d=c.points;return new b.Polyline(d,c,!0)}))}("undefined"!=typeof exports?exports:this),function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;return e.Polygon?void e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(h,g){g=g||{},this.points=h||[],this.callSuper("initialize",g),this._calcDimensions(),"top"in g||(this.top=this.minY),"left"in g||(this.left=this.minX)},_calcDimensions:function(){var h=this.points,g=c(h,"x"),k=c(h,"y"),j=b(h,"x"),i=b(h,"y");this.width=j-g||0,this.height=i-k||0,this.minX=g||0,this.minY=k||0},_applyPointOffset:function(){this.points.forEach(function(g){g.x-=this.minX+this.width/2,g.y-=this.minY+this.height/2},this)},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},toSVG:function(h){for(var l=[],j=this._createBaseSVGMarkup(),k=0,g=this.points.length;g>k;k++)l.push(a(this.points[k].x,2),",",a(this.points[k].y,2)," ");return j.push("<",this.type," ",'points="',l.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),h?h(j.join("")):j.join("")},_render:function(g){this.commonRender(g)&&(this._renderFill(g),(this.stroke||this.strokeDashArray)&&(g.closePath(),this._renderStroke(g)))},commonRender:function(j){var h,g=this.points.length;if(!g||isNaN(this.points[g-1].y))return!1;j.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null),j.moveTo(this.points[0].x,this.points[0].y);for(var k=0;g>k;k++)h=this.points[k],j.lineTo(h.x,h.y);return!0},_renderDashedStroke:function(g){e.Polyline.prototype._renderDashedStroke.call(this,g),g.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(h,g){if(!h)return null;g||(g={});var i=e.parsePointsAttribute(h.getAttribute("points")),j=e.parseAttributes(h,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(i,f(j,g))},void(e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g,!0)}))}("undefined"!=typeof exports?exports:this),function(a){var c=a.fabric||(a.fabric={}),d=c.util.array.min,g=c.util.array.max,f=c.util.object.extend,b=Object.prototype.toString,h=c.util.drawArc,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},e={m:"l",M:"L"};return c.Path?void c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(l,k){if(k=k||{},this.setOptions(k),!l)throw new Error("`path` argument is required");var j="[object Array]"===b.call(l);this.path=j?l:l.match&&l.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(j||(this.path=this._parsePath()),this._setPositionDimensions(k),k.sourcePath&&this.setSourcePath(k.sourcePath))},_setPositionDimensions:function(k){var j=this._parseDimensions();this.minX=j.left,this.minY=j.top,this.width=j.width,this.height=j.height,"undefined"==typeof k.left&&(this.left=j.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),"undefined"==typeof k.top&&(this.top=j.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(z){var r,o,n,p=null,B=0,w=0,u=0,s=0,j=0,A=0,k=-this.pathOffset.x,v=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(k=0,v=0),z.beginPath();for(var m=0,q=this.path.length;q>m;++m){switch(r=this.path[m],r[0]){case"l":u+=r[1],s+=r[2],z.lineTo(u+k,s+v);break;case"L":u=r[1],s=r[2],z.lineTo(u+k,s+v);break;case"h":u+=r[1],z.lineTo(u+k,s+v);break;case"H":u=r[1],z.lineTo(u+k,s+v);break;case"v":s+=r[1],z.lineTo(u+k,s+v);break;case"V":s=r[1],z.lineTo(u+k,s+v);break;case"m":u+=r[1],s+=r[2],B=u,w=s,z.moveTo(u+k,s+v);break;case"M":u=r[1],s=r[2],B=u,w=s,z.moveTo(u+k,s+v);break;case"c":o=u+r[5],n=s+r[6],j=u+r[3],A=s+r[4],z.bezierCurveTo(u+r[1]+k,s+r[2]+v,j+k,A+v,o+k,n+v),u=o,s=n;break;case"C":u=r[5],s=r[6],j=r[3],A=r[4],z.bezierCurveTo(r[1]+k,r[2]+v,j+k,A+v,u+k,s+v);break;case"s":o=u+r[3],n=s+r[4],null===p[0].match(/[CcSs]/)?(j=u,A=s):(j=2*u-j,A=2*s-A),z.bezierCurveTo(j+k,A+v,u+r[1]+k,s+r[2]+v,o+k,n+v),j=u+r[1],A=s+r[2],u=o,s=n;break;case"S":o=r[3],n=r[4],null===p[0].match(/[CcSs]/)?(j=u,A=s):(j=2*u-j,A=2*s-A),z.bezierCurveTo(j+k,A+v,r[1]+k,r[2]+v,o+k,n+v),u=o,s=n,j=r[1],A=r[2];break;case"q":o=u+r[3],n=s+r[4],j=u+r[1],A=s+r[2],z.quadraticCurveTo(j+k,A+v,o+k,n+v),u=o,s=n;break;case"Q":o=r[3],n=r[4],z.quadraticCurveTo(r[1]+k,r[2]+v,o+k,n+v),u=o,s=n,j=r[1],A=r[2];break;case"t":o=u+r[1],n=s+r[2],null===p[0].match(/[QqTt]/)?(j=u,A=s):(j=2*u-j,A=2*s-A),z.quadraticCurveTo(j+k,A+v,o+k,n+v),u=o,s=n;break;case"T":o=r[1],n=r[2],null===p[0].match(/[QqTt]/)?(j=u,A=s):(j=2*u-j,A=2*s-A),z.quadraticCurveTo(j+k,A+v,o+k,n+v),u=o,s=n;break;case"a":h(z,u+k,s+v,[r[1],r[2],r[3],r[4],r[5],r[6]+u+k,r[7]+s+v]),u+=r[6],s+=r[7];break;case"A":h(z,u+k,s+v,[r[1],r[2],r[3],r[4],r[5],r[6]+k,r[7]+v]),u=r[6],s=r[7];break;case"z":case"Z":u=B,s=w,z.closePath()}p=r}this._renderFill(z),this._renderStroke(z)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(k){var j=f(this.callSuper("toObject",k),{path:this.path.map(function(l){return l.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(j.sourcePath=this.sourcePath),this.transformMatrix&&(j.transformMatrix=this.transformMatrix),j},toDatalessObject:function(k){var j=this.toObject(k);return this.sourcePath&&(j.path=this.sourcePath),delete j.sourcePath,j},toSVG:function(k){for(var p=[],l=this._createBaseSVGMarkup(),m="",n=0,j=this.path.length;j>n;n++)p.push(this.path[n].join(" "));var o=p.join(" ");return this.group&&"path-group"===this.group.type||(m=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),l.push("<path ",'d="',o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),m,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),k?k(l.join("")):l.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var x,u,r,l,v,B=[],w=[],z=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,p=0,s=this.path.length;s>p;p++){for(x=this.path[p],l=x.slice(1).trim(),w.length=0;r=z.exec(l);)w.push(r[0]);v=[x.charAt(0)];for(var o=0,y=w.length;y>o;o++)u=parseFloat(w[o]),isNaN(u)||v.push(u);var n=v[0],A=i[n.toLowerCase()],q=e[n]||n;if(v.length-1>A)for(var m=1,t=v.length;t>m;m+=A)B.push([n].concat(v.slice(m,m+A))),n=q;else B.push(v)}return B},_parseDimensions:function(){for(var v,q,p,r,n=[],k=[],m=null,B=0,A=0,t=0,s=0,l=0,j=0,w=0,z=this.path.length;z>w;++w){switch(v=this.path[w],v[0]){case"l":t+=v[1],s+=v[2],r=[];break;case"L":t=v[1],s=v[2],r=[];break;case"h":t+=v[1],r=[];break;case"H":t=v[1],r=[];break;case"v":s+=v[1],r=[];break;case"V":s=v[1],r=[];break;case"m":t+=v[1],s+=v[2],B=t,A=s,r=[];break;case"M":t=v[1],s=v[2],B=t,A=s,r=[];break;case"c":q=t+v[5],p=s+v[6],l=t+v[3],j=s+v[4],r=c.util.getBoundsOfCurve(t,s,t+v[1],s+v[2],l,j,q,p),t=q,s=p;break;case"C":t=v[5],s=v[6],l=v[3],j=v[4],r=c.util.getBoundsOfCurve(t,s,v[1],v[2],l,j,t,s);break;case"s":q=t+v[3],p=s+v[4],null===m[0].match(/[CcSs]/)?(l=t,j=s):(l=2*t-l,j=2*s-j),r=c.util.getBoundsOfCurve(t,s,l,j,t+v[1],s+v[2],q,p),l=t+v[1],j=s+v[2],t=q,s=p;break;case"S":q=v[3],p=v[4],null===m[0].match(/[CcSs]/)?(l=t,j=s):(l=2*t-l,j=2*s-j),r=c.util.getBoundsOfCurve(t,s,l,j,v[1],v[2],q,p),t=q,s=p,l=v[1],j=v[2];break;case"q":q=t+v[3],p=s+v[4],l=t+v[1],j=s+v[2],r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p),t=q,s=p;break;case"Q":l=v[1],j=v[2],r=c.util.getBoundsOfCurve(t,s,l,j,l,j,v[3],v[4]),t=v[3],s=v[4];break;case"t":q=t+v[1],p=s+v[2],null===m[0].match(/[QqTt]/)?(l=t,j=s):(l=2*t-l,j=2*s-j),r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p),t=q,s=p;break;case"T":q=v[1],p=v[2],null===m[0].match(/[QqTt]/)?(l=t,j=s):(l=2*t-l,j=2*s-j),r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p),t=q,s=p;break;case"a":r=c.util.getBoundsOfArc(t,s,v[1],v[2],v[3],v[4],v[5],v[6]+t,v[7]+s),t+=v[6],s+=v[7];break;case"A":r=c.util.getBoundsOfArc(t,s,v[1],v[2],v[3],v[4],v[5],v[6],v[7]),t=v[6],s=v[7];break;case"z":case"Z":t=B,s=A}m=v,r.forEach(function(o){n.push(o.x),k.push(o.y)}),n.push(t),k.push(s)}var F=d(n),E=d(k),D=g(n),C=g(k),H=D-F,G=C-E,u={left:F,top:E,width:H,height:G};return u}}),c.Path.fromObject=function(j,k){"string"==typeof j.path?c.loadSVGFromURL(j.path,function(l){var m=l[0],n=j.path;delete j.path,c.util.object.extend(m,j),m.setSourcePath(n),k(m)}):k(new c.Path(j.path,j))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(k,m,j){var l=c.parseAttributes(k,c.Path.ATTRIBUTE_NAMES);m&&m(new c.Path(l.d,f(l,j)))},void(c.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(c){var d=c.fabric||(c.fabric={}),e=d.util.object.extend,a=d.util.array.invoke,b=d.Object.prototype.toObject;return d.PathGroup?void d.warn("fabric.PathGroup is already defined"):(d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(h,f){f=f||{},this.paths=h||[];for(var g=this.paths.length;g--;)this.paths[g].group=this;f.toBeParsed&&(this.parseDimensionsFromPaths(f),delete f.toBeParsed),this.setOptions(f),this.setCoords(),f.sourcePath&&this.setSourcePath(f.sourcePath)},parseDimensionsFromPaths:function(t){for(var o,f,s,q,g,k=[],r=[],h=this.transformMatrix,l=this.paths.length;l--;){s=this.paths[l],q=s.height+s.strokeWidth,g=s.width+s.strokeWidth,o=[{x:s.left,y:s.top},{x:s.left+g,y:s.top},{x:s.left,y:s.top+q},{x:s.left+g,y:s.top+q}];for(var n=0;n<o.length;n++)f=o[n],h&&(f=d.util.transformPoint(f,h,!1)),k.push(f.x),r.push(f.y)}t.width=Math.max.apply(null,k),t.height=Math.max.apply(null,r)},render:function(g){if(this.visible){g.save(),this.transformMatrix&&g.transform.apply(g,this.transformMatrix),this.transform(g),this._setShadow(g),this.clipTo&&d.util.clipContext(this,g),g.translate(-this.width/2,-this.height/2);for(var h=0,f=this.paths.length;f>h;++h)this.paths[h].render(g,!0);this.clipTo&&g.restore(),g.restore()}},_set:function(h,g){if("fill"===h&&g&&this.isSameColor())for(var f=this.paths.length;f--;)this.paths[f]._set(h,g);return this.callSuper("_set",h,g)},toObject:function(g){var f=e(b.call(this,g),{paths:a(this.getObjects(),"toObject",g)});return this.sourcePath&&(f.sourcePath=this.sourcePath),f},toDatalessObject:function(g){var f=this.toObject(g);return this.sourcePath&&(f.paths=this.sourcePath),f},toSVG:function(h){for(var l=this.getObjects(),m=this.getPointByOrigin("left","top"),g="translate("+m.x+" "+m.y+")",j=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),g,this.getSvgTransform(),'" ',">\n"],k=0,f=l.length;f>k;k++)j.push(l[k].toSVG(h));return j.push("</g>\n"),h?h(j.join("")):j.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var f=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(g){return(g.get("fill")||"").toLowerCase()===f})},complexity:function(){return this.paths.reduce(function(f,g){return f+(g&&g.complexity?g.complexity():0)},0)},getObjects:function(){return this.paths}}),d.PathGroup.fromObject=function(f,g){"string"==typeof f.paths?d.loadSVGFromURL(f.paths,function(i){var j=f.paths;delete f.paths;var h=d.util.groupSVGElements(i,f,j);g(h)}):d.util.enlivenObjects(f.paths,function(h){delete f.paths,g(new d.PathGroup(h,f))})},void(d.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(!e.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,initialize:function(k,h){h=h||{},this._objects=k||[];for(var j=this._objects.length;j--;)this._objects[j].group=this;this.originalState={},h.originX&&(this.originX=h.originX),h.originY&&(this.originY=h.originY),this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",h),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(i){var j=i.getLeft(),k=i.getTop(),h=this.getCenterPoint();i.set({originalLeft:j,originalTop:k,left:j-h.x,top:k-h.y}),i.setCoords(),i.__origHasControls=i.hasControls,i.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(h){return this._restoreObjectsState(),h&&(this._objects.push(h),h.group=this,h._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(h){h.set("active",!0),h.group=this},removeWithUpdate:function(h){return this._moveFlippedObject(h),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(h),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(h){h.group=this,h._set("canvas",this.canvas)},_onObjectRemoved:function(h){delete h.group,h.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(j,k){if(j in this.delegatedProperties||"canvas"===j)for(var h=this._objects.length;h--;)this._objects[h].set(j,k);this.callSuper("_set",j,k)},toObject:function(h){return g(this.callSuper("toObject",h),{objects:b(this._objects,"toObject",h)})},render:function(j){if(this.visible){j.save(),this.transformMatrix&&j.transform.apply(j,this.transformMatrix),this.transform(j),this.clipTo&&e.util.clipContext(this,j);for(var k=0,h=this._objects.length;h>k;k++)this._renderObject(this._objects[k],j);this.clipTo&&j.restore(),j.restore()}},_renderControls:function(j,l){this.callSuper("_renderControls",j,l);for(var k=0,h=this._objects.length;h>k;k++)this._objects[k]._renderControls(j)},_renderObject:function(j,i){if(j.visible){var h=j.hasRotatingPoint;j.hasRotatingPoint=!1,j.render(i),j.hasRotatingPoint=h}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(h){return this._moveFlippedObject(h),this._setObjectPosition(h),h},_moveFlippedObject:function(l){var j=l.get("originX"),i=l.get("originY"),h=l.getCenterPoint();l.set({originX:"center",originY:"center",left:h.x,top:h.y}),this._toggleFlipping(l);var k=l.getPointByOrigin(j,i);return l.set({originX:j,originY:i,left:k.x,top:k.y}),this},_toggleFlipping:function(h){this.flipX&&(h.toggle("flipX"),h.set("left",-h.get("left")),h.setAngle(-h.getAngle())),this.flipY&&(h.toggle("flipY"),h.set("top",-h.get("top")),h.setAngle(-h.getAngle()))},_restoreObjectState:function(h){return this._setObjectPosition(h),h.setCoords(),h.hasControls=h.__origHasControls,delete h.__origHasControls,h.set("active",!1),h.setCoords(),delete h.group,this},_setObjectPosition:function(j){var h=this.getCenterPoint(),i=this._getRotatedLeftTop(j);j.set({angle:j.getAngle()+this.getAngle(),left:h.x+i.left,top:h.y+i.top,scaleX:j.get("scaleX")*this.get("scaleX"),scaleY:j.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(i){var h=this.getAngle()*(Math.PI/180);return{left:-Math.sin(h)*i.getTop()*this.get("scaleY")+Math.cos(h)*i.getLeft()*this.get("scaleX"),top:Math.cos(h)*i.getTop()*this.get("scaleY")+Math.sin(h)*i.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(h){h.setCoords()}),this},_calcBounds:function(l){for(var k,h,p=[],n=[],s=["tr","br","bl","tl"],q=0,r=this._objects.length;r>q;++q){k=this._objects[q],k.setCoords();for(var m=0;m<s.length;m++)h=s[m],p.push(k.oCoords[h].x),n.push(k.oCoords[h].y)}this.set(this._getBounds(p,n,l))},_getBounds:function(j,i,n){var l=e.util.invertTransform(this.getViewportTransform()),k=e.util.transformPoint(new e.Point(c(j),c(i)),l),h=e.util.transformPoint(new e.Point(a(j),a(i)),l),m={width:h.x-k.x||0,height:h.y-k.y||0};return n||(m.left=k.x||0,m.top=k.y||0,"center"===this.originX&&(m.left+=m.width/2),"right"===this.originX&&(m.left+=m.width),"center"===this.originY&&(m.top+=m.height/2),"bottom"===this.originY&&(m.top+=m.height)),m},toSVG:function(j){for(var k=["<g ",'transform="',this.getSvgTransform(),'">\n'],l=0,h=this._objects.length;h>l;l++)k.push(this._objects[l].toSVG(j));return k.push("</g>\n"),j?j(k.join("")):k.join("")},get:function(k){if(k in f){if(this[k])return this[k];for(var j=0,h=this._objects.length;h>j;j++)if(this._objects[j][k])return!0;return!1}return k in this.delegatedProperties?this._objects[0]&&this._objects[0].get(k):this[k]}}),e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects,i&&i(new e.Group(j,h))})},e.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(a){var b=fabric.util.object.extend;return a.fabric||(a.fabric={}),a.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(d,c){c||(c={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",c),this._initElement(d,c)},getElement:function(){return this._element},setElement:function(d,e,c){return this._element=d,this._originalElement=d,this._initConfig(c),0!==this.filters.length?this.applyFilters(e):e&&e(),this},setCrossOrigin:function(c){return this.crossOrigin=c,this._element.crossOrigin=c,this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},_stroke:function(c){c.save(),this._setStrokeStyles(c),c.beginPath(),c.strokeRect(-this.width/2,-this.height/2,this.width,this.height),c.closePath(),c.restore()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save(),this._setStrokeStyles(e),e.beginPath(),fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray),fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray),fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray),fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(d){var c=b(this.callSuper("toObject",d),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(e){return e&&e.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});return this.resizeFilters.length>0&&(c.resizeFilters=this.resizeFilters.map(function(e){return e&&e.toObject()})),c},toSVG:function(d){var e=[],c=-this.width/2,h=-this.height/2,g="none";if(this.group&&"path-group"===this.group.type&&(c=this.left,h=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(g="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',h,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',g,'"',"></image>\n"),this.stroke||this.strokeDashArray){var f=this.fill;this.fill=null,e.push("<rect ",'x="',c,'" y="',h,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f}return e.push("</g>\n"),d?d(e.join("")):e.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(d,e,c){fabric.util.loadImage(d,function(f){return this.setElement(f,e,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(j,f,g,c){if(f=f||this.filters,g=g||this._originalElement){var h=g,d=fabric.util.createCanvasElement(),e=fabric.util.createImage(),i=this;return d.width=h.width,d.height=h.height,d.getContext("2d").drawImage(h,0,0,h.width,h.height),0===f.length?(this._element=g,j&&j(),d):(f.forEach(function(k){k&&k.applyTo(d,k.scaleX||i.scaleX,k.scaleY||i.scaleY),!c&&k&&"Resize"===k.type&&(i.width*=k.scaleX,i.height*=k.scaleY)}),e.width=d.width,e.height=d.height,fabric.isLikelyNode?(e.src=d.toBuffer(void 0,fabric.Image.pngCompression),i._element=e,!c&&(i._filteredEl=e),j&&j()):(e.onload=function(){i._element=e,!c&&(i._filteredEl=e),j&&j(),e.onload=d=h=null},e.src=d.toDataURL("image/png")),d)}},_render:function(e,g){var c,h,f,d=this._findMargins();c=g?this.left:-this.width/2,h=g?this.top:-this.height/2,"slice"===this.meetOrSlice&&(e.beginPath(),e.rect(c,h,this.width,this.height),e.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):f=this._element,f&&e.drawImage(f,c+d.marginX,h+d.marginY,d.width,d.height),this._renderStroke(e)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var h,g,f=this.width,c=this.height,e=0,d=0;return"none"===this.alignX&&"none"===this.alignY||(h=[this.width/this._element.width,this.height/this._element.height],g="meet"===this.meetOrSlice?Math.min.apply(null,h):Math.max.apply(null,h),f=this._element.width*g,c=this._element.height*g,"Mid"===this.alignX&&(e=(this.width-f)/2),"Max"===this.alignX&&(e=this.width-f),"Mid"===this.alignY&&(d=(this.height-c)/2),"Max"===this.alignY&&(d=this.height-c)),{width:f,height:c,marginX:e,marginY:d}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width),this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={}),this.setOptions(c),this._setWidthHeight(c),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(c,d){c&&c.length?fabric.util.enlivenObjects(c,function(e){d&&d(e)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(c){this.width="width"in c?c.width:this.getElement()?this.getElement().width||0:0,this.height="height"in c?c.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(c,d){fabric.util.loadImage(c.src,function(e){
fabric.Image.prototype._initFilters.call(c,c.filters,function(f){c.filters=f||[],fabric.Image.prototype._initFilters.call(c,c.resizeFilters,function(h){c.resizeFilters=h||[];var g=new fabric.Image(e,c);d&&d(g)})})},null,c.crossOrigin)},fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e&&e(new fabric.Image(f,d))},null,d&&d.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(f,i,k){var e,d,j,h=fabric.parseAttributes(f,fabric.Image.ATTRIBUTE_NAMES),g="xMidYMid",c="meet";h.preserveAspectRatio&&(j=h.preserveAspectRatio.split(" ")),j&&j.length&&(c=j.pop(),"meet"!==c&&"slice"!==c?(g=c,c="meet"):j.length&&(g=j.pop())),e="none"!==g?g.slice(1,4):"none",d="none"!==g?g.slice(5,8):"none",h.alignX=e,h.alignY=d,h.meetOrSlice=c,fabric.Image.fromURL(h["xlink:href"],i,b(k?fabric.util.object.clone(k):{},h))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.setAngle(f),a()},onComplete:function(){e.setCoords(),d()},onStart:function(){e.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(d){d=d||{},this.brightness=d.brightness||0},applyTo:function(g){for(var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),h=k.data,j=this.brightness,e=0,d=h.length;d>e;e+=4)h[e]+=j,h[e+1]+=j,h[e+2]+=j;f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),b.Image.filters.Brightness.fromObject=function(d){return new b.Image.filters.Brightness(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(d){d=d||{},this.opaque=d.opaque,this.matrix=d.matrix||[0,0,0,0,1,0,0,0,0];var e=b.util.createCanvasElement();this.tmpCtx=e.getContext("2d")},_createImageData:function(d,e){return this.tmpCtx.createImageData(d,e)},applyTo:function(l){for(var H=this.matrix,i=l.getContext("2d"),A=i.getImageData(0,0,l.width,l.height),e=Math.round(Math.sqrt(H.length)),k=Math.floor(e/2),m=A.data,B=A.width,K=A.height,s=B,F=K,n=this._createImageData(s,F),L=n.data,t=this.opaque?1:0,o=0;F>o;o++)for(var p=0;s>p;p++){for(var v=o,z=p,C=4*(o*s+p),u=0,G=0,I=0,J=0,f=0;e>f;f++)for(var j=0;e>j;j++){var D=v+f-k,E=z+j-k;if(!(0>D||D>K||0>E||E>B)){var q=4*(D*B+E),d=H[f*e+j];u+=m[q]*d,G+=m[q+1]*d,I+=m[q+2]*d,J+=m[q+3]*d}}L[C]=u,L[C+1]=G,L[C+2]=I,L[C+3]=J+t*(255-J)}i.putImageData(n,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=function(d){return new b.Image.filters.Convolute(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(d){d=d||{},this.threshold=d.threshold||100},applyTo:function(h){for(var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.threshold,j=k.length,f=0,d=k.length;d>f;f+=4)k[f+3]=e+255*(j-f)/j;g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),b.Image.filters.GradientTransparency.fromObject=function(d){return new b.Image.filters.GradientTransparency(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(f){for(var g,e=f.getContext("2d"),i=e.getImageData(0,0,f.width,f.height),h=i.data,c=i.width*i.height*4,d=0;c>d;)g=(h[d]+h[d+1]+h[d+2])/3,h[d]=g,h[d+1]=g,h[d+2]=g,d+=4;e.putImageData(i,0,0)}}),b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(f){var d,e=f.getContext("2d"),h=e.getImageData(0,0,f.width,f.height),g=h.data,c=g.length;for(d=0;c>d;d+=4)g[d]=255-g[d],g[d+1]=255-g[d+1],g[d+2]=255-g[d+2];e.putImageData(h,0,0)}}),b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(d){d=d||{},this.mask=d.mask,this.channel=[0,1,2,3].indexOf(d.channel)>-1?d.channel:0},applyTo:function(h){if(this.mask){var k,e=h.getContext("2d"),d=e.getImageData(0,0,h.width,h.height),j=d.data,l=this.mask.getElement(),n=b.util.createCanvasElement(),m=this.channel,g=d.width*d.height*4;n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0,l.width,l.height);var f=n.getContext("2d").getImageData(0,0,l.width,l.height),o=f.data;for(k=0;g>k;k+=4)j[k+3]=o[k+m];e.putImageData(d,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),b.Image.filters.Mask.fromObject=function(d,e){b.util.loadImage(d.mask.src,function(f){d.mask=new b.Image(f,d.mask),e&&e(new b.Image.filters.Mask(d))})},b.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(d){d=d||{},this.noise=d.noise||0},applyTo:function(h){for(var j,g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.noise,f=0,d=k.length;d>f;f+=4)j=(.5-Math.random())*e,k[f]+=j,k[f+1]+=j,k[f+2]+=j;g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=function(d){return new b.Image.filters.Noise(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(d){d=d||{},this.blocksize=d.blocksize||4},applyTo:function(h){var s,p,n,d,q,u,v,f=h.getContext("2d"),e=f.getImageData(0,0,h.width,h.height),o=e.data,k=e.height,x=e.width;for(p=0;k>p;p+=this.blocksize)for(n=0;x>n;n+=this.blocksize){s=4*p*x+4*n,d=o[s],q=o[s+1],u=o[s+2],v=o[s+3];for(var m=p,w=p+this.blocksize;w>m;m++)for(var l=n,t=n+this.blocksize;t>l;l++)s=4*m*x+4*l,o[s]=d,o[s+1]=q,o[s+2]=u,o[s+3]=v}f.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),b.Image.filters.Pixelate.fromObject=function(d){return new b.Image.filters.Pixelate(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(d){d=d||{},this.threshold=d.threshold||30,this.distance=d.distance||20},applyTo:function(j){for(var d,o,q,h=j.getContext("2d"),e=h.getImageData(0,0,j.width,j.height),m=e.data,n=this.threshold,f=this.distance,k=255-n,s=Math.abs,l=0,p=m.length;p>l;l+=4)d=m[l],o=m[l+1],q=m[l+2],d>k&&o>k&&q>k&&s(d-o)<f&&s(d-q)<f&&s(o-q)<f&&(m[l+3]=1);h.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),b.Image.filters.RemoveWhite.fromObject=function(d){return new b.Image.filters.RemoveWhite(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(f){var d,h,e=f.getContext("2d"),j=e.getImageData(0,0,f.width,f.height),g=j.data,c=g.length;for(d=0;c>d;d+=4)h=.3*g[d]+.59*g[d+1]+.11*g[d+2],g[d]=h+100,g[d+1]=h+50,g[d+2]=h+255;e.putImageData(j,0,0)}}),b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(f){var k,d,l,m,e=f.getContext("2d"),c=e.getImageData(0,0,f.width,f.height),j=c.data,h=j.length;for(k=0;h>k;k+=4)d=j[k],l=j[k+1],m=j[k+2],j[k]=(.393*d+.769*l+.189*m)/1.351,j[k+1]=(.349*d+.686*l+.168*m)/1.203,j[k+2]=(.272*d+.534*l+.131*m)/2.14;e.putImageData(c,0,0)}}),b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(d){d=d||{},this.color=d.color||"#000000",this.opacity="undefined"!=typeof d.opacity?d.opacity:new b.Color(this.color).getAlpha()},applyTo:function(k){var n,p,t,j,e,o,q,s,d,h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),m=f.data,l=m.length;for(d=new b.Color(this.color).getSource(),p=d[0]*this.opacity,t=d[1]*this.opacity,j=d[2]*this.opacity,s=1-this.opacity,n=0;l>n;n+=4)e=m[n],o=m[n+1],q=m[n+2],m[n]=p+e*s,m[n+1]=t+o*s,m[n+2]=j+q*s;h.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),b.Image.filters.Tint.fromObject=function(d){return new b.Image.filters.Tint(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(d){d=d||{},this.color=d.color||"#000000"},applyTo:function(g){var e,h,f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),j=k.data,d=j.length;for(h=new b.Color(this.color).getSource(),e=0;d>e;e+=4)j[e]*=h[0]/255,j[e+1]*=h[1]/255,j[e+2]*=h[2]/255;f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),b.Image.filters.Multiply.fromObject=function(d){return new b.Image.filters.Multiply(d)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric;b.Image.filters.Blend=b.util.createClass({type:"Blend",initialize:function(c){c=c||{},this.color=c.color||"#000",this.image=c.image||!1,this.mode=c.mode||"multiply",this.alpha=c.alpha||1},applyTo:function(j){var c,k,l,m,u,x,w,f,h,o,e=j.getContext("2d"),v=e.getImageData(0,0,j.width,j.height),y=v.data,q=!1;if(this.image){q=!0;var n=b.util.createCanvasElement();n.width=this.image.width,n.height=this.image.height;var d=new b.StaticCanvas(n);d.add(this.image);var p=d.getContext("2d");o=p.getImageData(0,0,d.width,d.height).data}else o=new b.Color(this.color).getSource(),c=o[0]*this.alpha,k=o[1]*this.alpha,l=o[2]*this.alpha;for(var s=0,t=y.length;t>s;s+=4)switch(m=y[s],u=y[s+1],x=y[s+2],q&&(c=o[s]*this.alpha,k=o[s+1]*this.alpha,l=o[s+2]*this.alpha),this.mode){case"multiply":y[s]=m*c/255,y[s+1]=u*k/255,y[s+2]=x*l/255;break;case"screen":y[s]=1-(1-m)*(1-c),y[s+1]=1-(1-u)*(1-k),y[s+2]=1-(1-x)*(1-l);break;case"add":y[s]=Math.min(255,m+c),y[s+1]=Math.min(255,u+k),y[s+2]=Math.min(255,x+l);break;case"diff":case"difference":y[s]=Math.abs(m-c),y[s+1]=Math.abs(u-k),y[s+2]=Math.abs(x-l);break;case"subtract":w=m-c,f=u-k,h=x-l,y[s]=0>w?0:w,y[s+1]=0>f?0:f,y[s+2]=0>h?0:h;break;case"darken":y[s]=Math.min(m,c),y[s+1]=Math.min(u,k),y[s+2]=Math.min(x,l);break;case"lighten":y[s]=Math.max(m,c),y[s+1]=Math.max(u,k),y[s+2]=Math.max(x,l)}e.putImageData(v,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.Blend.fromObject=function(c){return new b.Image.filters.Blend(c)}}("undefined"!=typeof exports?exports:this),function(a){var b=a.fabric||(a.fabric={}),d=Math.pow,c=Math.floor,g=Math.sqrt,j=Math.abs,f=Math.max,i=Math.round,e=Math.sin,h=Math.ceil;b.Image.filters.Resize=b.util.createClass(b.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(o,n,m){this.rcpScaleX=1/n,this.rcpScaleY=1/m;var r,l=o.width,q=o.height,k=i(l*n),p=i(q*m);"sliceHack"===this.resizeType&&(r=this.sliceByTwo(o,l,q,k,p)),"hermite"===this.resizeType&&(r=this.hermiteFastResize(o,l,q,k,p)),"bilinear"===this.resizeType&&(r=this.bilinearFiltering(o,l,q,k,p)),"lanczos"===this.resizeType&&(r=this.lanczosResize(o,l,q,k,p)),o.width=k,o.height=p,o.getContext("2d").putImageData(r,0,0)},sliceByTwo:function(o,m,w,r,l){var k,n=o.getContext("2d"),q=.5,A=.5,y=1,t=1,p=!1,z=!1,x=m,s=w,u=b.util.createCanvasElement(),v=u.getContext("2d");for(r=c(r),l=c(l),u.width=f(r,m),u.height=f(l,w),r>m&&(q=2,y=-1),l>w&&(A=2,t=-1),k=n.getImageData(0,0,m,w),o.width=f(r,m),o.height=f(l,w),n.putImageData(k,0,0);!p||!z;)m=x,w=s,r*y<c(x*q*y)?x=c(x*q):(x=r,p=!0),l*t<c(s*A*t)?s=c(s*A):(s=l,z=!0),k=n.getImageData(0,0,m,w),v.putImageData(k,0,0),n.clearRect(0,0,x,s),n.drawImage(u,0,0,m,w,0,0,x,s);return n.getImageData(0,0,r,l)},lanczosResize:function(s,E,r,p,v){function x(G){return function(H){if(H>G)return 0;if(H*=Math.PI,j(H)<1e-16)return 1;var I=H/G;return e(H)*e(I)/H/I}}function y(S){var R,K,L,Q,O,G,I,P,H,N,M;for(D.x=(S+.5)*m,A.x=c(D.x),R=0;v>R;R++){for(D.y=(R+.5)*l,A.y=c(D.y),O=0,G=0,I=0,P=0,H=0,K=A.x-q;K<=A.x+q;K++)if(!(0>K||K>=E)){N=c(1e3*j(K-D.x)),k[N]||(k[N]={});for(var J=A.y-o;J<=A.y+o;J++)0>J||J>=r||(M=c(1e3*j(J-D.y)),k[N][M]||(k[N][M]=t(g(d(N*z,2)+d(M*w,2))/1e3)),L=k[N][M],L>0&&(Q=4*(J*E+K),O+=L,G+=L*C[Q],I+=L*C[Q+1],P+=L*C[Q+2],H+=L*C[Q+3]))}Q=4*(R*p+S),B[Q]=G/O,B[Q+1]=I/O,B[Q+2]=P/O,B[Q+3]=H/O}return++S<p?y(S):F}var n=s.getContext("2d"),u=n.getImageData(0,0,E,r),F=n.getImageData(0,0,p,v),C=u.data,B=F.data,t=x(this.lanczosLobes),m=this.rcpScaleX,l=this.rcpScaleY,z=2/this.rcpScaleX,w=2/this.rcpScaleY,q=h(m*this.lanczosLobes/2),o=h(l*this.lanczosLobes/2),k={},D={},A={};return y(0)},bilinearFiltering:function(o,C,H,B,q){var M,L,K,J,A,u,G,F,I,v,t,E,s,p=0,m=this.rcpScaleX,k=this.rcpScaleY,l=o.getContext("2d"),r=4*(C-1),N=l.getImageData(0,0,C,H),D=N.data,n=l.getImageData(0,0,B,q),z=n.data;for(G=0;q>G;G++)for(F=0;B>F;F++)for(A=c(m*F),u=c(k*G),I=m*F-A,v=k*G-u,s=4*(u*C+A),t=0;4>t;t++)M=D[s+t],L=D[s+4+t],K=D[s+r+t],J=D[s+r+4+t],E=M*(1-I)*(1-v)+L*I*(1-v)+K*v*(1-I)+J*I*v,z[p++]=E;return n},hermiteFastResize:function(p,N,o,n,G){for(var m=this.rcpScaleX,B=this.rcpScaleY,I=h(m/2),E=h(B/2),l=p.getContext("2d"),Q=l.getImageData(0,0,N,o),P=Q.data,O=l.getImageData(0,0,n,G),q=O.data,J=0;G>J;J++)for(var K=0;n>K;K++){for(var L=4*(K+J*n),F=0,M=0,u=0,k=0,s=0,x=0,y=0,t=(J+.5)*B,H=c(J*B);(J+1)*B>H;H++)for(var A=j(t-(H+.5))/E,v=(K+.5)*m,D=A*A,r=c(K*m);(K+1)*m>r;r++){var C=j(v-(r+.5))/I,z=g(D+C*C);z>1&&-1>z||(F=2*z*z*z-3*z*z+1,F>0&&(C=4*(r+H*N),y+=F*P[C+3],u+=F,P[C+3]<255&&(F=F*P[C+3]/250),k+=F*P[C],s+=F*P[C+1],x+=F*P[C+2],M+=F))}q[L]=k/M,q[L+1]=s/M,q[L+2]=x/M,q[L+3]=y/u}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=function(k){return new b.Image.filters.Resize(k)}}("undefined"!=typeof exports?exports:this),function(c){var d=c.fabric||(c.fabric={}),h=d.util.object.extend,g=d.util.object.clone,a=d.util.toFixed,e=d.StaticCanvas.supports("setLineDash"),b=d.Object.NUM_FRACTION_DIGITS;if(d.Text)return void d.warn("fabric.Text is already defined");var f=d.Object.prototype.stateProperties.concat();f.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),d.Text=d.util.createClass(d.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:f,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(j,i){i=i||{},this.text=j,this.__skipDimension=!0,this.setOptions(i),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(i){if(!this.__skipDimension){i||(i=d.util.createCanvasElement().getContext("2d"),this._setTextStyles(i)),this._textLines=this.text.split(this._reNewline),this._clearCache();var j=this.textAlign;this.textAlign="left",this.width=this._getTextWidth(i),this.textAlign=j,this.height=this._getTextHeight(i)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(i){this.clipTo&&d.util.clipContext(this,i),this._renderTextBackground(i),this._renderText(i),this._renderTextDecoration(i),this.clipTo&&i.restore()},_renderText:function(i){i.save(),this._translateForTextAlign(i),this._setOpacity(i),this._setShadow(i),this._setupCompositeOperation(i),this._renderTextFill(i),this._renderTextStroke(i),i.restore()},_translateForTextAlign:function(i){"left"!==this.textAlign&&"justify"!==this.textAlign&&i.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(i){i.textBaseline="alphabetic",this.skipTextAlign||(i.textAlign=this.textAlign),i.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(k){for(var m=this._getLineWidth(k,0),l=1,j=this._textLines.length;j>l;l++){var n=this._getLineWidth(k,l);n>m&&(m=n)}return m},_renderChars:function(p,j,k,n,m){var l=p.slice(0,-4);if(this[l].toLive){var i=-this.width/2+this[l].offsetX||0,o=-this.height/2+this[l].offsetY||0;j.save(),j.translate(i,o),n-=i,m-=o}console.log(j.strokeStyle),j[p](k,n,m),this[l].toLive&&j.restore()},_renderTextLine:function(j,w,y,l,t,v){if(t-=this.fontSize*this._fontSizeFraction,"justify"!==this.textAlign)return void this._renderChars(j,w,y,l,t,v);var q=this._getLineWidth(w,v),p=this.width;if(p>=q)for(var s=y.split(/\s+/),x=this._getWidthOfWords(w,y,v),o=p-x,n=s.length-1,u=o/n,k=0,m=0,r=s.length;r>m;m++)this._renderChars(j,w,s[m],l+k,t,v),k+=w.measureText(s[m]).width+u;else this._renderChars(j,w,y,l,t,v)},_getWidthOfWords:function(j,i){return j.measureText(i.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(k){if(this.fill||this._skipFillStrokeCheck)for(var o=0,l=0,j=this._textLines.length;j>l;l++){var m=this._getHeightOfLine(k,l),n=m/this.lineHeight;this._renderTextLine("fillText",k,this._textLines[l],this._getLeftOffset(),this._getTopOffset()+o+n,l),o+=m}},_renderTextStroke:function(k){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var o=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(k),k.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&k.setLineDash(this.strokeDashArray)),k.beginPath();for(var l=0,j=this._textLines.length;j>l;l++){var m=this._getHeightOfLine(k,l),n=m/this.lineHeight;this._renderTextLine("strokeText",k,this._textLines[l],this._getLeftOffset(),this._getTopOffset()+o+n,l),o+=m}k.closePath(),k.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(i){this._renderTextBoxBackground(i),this._renderTextLinesBackground(i)},_renderTextBoxBackground:function(i){this.backgroundColor&&(i.save(),i.fillStyle=this.backgroundColor,i.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),i.restore())},_renderTextLinesBackground:function(l){var o=0,n=this._getHeightOfLine();if(this.textBackgroundColor){l.save(),l.fillStyle=this.textBackgroundColor;for(var m=0,k=this._textLines.length;k>m;m++){if(""!==this._textLines[m]){var j=this._getLineWidth(l,m),p=this._getLineLeftOffset(j);l.fillRect(this._getLeftOffset()+p,this._getTopOffset()+o,j,this.fontSize*this._fontSizeMult)}o+=n}l.restore()}},_getLineLeftOffset:function(i){return"center"===this.textAlign?(this.width-i)/2:"right"===this.textAlign?this.width-i:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__lineOffsets=[]},_shouldClearCache:function(){var j=!1;for(var i in this._dimensionAffectingProps)this["__"+i]!==this[i]&&(this["__"+i]=this[i],j=!0);return j},_getLineWidth:function(i,j){return this.__lineWidths[j]?this.__lineWidths[j]:(this.__lineWidths[j]=i.measureText(this._textLines[j]).width,this.__lineWidths[j])},_renderTextDecoration:function(j){function i(o){var q,t,p,u,v=0;for(q=0,t=m._textLines.length;t>q;q++){var s=m._getLineWidth(j,q),r=m._getLineLeftOffset(s),n=m._getHeightOfLine(j,q);for(p=0,u=o.length;u>p;p++)j.fillRect(m._getLeftOffset()+r,v+(m._fontSizeMult-1+o[p])*m.fontSize-l,s,m.fontSize/15);v+=n}}if(this.textDecoration){var l=this.height/2,m=this,k=[];this.textDecoration.indexOf("underline")>-1&&k.push(.85),this.textDecoration.indexOf("line-through")>-1&&k.push(.43),this.textDecoration.indexOf("overline")>-1&&k.push(-.12),k.length>0&&i(k)}},_getFontDeclaration:function(){return[d.isLikelyNode?this.fontWeight:this.fontStyle,d.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",d.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(i,j){this.visible&&(i.save(),this._setTextStyles(i),this._shouldClearCache()&&this._initDimensions(i),j||this.transform(i),this._setStrokeStyles(i),this._setFillStyles(i),this.transformMatrix&&i.transform.apply(i,this.transformMatrix),this.group&&"path-group"===this.group.type&&i.translate(this.left,this.top),this._render(i),i.restore())},toObject:function(j){var i=h(this.callSuper("toObject",j),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(i),i},toSVG:function(i){var j=this._createBaseSVGMarkup(),l=this._getSVGLeftTopOffsets(this.ctx),k=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(j,k),i?i(j.join("")):j.join("")},_getSVGLeftTopOffsets:function(k){var l=this._getHeightOfLine(k,0),j=-this.width/2,i=0;return{textLeft:j+(this.group&&"path-group"===this.group.type?this.left:0),textTop:i+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:l}},_wrapSVGTextAndBg:function(i,j){i.push('	<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',j.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',j.textSpans.join(""),"</text>\n","	</g>\n")},_getSVGTextAndBg:function(l,m){var p=[],o=[],k=0;this._setSVGBg(o);for(var n=0,j=this._textLines.length;j>n;n++)this.textBackgroundColor&&this._setSVGTextLineBg(o,n,m,l,k),this._setSVGTextLineText(n,p,k,m,l,o),k+=this._getHeightOfLine(this.ctx,n);return{textSpans:p,textBgRects:o}},_setSVGTextLineText:function(m,o,k,l,j){var n=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-j+k-this.height/2;o.push('<tspan x="',a(l+this._getLineLeftOffset(this.__lineWidths[m]),b),'" ','y="',a(n,b),'" ',this._getFillAttributes(this.fill),">",d.util.string.escapeXml(this._textLines[m]),"</tspan>")},_setSVGTextLineBg:function(n,m,l,k,j){n.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(l+this._getLineLeftOffset(this.__lineWidths[m]),b),'" y="',a(j-this.height/2,b),'" width="',a(this.__lineWidths[m],b),'" height="',a(this._getHeightOfLine(this.ctx,m)/this.lineHeight,b),'"></rect>\n')},_setSVGBg:function(i){this.backgroundColor&&i.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,b),'" y="',a(-this.height/2,b),'" width="',a(this.width,b),'" height="',a(this.height,b),'"></rect>\n')},_getFillAttributes:function(i){var j=i&&"string"==typeof i?new d.Color(i):"";return j&&j.getSource()&&1!==j.getAlpha()?'opacity="'+j.getAlpha()+'" fill="'+j.setAlpha(1).toRgb()+'"':'fill="'+i+'"'},_set:function(i,j){this.callSuper("_set",i,j),i in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),d.Text.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),d.Text.DEFAULT_SVG_FONT_SIZE=16,d.Text.fromElement=function(k,j){if(!k)return null;var m=d.parseAttributes(k,d.Text.ATTRIBUTE_NAMES);j=d.util.object.extend(j?d.util.object.clone(j):{},m),j.top=j.top||0,j.left=j.left||0,"dx"in m&&(j.left+=m.dx),"dy"in m&&(j.top+=m.dy),"fontSize"in j||(j.fontSize=d.Text.DEFAULT_SVG_FONT_SIZE),j.originX||(j.originX="left");var l=k.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),n=new d.Text(l,j),i=0;return"left"===n.originX&&(i=n.getWidth()/2),"right"===n.originX&&(i=-n.getWidth()/2),n.set({left:n.getLeft()+i,top:n.getTop()-n.getHeight()/2+n.fontSize*(.18+n._fontSizeFraction)}),n},d.Text.fromObject=function(i){return new d.Text(i.text,g(i))},d.util.createAccessors(d.Text)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(c,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",c,b),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__maxFontHeights=[],this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var d=this.styles;for(var e in d)for(var c in d[e])for(var b in d[e][c])return!1;return!0},setSelectionStart:function(b){b=Math.max(b,0),this.selectionStart!==b&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=b),this._updateTextarea()},setSelectionEnd:function(b){b=Math.min(b,this.text.length),this.selectionEnd!==b&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=b),this._updateTextarea()},getSelectionStyles:function(f,d){if(2===arguments.length){for(var c=[],b=f;d>b;b++)c.push(this.getSelectionStyles(b));return c}var e=this.get2DCursorLocation(f);return this.styles[e.lineIndex]?this.styles[e.lineIndex][e.charIndex]||{}:{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,c);return this._clearCache(),this},_extendStyles:function(b,c){var d=this.get2DCursorLocation(b);this.styles[d.lineIndex]||(this.styles[d.lineIndex]={}),this.styles[d.lineIndex][d.charIndex]||(this.styles[d.lineIndex][d.charIndex]={}),fabric.util.object.extend(this.styles[d.lineIndex][d.charIndex],c)},_render:function(b){this.callSuper("_render",b),this.ctx=b,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var c,b,d=this.text.split("");this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix)):(b=this.ctx,b.save()),this.selectionStart===this.selectionEnd?(c=this._getCursorBoundaries(d,"cursor"),this.renderCursor(c,b)):(c=this._getCursorBoundaries(d,"selection"),this.renderSelection(d,c,b)),b.restore()}},get2DCursorLocation:function(d){"undefined"==typeof d&&(d=this.selectionStart);for(var b=this._textLines.length,c=0;b>c;c++){if(d<=this._textLines[c].length)return{lineIndex:c,charIndex:d};d-=this._textLines[c].length+1}return{lineIndex:c-1,charIndex:this._textLines[c-1].length<d?this._textLines[c-1].length:d}},getCurrentCharStyle:function(d,c){var b=this.styles[d]&&this.styles[d][0===c?0:c-1];return{fontSize:b&&b.fontSize||this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,b){return this.styles[c]&&this.styles[c][0===b?0:b-1]&&this.styles[c][0===b?0:b-1].fontSize||this.fontSize},getCurrentCharColor:function(c,b){return this.styles[c]&&this.styles[c][0===b?0:b-1]&&this.styles[c][0===b?0:b-1].fill||this.cursorColor},_getCursorBoundaries:function(d,b){var f=Math.round(this._getLeftOffset()),e=this._getTopOffset(),c=this._getCursorBoundariesOffsets(d,b);return{left:f,top:e,leftOffset:c.left+c.lineLeft,topOffset:c.top}},_getCursorBoundariesOffsets:function(e,b){for(var g=0,j=0,h=0,d=0,f=0,c=0;c<this.selectionStart;c++)"\n"===e[c]?(f=0,d+=this._getHeightOfLine(this.ctx,j),j++,h=0):(f+=this._getWidthOfChar(this.ctx,e[c],j,h),h++),g=this._getCachedLineOffset(j);return"cursor"===b&&(d+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,j)/this.lineHeight-this.getCurrentCharFontSize(j,h)*(1-this._fontSizeFraction)),{top:d,left:f,lineLeft:g}},_getCachedLineOffset:function(c){var b=this._getLineWidth(this.ctx,c);return this.__lineOffsets[c]||(this.__lineOffsets[c]=this._getLineLeftOffset(b))},renderCursor:function(c,b){var d=this.get2DCursorLocation(),h=d.lineIndex,g=d.charIndex,f=this.getCurrentCharFontSize(h,g),e=0===h&&0===g?this._getCachedLineOffset(h):c.leftOffset;b.fillStyle=this.getCurrentCharColor(h,g),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(c.left+e,c.top+c.topOffset,this.cursorWidth/this.scaleX,f)},renderSelection:function(n,c,r){r.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),g=this.get2DCursorLocation(this.selectionEnd),p=b.lineIndex,d=g.lineIndex,k=p;d>=k;k++){var f=this._getCachedLineOffset(k)||0,o=this._getHeightOfLine(this.ctx,k),l=0,s=this._textLines[k];if(k===p)for(var h=0,m=s.length;m>h;h++)h>=b.charIndex&&(k!==d||h<g.charIndex)&&(l+=this._getWidthOfChar(r,s[h],k,h)),h<b.charIndex&&(f+=this._getWidthOfChar(r,s[h],k,h));else if(k>p&&d>k)l+=this._getLineWidth(r,k)||5;else if(k===d)for(var q=0,e=g.charIndex;e>q;q++)l+=this._getWidthOfChar(r,s[q],k,q);r.fillRect(c.left+f,c.top+c.topOffset,l,o),
c.topOffset+=o}},_renderChars:function(b,n,o,c,j,m){if(this.isEmptyStyles())return this._renderCharsFast(b,n,o,c,j);this.skipTextAlign=!0,c-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var k,l=this._getHeightOfLine(n,m),e=this._getCachedLineOffset(m),f="";c+=e||0,n.save(),j-=l/this.lineHeight*this._fontSizeFraction;for(var d=0,h=o.length;h>=d;d++){k=k||this.getCurrentCharStyle(m,d);var g=this.getCurrentCharStyle(m,d+1);(this._hasStyleChanged(k,g)||d===h)&&(this._renderChar(b,n,m,d-1,f,c,j,l),f="",k=g),f+=o[d]}n.restore()},_renderCharsFast:function(f,c,b,e,d){this.skipTextAlign=!1,"fillText"===f&&this.fill&&this.callSuper("_renderChars",f,c,b,e,d),"strokeText"===f&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",f,c,b,e,d)},_renderChar:function(b,p,o,g,n,d,k,m){var j,h,c,e=this._fontSizeFraction*m/this.lineHeight;if(this.styles&&this.styles[o]&&(j=this.styles[o][g])){var l=j.stroke||this.stroke,f=j.fill||this.fill;p.save(),h=this._applyCharStylesGetWidth(p,n,o,g,j),c=this._getHeightOfChar(p,n,o,g),f&&p.fillText(n,d,k),l&&p.strokeText(n,d,k),this._renderCharDecoration(p,j,d,k,e,h,c),p.restore(),p.translate(h,0)}else"strokeText"===b&&this.stroke&&p[b](n,d,k),"fillText"===b&&this.fill&&p[b](n,d,k),h=this._applyCharStylesGetWidth(p,n,o,g),this._renderCharDecoration(p,null,d,k,e,h,this.fontSize),p.translate(p.measureText(n).width,0)},_hasStyleChanged:function(b,c){return b.fill!==c.fill||b.fontSize!==c.fontSize||b.textBackgroundColor!==c.textBackgroundColor||b.textDecoration!==c.textDecoration||b.fontFamily!==c.fontFamily||b.fontWeight!==c.fontWeight||b.fontStyle!==c.fontStyle||b.stroke!==c.stroke||b.strokeWidth!==c.strokeWidth},_renderCharDecoration:function(c,d,h,g,i,b,f){var e=d?d.textDecoration||this.textDecoration:this.textDecoration;e&&(e.indexOf("underline")>-1&&c.fillRect(h,g+f/10,b,f/15),e.indexOf("line-through")>-1&&c.fillRect(h,g-f*(this._fontSizeFraction+this._fontSizeMult-1)+f/15,b,f/15),e.indexOf("overline")>-1&&c.fillRect(h,g-(this._fontSizeMult-this._fontSizeFraction)*f,b,f/15))},_renderTextLine:function(g,c,b,e,d,f){this.isEmptyStyles()||(d+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",g,c,b,e,d,f)},_renderTextDecoration:function(b){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",b):void 0},_renderTextLinesBackground:function(m){if(this.textBackgroundColor||this.styles){m.save(),this.textBackgroundColor&&(m.fillStyle=this.textBackgroundColor);for(var h=0,d=0,g=this._textLines.length;g>d;d++){var b=this._getHeightOfLine(m,d);if(""!==this._textLines[d]){var f=this._getLineWidth(m,d),e=this._getCachedLineOffset(d);if(this.textBackgroundColor&&(m.fillStyle=this.textBackgroundColor,m.fillRect(this._getLeftOffset()+e,this._getTopOffset()+h,f,b/this.lineHeight)),this.styles[d])for(var c=0,l=this._textLines[d].length;l>c;c++)if(this.styles[d]&&this.styles[d][c]&&this.styles[d][c].textBackgroundColor){var k=this._textLines[d][c];m.fillStyle=this.styles[d][c].textBackgroundColor,m.fillRect(this._getLeftOffset()+e+this._getWidthOfCharsAt(m,d,c),this._getTopOffset()+h,this._getWidthOfChar(m,k,d,c)+1,b/this.lineHeight)}h+=b}else h+=b}m.restore()}},_getCacheProp:function(b,c){return b+c.fontFamily+c.fontSize+c.fontWeight+c.fontStyle+c.shadow},_applyCharStylesGetWidth:function(c,d,i,h,b){var f=b||this.styles[i]&&this.styles[i][h];f=f?a(f):{},this._applyFontStyles(f);var e=this._getCacheProp(d,f);if(this.isEmptyStyles()&&this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];"string"==typeof f.shadow&&(f.shadow=new fabric.Shadow(f.shadow));var g=f.fill||this.fill;return c.fillStyle=g.toLive?g.toLive(c,this):g,f.stroke&&(c.strokeStyle=f.stroke&&f.stroke.toLive?f.stroke.toLive(c,this):f.stroke),c.lineWidth=f.strokeWidth||this.strokeWidth,c.font=this._getFontDeclaration.call(f),this._setShadow.call(f,c),this.caching?(this._charWidthsCache[e]||(this._charWidthsCache[e]=c.measureText(d).width),this._charWidthsCache[e]):c.measureText(d).width},_applyFontStyles:function(b){b.fontFamily||(b.fontFamily=this.fontFamily),b.fontSize||(b.fontSize=this.fontSize),b.fontWeight||(b.fontWeight=this.fontWeight),b.fontStyle||(b.fontStyle=this.fontStyle)},_getStyleDeclaration:function(c,b){return this.styles[c]&&this.styles[c][b]?a(this.styles[c][b]):{}},_getWidthOfChar:function(b,c,h,g){if("justify"===this.textAlign&&/\s/.test(c))return this._getWidthOfSpace(b,h);var f=this._getStyleDeclaration(h,g);this._applyFontStyles(f);var d=this._getCacheProp(c,f);if(this._charWidthsCache[d]&&this.caching)return this._charWidthsCache[d];if(b){b.save();var e=this._applyCharStylesGetWidth(b,c,h,g);return b.restore(),e}},_getHeightOfChar:function(b,c,e,d){return this.styles[e]&&this.styles[e][d]?this.styles[e][d].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(b,e,d){var c=this._textLines[e][d];return this._getHeightOfChar(b,c,e,d)},_getWidthOfCharsAt:function(b,g,f){var d,c,e=0;for(d=0;f>d;d++)c=this._textLines[g][d],e+=this._getWidthOfChar(b,c,g,d);return e},_getLineWidth:function(b,c){return this.__lineWidths[c]?this.__lineWidths[c]:(this.__lineWidths[c]=this._getWidthOfCharsAt(b,c,this._textLines[c].length),this.__lineWidths[c])},_getWidthOfSpace:function(c,h){if(this.__widthOfSpace[h])return this.__widthOfSpace[h];var b=this._textLines[h],g=this._getWidthOfWords(c,b,h),f=this.width-g,d=b.length-b.replace(/\s+/g,"").length,e=f/d;return this.__widthOfSpace[h]=e,e},_getWidthOfWords:function(c,b,g){for(var e=0,f=0;f<b.length;f++){var d=b[f];d.match(/\s/)||(e+=this._getWidthOfChar(c,d,g,f))}return e},_getHeightOfLine:function(d,h){if(this.__lineHeights[h])return this.__lineHeights[h];for(var c=this._textLines[h],f=this._getHeightOfChar(d,c[0],h,0),e=1,b=c.length;b>e;e++){var g=this._getHeightOfChar(d,c[e],h,e);g>f&&(f=g)}return this.__maxFontHeights[h]=f,this.__lineHeights[h]=f*this.lineHeight*this._fontSizeMult,this.__lineHeights[h]},_getTextHeight:function(d){for(var c=0,e=0,b=this._textLines.length;b>e;e++)c+=this._getHeightOfLine(d,e);return c},_renderTextBoxBackground:function(b){this.backgroundColor&&(b.save(),b.fillStyle=this.backgroundColor,b.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),b.restore())},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles)})}}),fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))}}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var b=this;setTimeout(function(){b.selected=!0},100)})},initAddedHandler:function(){var b=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),b.canvas&&(b.canvas._iTextInstances=b.canvas._iTextInstances||[],b.canvas._iTextInstances.push(b))})},initRemovedHandler:function(){var b=this;this.on("removed",function(){b.canvas&&(b.canvas._iTextInstances=b.canvas._iTextInstances||[],fabric.util.removeFromArray(b.canvas._iTextInstances,b))})},_initCanvasHandlers:function(){var b=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(b.canvas)}),this.canvas.on("mouse:up",function(){b.canvas._iTextInstances&&b.canvas._iTextInstances.forEach(function(c){c.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(b.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,c,d,f){var b;return b={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){b.isAborted||e[f]()},onChange:function(){e.canvas&&(e.canvas.clearContext(e.canvas.contextTop||e.ctx),e.renderCursorOrSelection())},abort:function(){return b.isAborted}}),b},_onTickComplete:function(){var b=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var d=this,c=b?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){d._tick()},c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,b--;for(;/\S/.test(this.text.charAt(b))&&b>-1;)d++,b--;return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,b++;for(;/\S/.test(this.text.charAt(b))&&b<this.text.length;)d++,b++;return c+d},findLineBoundaryLeft:function(c){for(var d=0,b=c-1;!/\n/.test(this.text.charAt(b))&&b>-1;)d++,b--;return c-d},findLineBoundaryRight:function(c){for(var d=0,b=c;!/\n/.test(this.text.charAt(b))&&b<this.text.length;)d++,b++;return c+d},getNumNewLinesInSelectedText:function(){for(var e=this.getSelectedText(),d=0,c=0,b=e.length;b>c;c++)"\n"===e[c]&&d++;return d},searchWordBoundary:function(e,f){for(var d=this._reSpace.test(this.text.charAt(e))?e-1:e,c=this.text.charAt(d),b=/[ \n\.,;!\?\-]/;!b.test(c)&&d>0&&d<this.text.length;)d+=f,c=this.text.charAt(d);return b.test(c)&&"\n"!==c&&(d+=1===f?0:1),d},selectWord:function(d){var b=this.searchWordBoundary(d,-1),c=this.searchWordBoundary(d,1);this.setSelectionStart(b),this.setSelectionEnd(c)},selectLine:function(d){var b=this.findLineBoundaryLeft(d),c=this.findLineBoundaryRight(d);this.setSelectionStart(b),this.setSelectionEnd(c)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(b){b._iTextInstances&&b._iTextInstances.forEach(function(c){c.selected=!1,c.isEditing&&c.exitEditing()})},initMouseMoveHandler:function(){var b=this;this.canvas.on("mouse:move",function(d){if(b.__isMousedown&&b.isEditing){var c=b.getSelectionStartFromPointer(d.e);c>=b.__selectionStartOnMouseDown?(b.setSelectionStart(b.__selectionStartOnMouseDown),b.setSelectionEnd(c)):(b.setSelectionStart(c),b.setSelectionEnd(b.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var b in this.styles)this._textLines[b]||delete this.styles[b]},_removeCharsFromTo:function(c,b){for(;b!==c;)this._removeSingleCharAndStyle(c+1),b--;this.setSelectionStart(c)},_removeSingleCharAndStyle:function(b){var c="\n"===this.text[b-1],d=c?b:b-1;this.removeStyleObject(c,d),this.text=this.text.slice(0,b-1)+this.text.slice(b),this._textLines=this.text.split(this._reNewline)},insertChars:function(c,b){this.selectionEnd-this.selectionStart>1&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart));var d="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd),this.insertStyleObjects(c,d,b),this.setSelectionStart(this.selectionStart+c.length),this.setSelectionEnd(this.selectionStart),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(g,f,d){this.shiftLineStyles(g,1),this.styles[g+1]||(this.styles[g+1]={});var b={},e={};if(this.styles[g]&&this.styles[g][f-1]&&(b=this.styles[g][f-1]),d)e[0]=a(b),this.styles[g+1]=e;else{for(var c in this.styles[g])parseInt(c,10)>=f&&(e[parseInt(c,10)-f]=this.styles[g][c],delete this.styles[g][c]);this.styles[g+1]=e}this._clearCache()},insertCharStyleObject:function(h,g,e){var c=this.styles[h],f=a(c);0!==g||e||(g=1);for(var b in f){var d=parseInt(b,10);d>=g&&(c[d+1]=f[d])}this.styles[h][g]=e||a(c[g-1]),this._clearCache()},insertStyleObjects:function(c,e,b){var d=this.get2DCursorLocation(),g=d.lineIndex,f=d.charIndex;this.styles[g]||(this.styles[g]={}),"\n"===c?this.insertNewlineStyleObject(g,f,e):b?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(g,f)},_insertStyles:function(e){for(var d=0,b=e.length;b>d;d++){var c=this.get2DCursorLocation(this.selectionStart+d),g=c.lineIndex,f=c.charIndex;this.insertCharStyleObject(g,f,e[d])}},shiftLineStyles:function(f,e){var d=a(this.styles);for(var b in this.styles){var c=parseInt(b,10);c>f&&(this.styles[c+e]=d[c],d[c-e]||delete this.styles[c])}},removeStyleObject:function(d,j){var k=this.get2DCursorLocation(j),m=k.lineIndex,b=k.charIndex;if(d){var g=this._textLines[m-1],l=g?g.length:0;this.styles[m-1]||(this.styles[m-1]={});for(b in this.styles[m])this.styles[m-1][parseInt(b,10)+l]=this.styles[m][b];this.shiftLineStyles(m,-1)}else{var h=this.styles[m];h&&delete h[b];var c=a(h);for(var f in c){var e=parseInt(f,10);e>=b&&0!==e&&(h[e-1]=c[e],delete h[e])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date;var b=this.canvas.getPointer(a.e);this.isTripleClick(b)?(this.fire("tripleclick",a),this._stopEvent(a.e)):this.isDoubleClick(b)&&(this.fire("dblclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x,this.__mousedownY=b.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1,this._isObjectMoved(a.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(b){var a=this.getSelectionStartFromPointer(b);b.shiftKey?a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(d){var f=this.canvas.getPointer(d),c=new fabric.Point(f.x,f.y),a=new fabric.Point(this.left,this.top),b=fabric.util.rotatePoint(c,a,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,b)},getSelectionStartFromPointer:function(m){for(var c,q,h=this._getLocalRotatedPointer(m),n=0,b=0,p=0,a=0,g=0,l=this._textLines.length;l>g;g++){q=this._textLines[g],p+=this._getHeightOfLine(this.ctx,g)*this.scaleY;var f=this._getLineWidth(this.ctx,g),k=this._getLineLeftOffset(f);b=k*this.scaleX,this.flipX&&(this._textLines[g]=q.reverse().join(""));for(var d=0,o=q.length;o>d;d++){if(n=b,b+=this._getWidthOfChar(this.ctx,q[d],g,this.flipX?o-d:d)*this.scaleX,!(p<=h.y||b<=h.x))return this._getNewSelectionStartFromOffset(h,n,b,a+g,o);a++}if(h.y<p)return this._getNewSelectionStartFromOffset(h,n,b,a+g,o)}return"undefined"==typeof c?this.text.length:void 0},_getNewSelectionStartFromOffset:function(d,g,a,f,i){var e=d.x-g,h=a-d.x,c=h>e?0:1,b=f+c;return this.flipX&&(b=i-b),b>this.text.length&&(b=this.text.length),b}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){if(a.keyCode in this._keysMap)this[this._keysMap[a.keyCode]](a);else{if(!(a.keyCode in this._ctrlKeysMap&&(a.ctrlKey||a.metaKey)))return;this[this._ctrlKeysMap[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(a){this.selectionStart===this.selectionEnd&&this.moveCursorRight(a),this.removeChars(a)},copy:function(a){var c=this.getSelectedText(),b=this._getClipboardData(a);b&&b.setData("text",c),this.copiedText=c,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(b){var a=null,c=this._getClipboardData(b);a=c?c.getData("text"):this.copiedText,a&&this.insertChars(a,!0)},cut:function(a){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(a))},_getClipboardData:function(a){return a&&(a.clipboardData||fabric.window.clipboardData)},onKeyPress:function(a){!this.isEditing||a.metaKey||a.ctrlKey||(0!==a.which&&this.insertChars(String.fromCharCode(a.which)),a.stopPropagation())},getDownCursorOffset:function(j,n){var o,g,f=n?this.selectionEnd:this.selectionStart,m=this.get2DCursorLocation(f),q=m.lineIndex,k=this._textLines[q].slice(0,m.charIndex),l=this._textLines[q].slice(m.charIndex),b=this._textLines[q+1]||"";if(q===this._textLines.length-1||j.metaKey||34===j.keyCode)return this.text.length-f;var a=this._getLineWidth(this.ctx,q);g=this._getLineLeftOffset(a);for(var c=g,d=0,h=k.length;h>d;d++)o=k[d],c+=this._getWidthOfChar(this.ctx,o,q,d);var p=this._getIndexOnNextLine(m,b,c);return l.length+1+p},_getIndexOnNextLine:function(m,b,d){for(var l,r=m.lineIndex+1,f=this._getLineWidth(this.ctx,r),i=this._getLineLeftOffset(f),e=i,q=0,g=0,p=b.length;p>g;g++){var o=b[g],k=this._getWidthOfChar(this.ctx,o,r,g);if(e+=k,e>d){l=!0;var a=e-k,n=e,h=Math.abs(a-d),c=Math.abs(n-d);q=h>c?g+1:g;break}}return l||(q=b.length),q},moveCursorDown:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getDownCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorDownWithShift(b):this.moveCursorDownWithoutShift(b),this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+a),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var a=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)},moveCursorDownWithShift:function(a){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+a):this.setSelectionStart(this.selectionStart+a),this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(j,n){var d=n?this.selectionEnd:this.selectionStart,m=this.get2DCursorLocation(d),p=m.lineIndex;if(0===p||j.metaKey||33===j.keyCode)return d;for(var o,k=this._textLines[p].slice(0,m.charIndex),f=this._textLines[p-1]||"",a=this._getLineWidth(this.ctx,m.lineIndex),g=this._getLineLeftOffset(a),b=g,c=0,h=k.length;h>c;c++)o=k[c],b+=this._getWidthOfChar(this.ctx,o,p,c);var l=this._getIndexOnPrevLine(m,f,b);return f.length-l+k.length},_getIndexOnPrevLine:function(l,g,d){for(var k,r=l.lineIndex-1,q=this._getLineWidth(this.ctx,r),h=this._getLineLeftOffset(q),b=h,m=0,e=0,p=g.length;p>e;e++){var o=g[e],i=this._getWidthOfChar(this.ctx,o,r,e);if(b+=i,b>d){k=!0;var a=b-i,n=b,f=Math.abs(a-d),c=Math.abs(n-d);m=f>c?e:e-1;break}}return k||(m=g.length-1),m},moveCursorUp:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getUpCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorUpWithShift(b):this.moveCursorUpWithoutShift(b),this.initDelayedCursor()},moveCursorUpWithShift:function(a){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-a):this.setSelectionStart(this.selectionStart-a),this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(a){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-a),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(a){0===this.selectionStart&&0===this.selectionEnd||(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorLeftWithShift(a):this.moveCursorLeftWithoutShift(a),this.initDelayedCursor())},_move:function(c,d,b){var a="selectionStart"===d?"setSelectionStart":"setSelectionEnd";c.altKey?this[a](this["findWordBoundary"+b](this[d])):c.metaKey||35===c.keyCode||36===c.keyCode?this[a](this["findLineBoundary"+b](this[d])):this[a](this[d]+("Left"===b?-1:1))},_moveLeft:function(a,b){this._move(a,b,"Left")},_moveRight:function(a,b){this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(a,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(a){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(a,"selectionStart"))},moveCursorRight:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorRightWithShift(a):this.moveCursorRightWithoutShift(a),this.initDelayedCursor())},moveCursorRightWithShift:function(a){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):(this._selectionDirection="right",this._moveRight(a,"selectionEnd"))},moveCursorRightWithoutShift:function(a){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(a,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(c){if(0!==this.selectionStart)if(c.metaKey){var a=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(a,this.selectionStart),this.setSelectionStart(a)}else if(c.altKey){var b=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart),this.setSelectionStart(b)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var a=fabric.util.toFixed,b=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(h,g,d,e,c,f){this.styles[h]?this._setSVGTextLineChars(h,g,d,e,f):this.callSuper("_setSVGTextLineText",h,g,d,e,c)},_setSVGTextLineChars:function(q,c,p,e,g){for(var m=this._textLines[q],n=0,j=this._getSVGLineLeftOffset(q)-this.width/2,f=this._getSVGLineTopOffset(q),d=this._getHeightOfLine(this.ctx,q),h=0,k=m.length;k>h;h++){var o=this.styles[q][h]||{};c.push(this._createTextCharSpan(m[h],o,j,f.lineTop+f.offset,n));var l=this._getWidthOfChar(this.ctx,m[h],q,h);o.textBackgroundColor&&g.push(this._createTextCharBg(o,j,f.lineTop,d,l,n)),n+=l}},_getSVGLineLeftOffset:function(c){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[c]),2)},_getSVGLineTopOffset:function(f){for(var e=0,d=0,c=0;f>c;c++)e+=this._getHeightOfLine(this.ctx,c);return d=this._getHeightOfLine(this.ctx,c),{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(d,h,g,e,c,f){return['<rect fill="',d.textBackgroundColor,'" x="',a(h+f,b),'" y="',a(g-this.height/2,b),'" width="',a(c,b),'" height="',a(e/this.lineHeight,b),'"></rect>'].join("")},_createTextCharSpan:function(d,c,h,g,f){var e=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},c));return['<tspan x="',h+f,'" y="',g-this.height/2,'" ',c.fontFamily?'font-family="'+c.fontFamily.replace(/"/g,"'")+'" ':"",c.fontSize?'font-size="'+c.fontSize+'" ':"",c.fontStyle?'font-style="'+c.fontStyle+'" ':"",c.fontWeight?'font-weight="'+c.fontWeight+'" ':"",c.textDecoration?'text-decoration="'+c.textDecoration+'" ':"",'style="',e,'">',fabric.util.string.escapeXml(d),"</tspan>"].join("")}})}(),function(){function request(url,encoding,callback){var oURL=URL.parse(url);oURL.port||(oURL.port=0===oURL.protocol.indexOf("https:")?443:80);var reqHandler=0===oURL.protocol.indexOf("https:")?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";encoding&&response.setEncoding(encoding),response.on("end",function(){callback(body)}),response.on("data",function(chunk){200===response.statusCode&&(body+=chunk)})});req.on("error",function(err){err.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port):fabric.log(err.message),callback(null)}),req.end()}function requestFs(path,callback){var fs=require("fs");fs.readFile(path,function(err,data){if(err)throw fabric.log(err),err;callback(data)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){data?(img.src=new Buffer(data,"binary"),img._src=url,callback&&callback.call(context,img)):(img=null,callback&&callback.call(context,null,!0))}var img=new Image;url&&(url instanceof Buffer||0===url.indexOf("data"))?(img.src=img._src=url,callback&&callback.call(context,img)):url&&0!==url.indexOf("http")?requestFs(url,createImageAndCallBack):url?request(url,"binary",createImageAndCallBack):callback&&callback.call(context,url)},fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==url.indexOf("http")?requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)}):request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})},fabric.loadSVGFromString=function(string,callback,reviver){var doc=(new DOMParser).parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object),oImg._initFilters(object.filters,function(filters){oImg.filters=filters||[],oImg._initFilters(object.resizeFilters,function(resizeFilters){oImg.resizeFilters=resizeFilters||[],callback&&callback(oImg)})})})},fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;
var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={},canvasEl.width=nodeCanvas.width,canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);return fabricCanvas.contextContainer=nodeCanvas.getContext("2d"),fabricCanvas.nodeCanvas=nodeCanvas,fabricCanvas.Font=Canvas.Font,fabricCanvas},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width,options){return origSetWidth.call(this,width,options),this.nodeCanvas.width=width,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height,options){return origSetHeight.call(this,height,options),this.nodeCanvas.height=height,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();