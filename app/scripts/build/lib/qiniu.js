/*!
 * qiniu-js-sdk v@VERSION
 *
 * Copyright 2015 by Qiniu
 * Released under GPL V2 License.
 *
 * GitHub: http://github.com/qiniu/js-sdk
 *
 * Date: @DATE
*/
!function(global){function createCookie(key,value,exp){var date=new Date;date.setTime(date.getTime()+24*exp*60*60*1e3);var expires="; expires="+date.toGMTString();document.cookie=key+"="+value+expires+"; path=/"}function readCookie(key){for(var nameEQ=key+"=",ca=document.cookie.split(";"),i=0,max=ca.length;max>i;i++){for(var c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function QiniuJsSDK(){function log(type,args){var header="[qiniu-js-sdk]["+type+"]";if(that.detectIEVersion()){for(var msg=header,i=0;i<args.length;i++)msg+=that.stringifyJSON(args[i]);console.log(msg)}else args.unshift(header),console.log.apply(console,args)}function makeLogFunc(code){var func=code.toLowerCase();logger[func]=function(){if(window.console&&window.console.log&&logger.level>=logger[code]){var args=Array.prototype.slice.call(arguments);log(func,args)}}}var that=this;this.detectIEVersion=function(){for(var v=4,div=document.createElement("div"),all=div.getElementsByTagName("i");div.innerHTML="<!--[if gt IE "+v+"]><i></i><![endif]-->",all[0];)v++;return v>4?v:!1};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};for(var property in logger)logger.hasOwnProperty(property)&&"number"==typeof logger[property]&&!logger.hasOwnProperty(property.toLowerCase())&&makeLogFunc(property);var qiniuUploadUrl;qiniuUploadUrl="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com";var qiniuUploadUrls=["http://upload.qiniu.com","http://up.qiniu.com"],changeUrlTimes=0;this.resetUploadUrl=function(){if("https:"===window.location.protocol)qiniuUploadUrl="https://up.qbox.me";else{var i=changeUrlTimes%qiniuUploadUrls.length;qiniuUploadUrl=qiniuUploadUrls[i],changeUrlTimes++}logger.debug("resetUploadUrl: "+qiniuUploadUrl)},this.resetUploadUrl(),this.isImage=function(url){return url=url.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(url)},this.getFileExtension=function(filename){var ext,tempArr=filename.split(".");return ext=1===tempArr.length||""===tempArr[0]&&2===tempArr.length?"":tempArr.pop().toLowerCase()},this.utf8_encode=function(argString){if(null===argString||"undefined"==typeof argString)return"";var start,end,string=argString+"",utftext="",stringl=0;start=end=0,stringl=string.length;for(var n=0;stringl>n;n++){var c1=string.charCodeAt(n),enc=null;if(128>c1)end++;else if(c1>127&&2048>c1)enc=String.fromCharCode(c1>>6|192,63&c1|128);else if(63488&c1^!0)enc=String.fromCharCode(c1>>12|224,c1>>6&63|128,63&c1|128);else{if(64512&c1^!0)throw new RangeError("Unmatched trail surrogate at "+n);var c2=string.charCodeAt(++n);if(64512&c2^!0)throw new RangeError("Unmatched lead surrogate at "+(n-1));c1=((1023&c1)<<10)+(1023&c2)+65536,enc=String.fromCharCode(c1>>18|240,c1>>12&63|128,c1>>6&63|128,63&c1|128)}null!==enc&&(end>start&&(utftext+=string.slice(start,end)),utftext+=enc,start=end=n+1)}return end>start&&(utftext+=string.slice(start,stringl)),utftext},this.base64_encode=function(data){var o1,o2,o3,h1,h2,h3,h4,bits,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;data=this.utf8_encode(data+"");do o1=data.charCodeAt(i++),o2=data.charCodeAt(i++),o3=data.charCodeAt(i++),bits=o1<<16|o2<<8|o3,h1=bits>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=63&bits,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);while(i<data.length);switch(enc=tmp_arr.join(""),data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"="}return enc},this.URLSafeBase64Encode=function(v){return v=this.base64_encode(v),v.replace(/\//g,"_").replace(/\+/g,"-")},this.createAjax=function(argument){var xmlhttp={};return xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,text=String(data);return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),eval("("+text+")")},this.stringifyJSON=function(obj){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(obj);switch(typeof obj){case"string":return'"'+obj.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+obj.map(that.stringifyJSON).join(",")+"]";case"object":if(obj instanceof Array){for(var strArr=[],len=obj.length,i=0;len>i;i++)strArr.push(that.stringifyJSON(obj[i]));return"["+strArr.join(",")+"]"}if(null===obj)return"null";var string=[];for(var property in obj)obj.hasOwnProperty(property)&&string.push(that.stringifyJSON(property)+":"+that.stringifyJSON(obj[property]));return"{"+string.join(",")+"}";case"number":return obj;case!1:return obj;case"boolean":return obj}},this.trim=function(text){return null===text?"":text.replace(/^\s+|\s+$/g,"")},this.uploader=function(op){var reset_chunk_size=function(){var BLOCK_BITS,MAX_CHUNK_SIZE,chunk_size,ie=that.detectIEVersion(),isSpecialSafari="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;ie&&9>=ie&&op.chunk_size&&op.runtimes.indexOf("flash")<0?op.chunk_size=0:isSpecialSafari?op.chunk_size=0:(BLOCK_BITS=20,MAX_CHUNK_SIZE=4<<BLOCK_BITS,chunk_size=plupload.parseSize(op.chunk_size),chunk_size>MAX_CHUNK_SIZE&&(op.chunk_size=MAX_CHUNK_SIZE))},getUpToken=function(){if(op.uptoken)that.token=op.uptoken;else{var ajax=that.createAjax();ajax.open("GET",that.uptoken_url,!0),ajax.setRequestHeader("If-Modified-Since","0"),ajax.onreadystatechange=function(){if(4===ajax.readyState&&200===ajax.status){var res=that.parseJSON(ajax.responseText);that.token=res.uptoken}},ajax.send()}},getFileKey=function(up,file,func){var key="",unique_names=!1;if(!op.save_key)if(unique_names=up.getOption&&up.getOption("unique_names"),unique_names=unique_names||up.settings&&up.settings.unique_names){var ext=that.getFileExtension(file.name);key=ext?file.id+"."+ext:file.id}else key="function"==typeof func?func(up,file):file.name;return key};if(op.log_level&&(logger.level=op.log_level),!op.domain)throw"domain setting in options is required!";if(!op.browse_button)throw"browse_button setting in options is required!";logger.debug("init uploader start"),logger.debug("environment: ",mOxie.Env),logger.debug("userAgent: ",navigator.userAgent);var option={},_Error_Handler=op.init&&op.init.Error,_FileUploaded_Handler=op.init&&op.init.FileUploaded;op.init.Error=function(){},op.init.FileUploaded=function(){},that.uptoken_url=op.uptoken_url,that.token="",that.key_handler="function"==typeof op.init.Key?op.init.Key:"",this.domain=op.domain;var ctx="",speedCalInfo={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""};reset_chunk_size(),logger.debug("invoke reset_chunk_size()"),logger.debug("op.chunk_size: ",op.chunk_size),plupload.extend(option,op,{url:qiniuUploadUrl,multipart_params:{token:""}}),logger.debug("option: ",option);var uploader=new plupload.Uploader(option);logger.debug("new plupload.Uploader(option)"),uploader.bind("Init",function(up,params){logger.debug("Init event activated"),op.get_new_uptoken||getUpToken(),getUpToken()}),logger.debug("bind Init event"),uploader.bind("FilesAdded",function(up,files){logger.debug("FilesAdded event activated");var auto_start=up.getOption&&up.getOption("auto_start");auto_start=auto_start||up.settings&&up.settings.auto_start,logger.debug("auto_start: ",auto_start),logger.debug("files: ",files),auto_start&&setTimeout(function(){up.start(),logger.debug("invoke up.start()")},0),up.refresh()}),logger.debug("bind FilesAdded event"),uploader.bind("BeforeUpload",function(up,file){logger.debug("BeforeUpload event activated"),file.speed=file.speed||0,ctx="",op.get_new_uptoken&&getUpToken();var directUpload=function(up,file,func){speedCalInfo.startTime=(new Date).getTime();var multipart_params_obj;multipart_params_obj=op.save_key?{token:that.token}:{key:getFileKey(up,file,func),token:that.token},logger.debug("directUpload multipart_params_obj: ",multipart_params_obj);var x_vars=op.x_vars;if(void 0!==x_vars&&"object"==typeof x_vars)for(var x_key in x_vars)x_vars.hasOwnProperty(x_key)&&("function"==typeof x_vars[x_key]?multipart_params_obj["x:"+x_key]=x_vars[x_key](up,file):"object"!=typeof x_vars[x_key]&&(multipart_params_obj["x:"+x_key]=x_vars[x_key]));up.setOption({url:qiniuUploadUrl,multipart:!0,chunk_size:is_android_weixin_or_qq()?op.max_file_size:void 0,multipart_params:multipart_params_obj})},is_android_weixin_or_qq=function(){var ua=navigator.userAgent.toLowerCase();return!(!ua.match(/MicroMessenger/i)&&"QQBrowser"!==mOxie.Env.browser&&!ua.match(/V1_AND_SQ/i)||"android"!==mOxie.Env.OS.toLowerCase())},chunk_size=up.getOption&&up.getOption("chunk_size");if(chunk_size=chunk_size||up.settings&&up.settings.chunk_size,logger.debug("uploader.runtime: ",uploader.runtime),logger.debug("chunk_size: ",chunk_size),"html5"!==uploader.runtime&&"flash"!==uploader.runtime||!chunk_size)logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),directUpload(up,file,that.key_handler);else if(file.size<chunk_size||is_android_weixin_or_qq())logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()"),directUpload(up,file,that.key_handler);else{var localFileInfo=localStorage.getItem(file.name),blockSize=chunk_size;if(localFileInfo){localFileInfo=that.parseJSON(localFileInfo);var now=(new Date).getTime(),before=localFileInfo.time||0,aDay=864e5;aDay>now-before&&100!==localFileInfo.percent&&file.size===localFileInfo.total?(file.percent=localFileInfo.percent,file.loaded=localFileInfo.offset,ctx=localFileInfo.ctx,speedCalInfo.isResumeUpload=!0,speedCalInfo.resumeFilesize=localFileInfo.offset,localFileInfo.offset+blockSize>file.size&&(blockSize=file.size-localFileInfo.offset)):localStorage.removeItem(file.name)}speedCalInfo.startTime=(new Date).getTime(),up.setOption({url:qiniuUploadUrl+"/mkblk/"+blockSize,multipart:!1,chunk_size:chunk_size,required_features:"chunks",headers:{Authorization:"UpToken "+that.token},multipart_params:{}})}}),logger.debug("bind BeforeUpload event"),uploader.bind("UploadProgress",function(up,file){logger.trace("UploadProgress event activated"),speedCalInfo.currentTime=(new Date).getTime();var timeUsed=speedCalInfo.currentTime-speedCalInfo.startTime,fileUploaded=file.loaded||0;speedCalInfo.isResumeUpload&&(fileUploaded=file.loaded-speedCalInfo.resumeFilesize),file.speed=(fileUploaded/timeUsed*1e3).toFixed(0)||0}),logger.debug("bind UploadProgress event"),uploader.bind("ChunkUploaded",function(up,file,info){logger.debug("ChunkUploaded event activated"),logger.debug("file: ",file),logger.debug("info: ",info);var res=that.parseJSON(info.response);logger.debug("res: ",res),ctx=ctx?ctx+","+res.ctx:res.ctx;var leftSize=info.total-info.offset,chunk_size=up.getOption&&up.getOption("chunk_size");chunk_size=chunk_size||up.settings&&up.settings.chunk_size,chunk_size>leftSize&&(up.setOption({url:qiniuUploadUrl+"/mkblk/"+leftSize}),logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+leftSize)),localStorage.setItem(file.name,that.stringifyJSON({ctx:ctx,percent:file.percent,total:info.total,offset:info.offset,time:(new Date).getTime()}))}),logger.debug("bind ChunkUploaded event");var retries=qiniuUploadUrls.length,unknow_error_retry=function(file){return retries-- >0?(setTimeout(function(){that.resetUploadUrl(),file.status=plupload.QUEUED,uploader.stop(),uploader.start()},0),!0):(retries=qiniuUploadUrls.length,!1)};return uploader.bind("Error",function(_Error_Handler){return function(up,err){logger.error("Error event activated"),logger.error("err: ",err);var errTip="",file=err.file;if(file){switch(err.code){case plupload.FAILED:errTip="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var max_file_size=up.getOption&&up.getOption("max_file_size");max_file_size=max_file_size||up.settings&&up.settings.max_file_size,errTip="浏览器最大可上传"+max_file_size+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:errTip="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===err.response){if(errTip=err.message||"未知网络错误。",!unknow_error_retry(file))return;break}var errorObj=that.parseJSON(err.response),errorText=errorObj.error;switch(err.status){case 400:errTip="请求报文格式错误。";break;case 401:errTip="客户端认证授权失败。请重试或提交反馈。";break;case 405:errTip="客户端请求错误。请重试或提交反馈。";break;case 579:errTip="资源上传成功，但回调失败。";break;case 599:if(errTip="网络连接异常。请重试或提交反馈。",!unknow_error_retry(file))return;break;case 614:errTip="文件已存在。";try{errorObj=that.parseJSON(errorObj.error),errorText=errorObj.error||"file exists"}catch(e){errorText=errorObj.error||"file exists"}break;case 631:errTip="指定空间不存在。";break;case 701:errTip="上传数据块校验出错。请重试或提交反馈。";break;default:if(errTip="未知错误。",!unknow_error_retry(file))return}errTip=errTip+"("+err.status+"："+errorText+")";break;case plupload.SECURITY_ERROR:errTip="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:errTip="上传失败。请稍后再试。";break;case plupload.IO_ERROR:errTip="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:errTip="网站配置错误。请联系网站管理员。",uploader.destroy();break;default:if(errTip=err.message+err.details,!unknow_error_retry(file))return}_Error_Handler&&_Error_Handler(up,err,errTip)}up.refresh()}}(_Error_Handler)),logger.debug("bind Error event"),uploader.bind("FileUploaded",function(_FileUploaded_Handler){return function(up,file,info){logger.debug("FileUploaded event activated"),logger.debug("file: ",file),logger.debug("info: ",info);var last_step=function(up,file,info){if(op.downtoken_url){var ajax_downtoken=that.createAjax();ajax_downtoken.open("POST",op.downtoken_url,!0),ajax_downtoken.setRequestHeader("Content-type","application/x-www-form-urlencoded"),ajax_downtoken.onreadystatechange=function(){if(4===ajax_downtoken.readyState)if(200===ajax_downtoken.status){var res_downtoken;try{res_downtoken=that.parseJSON(ajax_downtoken.responseText)}catch(e){throw"invalid json format"}var info_extended={};plupload.extend(info_extended,that.parseJSON(info),res_downtoken),_FileUploaded_Handler&&_FileUploaded_Handler(up,file,that.stringifyJSON(info_extended))}else uploader.trigger("Error",{status:ajax_downtoken.status,response:ajax_downtoken.responseText,file:file,code:plupload.HTTP_ERROR})},ajax_downtoken.send("key="+that.parseJSON(info).key+"&domain="+op.domain)}else _FileUploaded_Handler&&_FileUploaded_Handler(up,file,info)},res=that.parseJSON(info.response);if(ctx=ctx?ctx:res.ctx,logger.debug("ctx: ",ctx),ctx){var key="";logger.debug("save_key: ",op.save_key),op.save_key||(key=getFileKey(up,file,that.key_handler),key=key?"/key/"+that.URLSafeBase64Encode(key):"");var fname="/fname/"+that.URLSafeBase64Encode(file.name);logger.debug("op.x_vars: ",op.x_vars);var x_vars=op.x_vars,x_val="",x_vars_url="";if(void 0!==x_vars&&"object"==typeof x_vars)for(var x_key in x_vars)x_vars.hasOwnProperty(x_key)&&("function"==typeof x_vars[x_key]?x_val=that.URLSafeBase64Encode(x_vars[x_key](up,file)):"object"!=typeof x_vars[x_key]&&(x_val=that.URLSafeBase64Encode(x_vars[x_key])),x_vars_url+="/x:"+x_key+"/"+x_val);var ajax,url=qiniuUploadUrl+"/mkfile/"+file.size+key+fname+x_vars_url,ie=that.detectIEVersion();ie&&9>=ie?(ajax=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=op.flash_swf_url):ajax=that.createAjax(),ajax.open("POST",url,!0),ajax.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),ajax.setRequestHeader("Authorization","UpToken "+that.token);var onreadystatechange=function(){if(logger.debug("ajax.readyState: ",ajax.readyState),4===ajax.readyState){localStorage.removeItem(file.name);var info;200===ajax.status?(info=ajax.responseText,logger.debug("mkfile is success: ",info),last_step(up,file,info)):(info={status:ajax.status,response:ajax.responseText,file:file,code:-200},logger.debug("mkfile is error: ",info),uploader.trigger("Error",info))}};ie&&9>=ie?ajax.bind("readystatechange",onreadystatechange):ajax.onreadystatechange=onreadystatechange,ajax.send(ctx),logger.debug("mkfile: ",url)}else last_step(up,file,info.response)}}(_FileUploaded_Handler)),logger.debug("bind FileUploaded event"),uploader.init(),logger.debug("invoke uploader.init()"),logger.debug("init uploader end"),uploader},this.getUrl=function(key){if(!key)return!1;key=encodeURI(key);var domain=this.domain;return"/"!==domain.slice(domain.length-1)&&(domain+="/"),domain+key},this.imageView2=function(op,key){var mode=op.mode||"",w=op.w||"",h=op.h||"",q=op.q||"",format=op.format||"";if(!mode)return!1;if(!w&&!h)return!1;var imageUrl="imageView2/"+mode;return imageUrl+=w?"/w/"+w:"",imageUrl+=h?"/h/"+h:"",imageUrl+=q?"/q/"+q:"",imageUrl+=format?"/format/"+format:"",key&&(imageUrl=this.getUrl(key)+"?"+imageUrl),imageUrl},this.imageMogr2=function(op,key){var auto_orient=op["auto-orient"]||"",thumbnail=op.thumbnail||"",strip=op.strip||"",gravity=op.gravity||"",crop=op.crop||"",quality=op.quality||"",rotate=op.rotate||"",format=op.format||"",blur=op.blur||"",imageUrl="imageMogr2";return imageUrl+=auto_orient?"/auto-orient":"",imageUrl+=thumbnail?"/thumbnail/"+thumbnail:"",imageUrl+=strip?"/strip":"",imageUrl+=gravity?"/gravity/"+gravity:"",imageUrl+=quality?"/quality/"+quality:"",imageUrl+=crop?"/crop/"+crop:"",imageUrl+=rotate?"/rotate/"+rotate:"",imageUrl+=format?"/format/"+format:"",imageUrl+=blur?"/blur/"+blur:"",key&&(imageUrl=this.getUrl(key)+"?"+imageUrl),imageUrl},this.watermark=function(op,key){var mode=op.mode;if(!mode)return!1;var imageUrl="watermark/"+mode;if(1===mode){var image=op.image||"";if(!image)return!1;imageUrl+=image?"/image/"+this.URLSafeBase64Encode(image):""}else{if(2!==mode)return!1;var text=op.text?op.text:"",font=op.font?op.font:"",fontsize=op.fontsize?op.fontsize:"",fill=op.fill?op.fill:"";if(!text)return!1;imageUrl+=text?"/text/"+this.URLSafeBase64Encode(text):"",imageUrl+=font?"/font/"+this.URLSafeBase64Encode(font):"",imageUrl+=fontsize?"/fontsize/"+fontsize:"",imageUrl+=fill?"/fill/"+this.URLSafeBase64Encode(fill):""}var dissolve=op.dissolve||"",gravity=op.gravity||"",dx=op.dx||"",dy=op.dy||"";return imageUrl+=dissolve?"/dissolve/"+dissolve:"",imageUrl+=gravity?"/gravity/"+gravity:"",imageUrl+=dx?"/dx/"+dx:"",imageUrl+=dy?"/dy/"+dy:"",key&&(imageUrl=this.getUrl(key)+"?"+imageUrl),imageUrl},this.imageInfo=function(key){if(!key)return!1;var info,url=this.getUrl(key)+"?imageInfo",xhr=this.createAjax(),that=this;return xhr.open("GET",url,!1),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(info=that.parseJSON(xhr.responseText))},xhr.send(),info},this.exif=function(key){if(!key)return!1;var info,url=this.getUrl(key)+"?exif",xhr=this.createAjax(),that=this;return xhr.open("GET",url,!1),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(info=that.parseJSON(xhr.responseText))},xhr.send(),info},this.get=function(type,key){return key&&type?"exif"===type?this.exif(key):"imageInfo"===type?this.imageInfo(key):!1:!1},this.pipeline=function(arr,key){var option,errOp,isArray="[object Array]"===Object.prototype.toString.call(arr),imageUrl="";if(isArray){for(var i=0,len=arr.length;len>i;i++){if(option=arr[i],!option.fop)return!1;switch(option.fop){case"watermark":imageUrl+=this.watermark(option)+"|";break;case"imageView2":imageUrl+=this.imageView2(option)+"|";break;case"imageMogr2":imageUrl+=this.imageMogr2(option)+"|";break;default:errOp=!0}if(errOp)return!1}if(key){imageUrl=this.getUrl(key)+"?"+imageUrl;var length=imageUrl.length;"|"===imageUrl.slice(length-1)&&(imageUrl=imageUrl.slice(0,length-1))}return imageUrl}return!1}}window.localStorage||(window.localStorage={setItem:function(key,value){createCookie(key,value,30)},getItem:function(key){return readCookie(key)},removeItem:function(key){createCookie(key,"",-1)}});var Qiniu=new QiniuJsSDK;global.Qiniu=Qiniu,global.QiniuJsSDK=QiniuJsSDK}(window);